;
; +-------------------------------------------------------------------------+
; |   This file	has been generated by The Interactive Disassembler (IDA)    |
; |	      Copyright	(c) 2015 Hex-Rays, <support@hex-rays.com>	    |
; |			 License info: 48-3677-7074-51			    |
; |		Michalis Polychronakis,	Stony Brook University		    |
; +-------------------------------------------------------------------------+
;
; Input	MD5   :	7ECC3658669526FBC7A63357E853D438
; Input	CRC32 :	F64C1CE9

; File Name   :	C:\compspace\Diff\openssl\obj\gost_crypt.obj
; Format      :	COFF (X386MAGIC)
; includelib "MSVCRT"
; includelib "OLDNAMES"

		.686p
		.mmx
		.model flat

; ===========================================================================

; Segment type:	Pure data
; Segment permissions: Read/Write
; Segment alignment 'qword' can not be represented in assembly
_data		segment	para public 'DATA' use32
		assume cs:_data
		public _imit_gost_cpa
_imit_gost_cpa	dd offset loc_32D+2
		align 8
		dd 4, 0
		dd offset _gost_imit_init_cpa
		dd offset _gost_imit_update
		dd offset _gost_imit_final
		dd offset _gost_imit_copy
		dd offset _gost_imit_cleanup
		align 20h
		dd 8, 1040h
		dd offset _gost_imit_ctrl
		public _cipher_gost
_cipher_gost	dd offset loc_32D
		dd 1, 20h, 8, 333h
		dd offset _gost_cipher_init
		dd offset _gost_cipher_do_cfb
		dd offset _gost_cipher_cleanup
		dd 102Ch
		dd offset _gost89_set_asn1_parameters
		dd offset _gost89_get_asn1_parameters
		dd offset _gost_cipher_ctl
		align 10h
		public _gost_cipher_list
_gost_cipher_list dd offset loc_34F+2	; DATA XREF: _get_encryption_params+6Co
off_84		dd offset _GostR3411_94_CryptoProParamSet
					; DATA XREF: _get_encryption_params:loc_B95r
		dd 0
off_8C		dd offset loc_337+1	; DATA XREF: _get_encryption_params:loc_B84o
		dd offset _Gost28147_CryptoProParamSetA
		dd 1, 339h
		dd offset _Gost28147_CryptoProParamSetB
		dd 1, 33Ah
		dd offset _Gost28147_CryptoProParamSetC
		dd 1, 33Bh
		dd offset _Gost28147_CryptoProParamSetD
		dd 1, 337h
		dd offset _Gost28147_TestParamSet
		dd 1, 3	dup(0)
		public _cipher_gost_cpacnt
_cipher_gost_cpacnt dd offset loc_32D+1
		dd 1, 20h, 8, 334h
		dd offset _gost_cipher_init_cpa
		dd offset _gost_cipher_do_cnt
		dd offset _gost_cipher_cleanup
		dd 102Ch
		dd offset _gost89_set_asn1_parameters
		dd offset _gost89_get_asn1_parameters
		dd offset _gost_cipher_ctl
		align 8
_data		ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 108h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


; int __cdecl gost_cipher_init(int, int, void *Src, int)
_gost_cipher_init proc near		; DATA XREF: .data:00000060o

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
Src		= dword	ptr  0Ch
arg_C		= dword	ptr  10h

		push	3
		push	0		; int
		push	[esp+8+arg_C]	; int
		push	[esp+0Ch+Src]	; Src
		push	[esp+10h+arg_4]	; int
		push	[esp+14h+arg_0]	; int
		call	_gost_cipher_init_param
		add	esp, 18h
		retn
_gost_cipher_init endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 128h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


; int __cdecl gost_cipher_init_cpa(int,	int, void *Src)
_gost_cipher_init_cpa proc near		; DATA XREF: .data:000000E8o

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
Src		= dword	ptr  0Ch

		push	ebx
		push	esi
		push	edi
		mov	edi, [esp+0Ch+arg_0]
		push	offset _Gost28147_CryptoProParamSetA
		mov	esi, [edi+60h]
		lea	ebx, [esi+0Ch]
		push	ebx
		call	_gost_init
		mov	eax, [esp+14h+arg_4]
		add	esp, 8
		mov	dword ptr [esi+8], 1
		mov	dword ptr [esi+4], 0
		test	eax, eax
		jz	short loc_163
		push	eax
		push	ebx
		call	_gost_key
		add	esp, 8

loc_163:				; CODE XREF: _gost_cipher_init_cpa+2Fj
		mov	esi, [esp+0Ch+Src]
		test	esi, esi
		jz	short loc_17F
		push	edi
		call	_EVP_CIPHER_CTX_iv_length
		push	eax		; Size
		lea	eax, [edi+10h]
		push	esi		; Src
		push	eax		; Dst
		call	_memcpy
		add	esp, 10h

loc_17F:				; CODE XREF: _gost_cipher_init_cpa+41j
		push	edi
		call	_EVP_CIPHER_CTX_iv_length
		push	eax		; Size
		lea	eax, [edi+10h]
		push	eax		; Src
		lea	eax, [edi+20h]
		push	eax		; Dst
		call	_memcpy
		add	esp, 10h
		mov	eax, 1
		pop	edi
		pop	esi
		pop	ebx
		retn
_gost_cipher_init_cpa endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 1A0h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


; int __cdecl gost_cipher_do_cfb(int, void *, void *Src, int)
_gost_cipher_do_cfb proc near		; DATA XREF: .data:00000064o

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
Src		= dword	ptr  0Ch
arg_C		= dword	ptr  10h

		push	ebx
		mov	ebx, [esp+4+arg_4]
		push	ebp
		push	esi
		mov	esi, [esp+0Ch+arg_0]
		xor	ebp, ebp
		push	edi
		mov	edi, [esp+10h+Src]
		mov	ecx, [esi+50h]
		test	ecx, ecx
		jz	short loc_209
		cmp	ecx, 8
		jnb	short loc_1F0
		mov	edx, [esp+10h+arg_C]

loc_1C2:				; CODE XREF: _gost_cipher_do_cfb+4Bj
		cmp	ebp, edx
		jnb	short loc_1ED
		cmp	dword ptr [esi+8], 0
		jnz	short loc_1D2
		mov	al, [edi]
		mov	[ecx+esi+38h], al

loc_1D2:				; CODE XREF: _gost_cipher_do_cfb+2Aj
		mov	al, [ecx+esi+30h]
		xor	al, [edi]
		mov	[ebx], al
		cmp	dword ptr [esi+8], 0
		jz	short loc_1E4
		mov	[ecx+esi+38h], al

loc_1E4:				; CODE XREF: _gost_cipher_do_cfb+3Ej
		inc	ecx
		inc	ebp
		inc	edi
		inc	ebx
		cmp	ecx, 8
		jb	short loc_1C2

loc_1ED:				; CODE XREF: _gost_cipher_do_cfb+24j
		cmp	ecx, 8

loc_1F0:				; CODE XREF: _gost_cipher_do_cfb+1Cj
		jnz	loc_3C3
		mov	eax, [esi+38h]
		mov	[esi+20h], eax
		mov	eax, [esi+3Ch]
		mov	[esi+24h], eax
		mov	dword ptr [esi+50h], 0

loc_209:				; CODE XREF: _gost_cipher_do_cfb+17j
		mov	eax, [esp+10h+arg_C]
		lea	ecx, [ebp+8]
		mov	[esp+10h+arg_4], ecx
		cmp	ecx, eax
		jnb	loc_2FE
		lea	ecx, [esi+20h]
		nop

loc_220:				; CODE XREF: _gost_cipher_do_cfb+158j
		mov	eax, [esi+60h]
		mov	[esp+10h+Src], eax
		cmp	dword ptr [eax+8], 0
		jz	short loc_24A
		cmp	dword ptr [eax+4], 400h
		jnz	short loc_24A
		push	ecx
		add	eax, 0Ch
		push	eax
		call	_cryptopro_key_meshing
		mov	eax, [esp+18h+Src]
		lea	ecx, [esi+20h]
		add	esp, 8

loc_24A:				; CODE XREF: _gost_cipher_do_cfb+8Bj
					; _gost_cipher_do_cfb+94j
		lea	edx, [esi+30h]
		add	eax, 0Ch
		push	edx
		push	ecx
		push	eax
		call	_gostcrypt
		mov	ecx, [esp+1Ch+Src]
		add	esp, 0Ch
		mov	eax, [ecx+4]
		and	eax, 3FFh
		add	eax, 8
		mov	[ecx+4], eax
		lea	ecx, [esi+20h]
		cmp	dword ptr [esi+8], 0
		jnz	short loc_280
		mov	eax, [edi]
		mov	[ecx], eax
		mov	eax, [edi+4]
		mov	[ecx+4], eax

loc_280:				; CODE XREF: _gost_cipher_do_cfb+D4j
		movzx	eax, byte ptr [esi+30h]
		xor	al, [edi]
		mov	[ebx], al
		movzx	eax, byte ptr [edi+1]
		xor	al, [esi+31h]
		mov	[ebx+1], al
		movzx	eax, byte ptr [edi+2]
		xor	al, [esi+32h]
		mov	[ebx+2], al
		movzx	eax, byte ptr [edi+3]
		xor	al, [esi+33h]
		mov	[ebx+3], al
		movzx	eax, byte ptr [edi+4]
		xor	al, [esi+34h]
		mov	[ebx+4], al
		movzx	eax, byte ptr [edi+5]
		xor	al, [esi+35h]
		mov	[ebx+5], al
		movzx	eax, byte ptr [edi+6]
		xor	al, [esi+36h]
		mov	[ebx+6], al
		movzx	eax, byte ptr [edi+7]
		xor	al, [esi+37h]
		mov	[ebx+7], al
		cmp	dword ptr [esi+8], 0
		jz	short loc_2DE
		mov	eax, [ebx]
		mov	[ecx], eax
		mov	eax, [ebx+4]
		mov	[ecx+4], eax

loc_2DE:				; CODE XREF: _gost_cipher_do_cfb+132j
		mov	edx, [esp+10h+arg_4]
		add	ebp, 8
		mov	eax, [esp+10h+arg_C]
		add	edx, 8
		add	edi, 8
		mov	[esp+10h+arg_4], edx
		add	ebx, 8
		cmp	edx, eax
		jb	loc_220

loc_2FE:				; CODE XREF: _gost_cipher_do_cfb+76j
		cmp	ebp, eax
		jnb	loc_3D0
		mov	eax, [esi+60h]
		lea	ecx, [esi+20h]
		mov	[esp+10h+Src], eax
		cmp	dword ptr [eax+8], 0
		jz	short loc_330
		cmp	dword ptr [eax+4], 400h
		jnz	short loc_330
		push	ecx
		add	eax, 0Ch
		push	eax
		call	_cryptopro_key_meshing
		mov	eax, [esp+18h+Src]

loc_32D:				; DATA XREF: .data:_cipher_gosto
					; .data:_cipher_gost_cpacnto ...
		add	esp, 8

loc_330:				; CODE XREF: _gost_cipher_do_cfb+174j
					; _gost_cipher_do_cfb+17Dj
		lea	ecx, [esi+30h]
		add	eax, 0Ch
		push	ecx

loc_337:				; DATA XREF: .data:off_8Co
		mov	[esp+14h+arg_4], ecx
		lea	ecx, [esi+20h]
		push	ecx
		push	eax
		call	_gostcrypt
		mov	ecx, [esp+1Ch+Src]
		add	esp, 0Ch
		mov	eax, [ecx+4]

loc_34F:				; DATA XREF: .data:_gost_cipher_listo
		and	eax, 3FFh
		add	eax, 8
		mov	[ecx+4], eax
		cmp	dword ptr [esi+8], 0
		jnz	short loc_374
		mov	eax, [esp+10h+arg_C]
		sub	eax, ebp
		push	eax		; Size
		lea	eax, [esi+38h]
		push	edi		; Src
		push	eax		; Dst
		call	_memcpy
		add	esp, 0Ch

loc_374:				; CODE XREF: _gost_cipher_do_cfb+1BEj
		mov	edx, [esp+10h+arg_C]
		xor	esi, esi
		sub	edi, ebx
		mov	ecx, ebx
		sub	edx, ebp
		mov	ebp, [esp+10h+arg_4]

loc_384:				; CODE XREF: _gost_cipher_do_cfb+1F5j
		mov	al, [esi+ebp]
		lea	ecx, [ecx+1]
		xor	al, [edi+ecx-1]
		inc	esi
		mov	[ecx-1], al
		sub	edx, 1
		jnz	short loc_384
		mov	[esp+10h+Src], esi
		mov	esi, [esp+10h+arg_0]
		mov	eax, [esp+10h+Src]
		mov	[esi+50h], eax
		cmp	[esi+8], edx
		jz	short loc_3D7
		push	eax		; Size
		push	ebx		; Src
		add	esi, 38h ; '8'
		push	esi		; Dst
		call	_memcpy
		add	esp, 0Ch
		mov	eax, 1
		pop	edi
		pop	esi
		pop	ebp
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_3C3:				; CODE XREF: _gost_cipher_do_cfb:loc_1F0j
		pop	edi
		mov	[esi+50h], ecx
		mov	eax, 1
		pop	esi
		pop	ebp
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_3D0:				; CODE XREF: _gost_cipher_do_cfb+160j
		mov	dword ptr [esi+50h], 0

loc_3D7:				; CODE XREF: _gost_cipher_do_cfb+209j
		pop	edi
		pop	esi
		pop	ebp
		mov	eax, 1
		pop	ebx
		retn
_gost_cipher_do_cfb endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 3E4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_cipher_do_cnt proc near		; DATA XREF: .data:000000ECo

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch
arg_C		= dword	ptr  10h

		push	ebx
		mov	ebx, [esp+4+arg_0]
		push	ebp
		push	esi
		mov	esi, [esp+0Ch+arg_4]
		xor	ebp, ebp
		mov	ecx, [ebx+50h]
		push	edi
		mov	edi, [esp+10h+arg_8]
		test	ecx, ecx
		jz	short loc_42B
		cmp	ecx, 8
		jnb	short loc_41E
		mov	edx, [esp+10h+arg_C]

loc_406:				; CODE XREF: _gost_cipher_do_cnt+35j
		cmp	ebp, edx
		jnb	short loc_41B
		mov	al, [ecx+ebx+30h]
		inc	ebp
		xor	al, [edi]
		inc	ecx
		mov	[esi], al
		inc	edi
		inc	esi
		cmp	ecx, 8
		jb	short loc_406

loc_41B:				; CODE XREF: _gost_cipher_do_cnt+24j
		cmp	ecx, 8

loc_41E:				; CODE XREF: _gost_cipher_do_cnt+1Cj
		jnz	loc_502
		mov	dword ptr [ebx+50h], 0

loc_42B:				; CODE XREF: _gost_cipher_do_cnt+17j
		mov	eax, [esp+10h+arg_C]
		lea	ecx, [ebp+8]
		mov	[esp+10h+arg_8], ecx
		cmp	ecx, eax
		jnb	loc_4C1
		lea	edx, [ebx+20h]
		lea	ecx, [ebx+30h]

loc_444:				; CODE XREF: _gost_cipher_do_cnt+DBj
		push	ecx
		push	edx
		push	dword ptr [ebx+60h]
		call	_gost_cnt_next
		movzx	eax, byte ptr [edi]
		lea	edx, [ebx+20h]
		xor	al, [ebx+30h]
		add	esp, 0Ch
		mov	[esi], al
		add	ebp, 8
		movzx	eax, byte ptr [edi+1]
		xor	al, [ebx+31h]
		mov	[esi+1], al
		movzx	eax, byte ptr [edi+2]
		xor	al, [ebx+32h]
		mov	[esi+2], al
		movzx	eax, byte ptr [edi+3]
		xor	al, [ebx+33h]
		mov	ecx, [esp+10h+arg_8]
		mov	[esi+3], al
		add	ecx, 8
		movzx	eax, byte ptr [edi+4]
		xor	al, [ebx+34h]
		mov	[esi+4], al
		movzx	eax, byte ptr [edi+5]
		xor	al, [ebx+35h]
		mov	[esi+5], al
		movzx	eax, byte ptr [edi+6]
		xor	al, [ebx+36h]
		mov	[esi+6], al
		movzx	eax, byte ptr [edi+7]
		add	edi, 8
		xor	al, [ebx+37h]
		mov	[esi+7], al
		add	esi, 8
		mov	eax, [esp+10h+arg_C]
		cmp	ecx, eax
		mov	[esp+10h+arg_8], ecx
		lea	ecx, [ebx+30h]
		jb	short loc_444

loc_4C1:				; CODE XREF: _gost_cipher_do_cnt+54j
		cmp	ebp, eax
		jnb	short loc_50F
		lea	eax, [ebx+30h]
		push	eax
		lea	eax, [ebx+20h]
		push	eax
		push	dword ptr [ebx+60h]
		call	_gost_cnt_next
		mov	ecx, [esp+1Ch+arg_C]
		add	esp, 0Ch
		xor	edx, edx
		sub	edi, esi
		sub	ecx, ebp
		xchg	ax, ax

loc_4E4:				; CODE XREF: _gost_cipher_do_cnt+111j
		mov	al, [edi+esi]
		lea	esi, [esi+1]
		xor	al, [ebx+edx+30h]
		inc	edx
		mov	[esi-1], al
		sub	ecx, 1
		jnz	short loc_4E4
		pop	edi
		pop	esi
		pop	ebp
		mov	[ebx+50h], edx
		lea	eax, [ecx+1]
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_502:				; CODE XREF: _gost_cipher_do_cnt:loc_41Ej
		pop	edi
		pop	esi
		pop	ebp
		mov	[ebx+50h], ecx
		mov	eax, 1
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_50F:				; CODE XREF: _gost_cipher_do_cnt+DFj
		pop	edi
		pop	esi
		pop	ebp
		mov	dword ptr [ebx+50h], 0
		mov	eax, 1
		pop	ebx
		retn
_gost_cipher_do_cnt endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 520h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_cipher_cleanup proc near		; DATA XREF: .data:00000068o
					; .data:000000F0o

arg_0		= dword	ptr  4

		push	esi
		mov	esi, [esp+4+arg_0]
		mov	eax, [esi+60h]
		add	eax, 0Ch
		push	eax
		call	_gost_destroy
		add	esp, 4
		mov	dword ptr [esi+54h], 0
		mov	eax, 1
		pop	esi
		retn
_gost_cipher_cleanup endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 544h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost89_set_asn1_parameters proc near	; DATA XREF: .data:00000070o
					; .data:000000F8o

var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, 4
		call	__chkstk
		push	ebx
		push	esi
		push	edi
		mov	edi, [esp+10h+arg_0]
		mov	[esp+10h+var_4], 0
		mov	ebx, [edi+60h]
		call	_GOST_CIPHER_PARAMS_new
		mov	esi, eax
		test	esi, esi
		jnz	short loc_588
		push	1B4h
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	76h ; 'v'
		push	6Dh ; 'm'
		call	_ERR_GOST_error
		add	esp, 10h
		xor	eax, eax
		pop	edi
		pop	esi
		pop	ebx
		pop	ecx
		retn
; ---------------------------------------------------------------------------

loc_588:				; CODE XREF: _gost89_set_asn1_parameters+25j
		mov	eax, [edi]
		push	dword ptr [eax+0Ch]
		lea	eax, [edi+20h]
		push	eax
		push	dword ptr [esi]
		call	_ASN1_OCTET_STRING_set
		add	esp, 0Ch
		test	eax, eax
		jnz	short loc_5AF
		push	esi
		call	_GOST_CIPHER_PARAMS_free
		push	1B9h
		jmp	loc_64D
; ---------------------------------------------------------------------------

loc_5AF:				; CODE XREF: _gost89_set_asn1_parameters+59j
		push	dword ptr [esi+4]
		call	_ASN1_OBJECT_free
		push	dword ptr [ebx]
		call	_OBJ_nid2obj
		push	0
		push	esi
		mov	[esi+4], eax
		call	_i2d_GOST_CIPHER_PARAMS
		push	1C0h
		mov	ebx, eax
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	ebx
		call	_CRYPTO_malloc
		mov	edi, eax
		add	esp, 1Ch
		mov	[esp+10h+var_4], edi
		test	edi, edi
		jnz	short loc_5F5
		push	esi
		call	_GOST_CIPHER_PARAMS_free
		push	1C3h
		jmp	short loc_64D
; ---------------------------------------------------------------------------

loc_5F5:				; CODE XREF: _gost89_set_asn1_parameters+A2j
		lea	eax, [esp+10h+var_4]
		push	eax
		push	esi
		call	_i2d_GOST_CIPHER_PARAMS
		push	esi
		call	_GOST_CIPHER_PARAMS_free
		add	esp, 0Ch
		call	_ASN1_OCTET_STRING_new
		mov	esi, eax
		test	esi, esi
		jz	short loc_642
		push	ebx
		push	edi
		push	esi
		call	_ASN1_OCTET_STRING_set
		add	esp, 0Ch
		test	eax, eax
		jz	short loc_642
		push	edi
		call	_CRYPTO_free
		push	esi
		push	10h
		push	[esp+1Ch+arg_4]
		call	_ASN1_TYPE_set
		add	esp, 10h
		mov	eax, 1
		pop	edi
		pop	esi
		pop	ebx
		pop	ecx
		retn
; ---------------------------------------------------------------------------

loc_642:				; CODE XREF: _gost89_set_asn1_parameters+CEj
					; _gost89_set_asn1_parameters+DDj
		push	edi
		call	_CRYPTO_free
		push	1CDh

loc_64D:				; CODE XREF: _gost89_set_asn1_parameters+66j
					; _gost89_set_asn1_parameters+AFj
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	76h ; 'v'
		push	6Dh ; 'm'
		call	_ERR_GOST_error
		add	esp, 14h
		xor	eax, eax
		pop	edi
		pop	esi
		pop	ebx
		pop	ecx
		retn
_gost89_set_asn1_parameters endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 668h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost89_get_asn1_parameters proc near	; DATA XREF: .data:00000074o
					; .data:000000FCo

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		push	ebx
		push	esi
		mov	esi, [esp+8+arg_4]
		push	edi
		mov	edi, [esp+0Ch+arg_0]
		push	esi
		mov	ebx, [edi+60h]
		call	_ASN1_TYPE_get
		add	esp, 4
		cmp	eax, 10h
		jz	short loc_68B
		pop	edi
		pop	esi
		or	eax, 0FFFFFFFFh
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_68B:				; CODE XREF: _gost89_get_asn1_parameters+1Aj
		mov	ecx, [esi+4]
		push	ebp
		mov	eax, [ecx+8]
		mov	[esp+10h+arg_0], eax
		lea	eax, [esp+10h+arg_0]
		push	dword ptr [ecx]
		push	eax
		push	0
		call	_d2i_GOST_CIPHER_PARAMS
		mov	esi, eax
		add	esp, 0Ch
		mov	ecx, [esi]
		mov	ebp, [ecx]
		mov	ecx, [edi]
		cmp	ebp, [ecx+0Ch]
		jz	short loc_6D8
		push	esi
		call	_GOST_CIPHER_PARAMS_free
		push	1EAh
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	6Eh ; 'n'
		push	6Ch ; 'l'
		call	_ERR_GOST_error
		add	esp, 14h
		or	eax, 0FFFFFFFFh
		pop	ebp
		pop	edi
		pop	esi
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_6D8:				; CODE XREF: _gost89_get_asn1_parameters+4Aj
		push	dword ptr [esi+4]
		call	_OBJ_obj2nid
		push	eax
		push	ebx
		call	_gost_cipher_set_param
		add	esp, 0Ch
		test	eax, eax
		jnz	short loc_6FF
		push	esi
		call	_GOST_CIPHER_PARAMS_free
		add	esp, 4
		or	eax, 0FFFFFFFFh
		pop	ebp
		pop	edi
		pop	esi
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_6FF:				; CODE XREF: _gost89_get_asn1_parameters+84j
		mov	eax, [esi]
		push	ebp		; Size
		push	dword ptr [eax+8] ; Src
		lea	eax, [edi+10h]
		push	eax		; Dst
		call	_memcpy
		push	esi
		call	_GOST_CIPHER_PARAMS_free
		add	esp, 10h
		mov	eax, 1
		pop	ebp
		pop	edi
		pop	esi
		pop	ebx
		retn
_gost89_get_asn1_parameters endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 724h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_cipher_ctl proc near		; DATA XREF: .data:00000078o
					; .data:00000100o

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_C		= dword	ptr  10h

		mov	eax, [esp+arg_4]
		sub	eax, 6
		jz	short loc_766
		sub	eax, 1
		jz	short loc_74F
		push	1A4h
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	81h ; 'Å'
		push	6Fh ; 'o'
		call	_ERR_GOST_error
		add	esp, 10h
		or	eax, 0FFFFFFFFh
		retn
; ---------------------------------------------------------------------------

loc_74F:				; CODE XREF: _gost_cipher_ctl+Cj
		mov	eax, [esp+arg_C]
		test	eax, eax
		jz	short loc_763
		mov	dword ptr [eax], 32Ah

loc_75D:				; CODE XREF: _gost_cipher_ctl+57j
		mov	eax, 1
		retn
; ---------------------------------------------------------------------------

loc_763:				; CODE XREF: _gost_cipher_ctl+31j
		xor	eax, eax
		retn
; ---------------------------------------------------------------------------

loc_766:				; CODE XREF: _gost_cipher_ctl+7j
		mov	eax, [esp+arg_0]
		push	dword ptr [eax+58h]
		push	[esp+4+arg_C]
		call	_RAND_bytes
		add	esp, 8
		test	eax, eax
		jg	short loc_75D
		push	195h
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	7Bh ; '{'
		push	6Fh ; 'o'
		call	_ERR_GOST_error
		add	esp, 10h
		or	eax, 0FFFFFFFFh
		retn
_gost_cipher_ctl endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 798h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_imit_init_cpa proc near		; DATA XREF: .data:00000010o

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		xorps	xmm0, xmm0
		push	offset _Gost28147_CryptoProParamSetA
		mov	eax, [eax+0Ch]
		push	eax
		movups	xmmword	ptr [eax+1020h], xmm0
		mov	dword ptr [eax+1030h], 0
		mov	dword ptr [eax+1038h], 0
		mov	dword ptr [eax+1034h], 1
		call	_gost_init
		add	esp, 8
		mov	eax, 1
		retn
_gost_imit_init_cpa endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 7DCh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


; int __cdecl gost_imit_update(int, void *Src, size_t Size)
_gost_imit_update proc near		; CODE XREF: _gost_imit_final+7Ap
					; DATA XREF: .data:00000014o

var_C		= byte ptr -0Ch
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
Src		= dword	ptr  8
Size		= dword	ptr  0Ch

		mov	eax, 0Ch
		call	__chkstk
		mov	eax, dword ptr ds:___security_cookie
		xor	eax, esp
		mov	[esp+0Ch+var_4], eax
		mov	eax, [esp+0Ch+arg_0]
		push	ebx
		mov	ebx, [esp+10h+Src]
		push	esi
		mov	esi, [eax+0Ch]
		push	edi
		mov	edi, [esp+18h+Size]
		cmp	dword ptr [esi+103Ch], 0
		jnz	short loc_836
		push	21Bh
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	74h ; 't'
		push	73h ; 's'
		call	_ERR_GOST_error
		add	esp, 10h
		xor	eax, eax
		pop	edi
		pop	esi
		pop	ebx
		mov	ecx, [esp+0Ch+var_4]
		xor	ecx, esp
		call	@__security_check_cookie@4 ; __security_check_cookie(x)
		add	esp, 0Ch
		retn
; ---------------------------------------------------------------------------

loc_836:				; CODE XREF: _gost_imit_update+2Ej
		mov	ecx, [esi+1038h]
		test	ecx, ecx
		jz	short loc_8B8
		cmp	ecx, 8
		jnb	short loc_864
		nop	dword ptr [eax+00000000h]

loc_84C:				; CODE XREF: _gost_imit_update+83j
		test	edi, edi
		jz	short loc_861
		mov	al, [ebx]
		dec	edi
		mov	[ecx+esi+1028h], al
		inc	ebx
		inc	ecx
		cmp	ecx, 8
		jb	short loc_84C

loc_861:				; CODE XREF: _gost_imit_update+72j
		cmp	ecx, 8

loc_864:				; CODE XREF: _gost_imit_update+67j
		jnz	loc_958
		cmp	dword ptr [esi+1034h], 0
		jz	short loc_88D
		cmp	dword ptr [esi+1030h], 400h
		jnz	short loc_88D
		lea	eax, [esp+18h+var_C]
		push	eax
		push	esi
		call	_cryptopro_key_meshing
		add	esp, 8

loc_88D:				; CODE XREF: _gost_imit_update+95j
					; _gost_imit_update+A1j
		lea	eax, [esi+1028h]
		push	eax
		lea	eax, [esi+1020h]
		push	eax
		push	esi
		call	_mac_block
		mov	eax, [esi+1030h]
		add	esp, 0Ch
		and	eax, 3FFh
		add	eax, 8
		mov	[esi+1030h], eax

loc_8B8:				; CODE XREF: _gost_imit_update+62j
		cmp	edi, 8
		jbe	short loc_926
		push	ebp
		lea	ebp, [edi-9]
		shr	ebp, 3
		lea	eax, [esi+1020h]
		inc	ebp
		nop

loc_8CC:				; CODE XREF: _gost_imit_update+147j
		cmp	dword ptr [esi+1034h], 0
		jz	short loc_8F5
		cmp	dword ptr [esi+1030h], 400h
		jnz	short loc_8F5
		lea	eax, [esp+1Ch+var_C]
		push	eax
		push	esi
		call	_cryptopro_key_meshing
		add	esp, 8
		lea	eax, [esi+1020h]

loc_8F5:				; CODE XREF: _gost_imit_update+F7j
					; _gost_imit_update+103j
		push	ebx
		push	eax
		push	esi
		call	_mac_block
		mov	eax, [esi+1030h]
		add	esp, 0Ch
		and	eax, 3FFh
		add	ebx, 8
		add	eax, 8
		sub	edi, 8
		mov	[esi+1030h], eax
		lea	eax, [esi+1020h]
		sub	ebp, 1
		jnz	short loc_8CC
		pop	ebp

loc_926:				; CODE XREF: _gost_imit_update+DFj
		test	edi, edi
		jz	short loc_93B
		push	edi		; Size
		lea	eax, [esi+1028h]
		push	ebx		; Src
		push	eax		; Dst
		call	_memcpy
		add	esp, 0Ch

loc_93B:				; CODE XREF: _gost_imit_update+14Cj
		mov	[esi+1038h], edi

loc_941:				; CODE XREF: _gost_imit_update+182j
		mov	ecx, [esp+18h+var_4]
		mov	eax, 1
		pop	edi
		pop	esi
		pop	ebx
		xor	ecx, esp
		call	@__security_check_cookie@4 ; __security_check_cookie(x)
		add	esp, 0Ch
		retn
; ---------------------------------------------------------------------------

loc_958:				; CODE XREF: _gost_imit_update:loc_864j
		mov	[esi+1038h], ecx
		jmp	short loc_941
_gost_imit_update endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 960h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_imit_final proc near		; DATA XREF: .data:00000018o

Src		= qword	ptr -0Ch
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, 0Ch
		call	__chkstk
		mov	eax, dword ptr ds:___security_cookie
		xor	eax, esp
		mov	[esp+0Ch+var_4], eax
		mov	eax, [esp+0Ch+arg_0]
		push	ebx
		mov	ebx, [esp+10h+arg_4]
		push	esi
		mov	esi, [eax+0Ch]
		cmp	dword ptr [esi+103Ch], 0
		jnz	short loc_9B7
		push	239h
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	74h ; 't'
		push	8Ch ; 'å'
		call	_ERR_GOST_error
		add	esp, 10h
		xor	eax, eax
		pop	esi
		pop	ebx
		mov	ecx, [esp+0Ch+var_4]
		xor	ecx, esp
		call	@__security_check_cookie@4 ; __security_check_cookie(x)
		add	esp, 0Ch
		retn
; ---------------------------------------------------------------------------

loc_9B7:				; CODE XREF: _gost_imit_final+29j
		cmp	dword ptr [esi+1030h], 0
		jnz	short loc_9E2
		cmp	dword ptr [esi+1038h], 0
		jz	short loc_9E2
		push	8		; Size
		lea	ecx, [esp+18h+Src]
		xorps	xmm0, xmm0
		push	ecx		; Src
		push	eax		; int
		movq	[esp+20h+Src], xmm0
		call	_gost_imit_update
		add	esp, 0Ch

loc_9E2:				; CODE XREF: _gost_imit_final+5Ej
					; _gost_imit_final+67j
		mov	eax, [esi+1038h]
		test	eax, eax
		jz	short loc_A60
		cmp	eax, 8
		jge	short loc_A12
		push	edi
		mov	ecx, 8
		lea	edi, [esi+1028h]
		sub	ecx, eax
		add	edi, eax
		mov	edx, ecx
		xor	eax, eax
		shr	ecx, 2
		rep stosd
		mov	ecx, edx
		and	ecx, 3
		rep stosb
		pop	edi

loc_A12:				; CODE XREF: _gost_imit_final+8Fj
		cmp	dword ptr [esi+1034h], 0
		jz	short loc_A35
		cmp	dword ptr [esi+1030h], 400h
		jnz	short loc_A35
		lea	eax, [esp+14h+Src]
		push	eax
		push	esi
		call	_cryptopro_key_meshing
		add	esp, 8

loc_A35:				; CODE XREF: _gost_imit_final+B9j
					; _gost_imit_final+C5j
		lea	eax, [esi+1028h]
		push	eax
		lea	eax, [esi+1020h]
		push	eax
		push	esi
		call	_mac_block
		mov	eax, [esi+1030h]
		add	esp, 0Ch
		and	eax, 3FFh
		add	eax, 8
		mov	[esi+1030h], eax

loc_A60:				; CODE XREF: _gost_imit_final+8Aj
		push	ebx
		lea	eax, [esi+1020h]
		push	20h ; ' '
		push	eax
		call	_get_mac
		mov	ecx, [esp+20h+var_4]
		add	esp, 0Ch
		mov	eax, 1
		pop	esi
		pop	ebx
		xor	ecx, esp
		call	@__security_check_cookie@4 ; __security_check_cookie(x)
		add	esp, 0Ch
		retn
_gost_imit_final endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0A88h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_imit_copy	proc near		; DATA XREF: .data:0000001Co

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_4]
		push	1040h		; Size
		push	dword ptr [eax+0Ch] ; Src
		mov	eax, [esp+8+arg_0]
		push	dword ptr [eax+0Ch] ; Dst
		call	_memcpy
		add	esp, 0Ch
		mov	eax, 1
		retn
_gost_imit_copy	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0AACh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_imit_cleanup proc	near		; DATA XREF: .data:00000020o

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		push	1040h		; Size
		push	0		; Val
		push	dword ptr [eax+0Ch] ; Dst
		call	_memset
		add	esp, 0Ch
		mov	eax, 1
		retn
_gost_imit_cleanup endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0AC8h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_imit_ctrl	proc near		; DATA XREF: .data:00000048o

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch
arg_C		= dword	ptr  10h

		mov	eax, [esp+arg_4]
		sub	eax, 1003h
		jz	short loc_B20
		sub	eax, 1
		jnz	short loc_AF5
		cmp	[esp+arg_8], 20h ; ' '
		jz	short loc_AF8
		push	255h
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	6Fh ; 'o'
		push	72h ; 'r'
		call	_ERR_GOST_error
		add	esp, 10h

loc_AF5:				; CODE XREF: _gost_imit_ctrl+Ej
		xor	eax, eax
		retn
; ---------------------------------------------------------------------------

loc_AF8:				; CODE XREF: _gost_imit_ctrl+15j
		push	esi
		mov	esi, [esp+4+arg_0]
		push	[esp+4+arg_C]
		push	dword ptr [esi+0Ch]
		call	_gost_key
		mov	eax, [esi+0Ch]
		add	esp, 8
		mov	dword ptr [eax+103Ch], 1
		mov	eax, 1
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_B20:				; CODE XREF: _gost_imit_ctrl+9j
		mov	eax, [esp+arg_C]
		mov	dword ptr [eax], 20h ; ' '
		mov	eax, 1
		retn
_gost_imit_ctrl	endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0B30h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _get_encryption_params
_get_encryption_params proc near	; CODE XREF: _gost_cipher_init_param+21p
					; _gost_cipher_set_param+12p

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		test	eax, eax
		jnz	short loc_B8A
		push	eax
		call	_get_gost_engine_param
		mov	edx, eax
		add	esp, 4
		test	edx, edx
		jz	short loc_B84
		mov	ecx, edx
		push	esi
		lea	esi, [ecx+1]
		nop	dword ptr [eax]

loc_B50:				; CODE XREF: _get_encryption_params+25j
		mov	al, [ecx]
		inc	ecx
		test	al, al
		jnz	short loc_B50
		sub	ecx, esi
		pop	esi
		jz	short loc_B84
		push	edx
		call	_OBJ_txt2nid
		mov	ecx, eax
		add	esp, 4
		test	ecx, ecx
		jnz	short loc_B95
		push	97h ; 'ó'
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	6Bh ; 'k'
		push	67h ; 'g'
		call	_ERR_GOST_error
		add	esp, 10h
		xor	eax, eax
		retn
; ---------------------------------------------------------------------------

loc_B84:				; CODE XREF: _get_encryption_params+15j
					; _get_encryption_params+2Aj
		mov	eax, offset off_8C
		retn
; ---------------------------------------------------------------------------

loc_B8A:				; CODE XREF: _get_encryption_params+6j
		push	eax
		call	_OBJ_obj2nid
		add	esp, 4
		mov	ecx, eax

loc_B95:				; CODE XREF: _get_encryption_params+39j
		cmp	off_84,	0
		mov	eax, offset _gost_cipher_list
		jz	short loc_BB0

loc_BA3:				; CODE XREF: _get_encryption_params+7Ej
		cmp	[eax], ecx
		jz	short loc_BB0
		add	eax, 0Ch
		cmp	dword ptr [eax+4], 0
		jnz	short loc_BA3

loc_BB0:				; CODE XREF: _get_encryption_params+71j
					; _get_encryption_params+75j
		cmp	dword ptr [eax+4], 0
		jnz	short locret_BCE
		push	0A0h ; '†'
		push	offset ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ ; ".\\engines\\ccgost\\gost_crypt.c"
		push	6Ah ; 'j'
		push	67h ; 'g'
		call	_ERR_GOST_error
		add	esp, 10h
		xor	eax, eax

locret_BCE:				; CODE XREF: _get_encryption_params+84j
		retn
_get_encryption_params endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0BD0h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


; int __cdecl gost_cipher_init_param(int, int, void *Src, int, int)
_gost_cipher_init_param	proc near	; CODE XREF: _gost_cipher_init+14p

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
Src		= dword	ptr  0Ch
arg_10		= dword	ptr  14h

		push	esi
		mov	esi, [esp+4+arg_0]
		push	edi
		cmp	dword ptr [esi+54h], 0
		mov	edi, [esi+60h]
		jnz	short loc_C23
		mov	eax, [esp+8+arg_10]
		test	eax, eax
		jz	short loc_BF0
		push	eax
		call	_OBJ_nid2obj
		add	esp, 4

loc_BF0:				; CODE XREF: _gost_cipher_init_param+15j
		push	eax
		call	_get_encryption_params
		add	esp, 4
		test	eax, eax
		jz	short loc_C73
		mov	ecx, [eax]
		mov	[edi], ecx
		mov	ecx, [eax+8]
		mov	[edi+8], ecx
		mov	dword ptr [edi+4], 0
		push	dword ptr [eax+4]
		lea	eax, [edi+0Ch]
		push	eax
		call	_gost_init
		mov	eax, [esi+60h]
		add	esp, 8
		mov	[esi+54h], eax

loc_C23:				; CODE XREF: _gost_cipher_init_param+Dj
		mov	eax, [esp+8+arg_4]
		test	eax, eax
		jz	short loc_C38
		push	eax
		lea	eax, [edi+0Ch]
		push	eax
		call	_gost_key
		add	esp, 8

loc_C38:				; CODE XREF: _gost_cipher_init_param+59j
		mov	edi, [esp+8+Src]
		test	edi, edi
		jz	short loc_C54
		push	esi
		call	_EVP_CIPHER_CTX_iv_length
		push	eax		; Size
		lea	eax, [esi+10h]
		push	edi		; Src
		push	eax		; Dst
		call	_memcpy
		add	esp, 10h

loc_C54:				; CODE XREF: _gost_cipher_init_param+6Ej
		push	esi
		call	_EVP_CIPHER_CTX_iv_length
		push	eax		; Size
		lea	eax, [esi+10h]
		push	eax		; Src
		lea	eax, [esi+20h]
		push	eax		; Dst
		call	_memcpy
		add	esp, 10h
		mov	eax, 1
		pop	edi
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_C73:				; CODE XREF: _gost_cipher_init_param+2Bj
		pop	edi
		xor	eax, eax
		pop	esi
		retn
_gost_cipher_init_param	endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0C78h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_cipher_set_param proc near	; CODE XREF: _gost89_get_asn1_parameters+7Ap

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_4]
		test	eax, eax
		jz	short loc_C89
		push	eax
		call	_OBJ_nid2obj
		add	esp, 4

loc_C89:				; CODE XREF: _gost_cipher_set_param+6j
		push	eax
		call	_get_encryption_params
		mov	edx, eax
		add	esp, 4
		test	edx, edx
		jnz	short loc_C99
		retn
; ---------------------------------------------------------------------------

loc_C99:				; CODE XREF: _gost_cipher_set_param+1Ej
		mov	ecx, [esp+arg_0]
		mov	eax, [edx]
		mov	[ecx], eax
		mov	eax, [edx+8]
		mov	[ecx+8], eax
		lea	eax, [ecx+0Ch]
		mov	dword ptr [ecx+4], 0
		push	dword ptr [edx+4]
		push	eax
		call	_gost_init
		add	esp, 8
		mov	eax, 1
		retn
_gost_cipher_set_param endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0CC4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_cnt_next	proc near		; CODE XREF: _gost_cipher_do_cnt+65p
					; _gost_cipher_do_cnt+ECp

var_C		= dword	ptr -0Ch
var_8		= dword	ptr -8
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch

		mov	eax, 0Ch
		call	__chkstk
		mov	eax, dword ptr ds:___security_cookie
		xor	eax, esp
		mov	[esp+0Ch+var_4], eax
		push	ebp
		mov	ebp, [esp+10h+arg_8]
		push	esi
		mov	esi, [esp+14h+arg_0]
		push	edi
		mov	edi, [esp+18h+arg_4]
		cmp	dword ptr [esi+8], 0
		jz	short loc_D04
		cmp	dword ptr [esi+4], 400h
		jnz	short loc_D04
		lea	eax, [esi+0Ch]
		push	edi
		push	eax
		call	_cryptopro_key_meshing
		add	esp, 8

loc_D04:				; CODE XREF: _gost_cnt_next+28j
					; _gost_cnt_next+31j
		cmp	dword ptr [esi+4], 0
		push	ebx
		jnz	short loc_D27
		lea	eax, [esp+1Ch+var_C]
		push	eax
		lea	eax, [esi+0Ch]
		push	edi
		push	eax
		call	_gostcrypt
		mov	edx, [esp+28h+var_8]
		add	esp, 0Ch
		mov	ebx, [esp+1Ch+var_C]
		jmp	short loc_D34
; ---------------------------------------------------------------------------

loc_D27:				; CODE XREF: _gost_cnt_next+45j
		mov	ebx, [edi]
		mov	edx, [edi+4]
		mov	[esp+1Ch+var_C], ebx
		mov	[esp+1Ch+var_8], edx

loc_D34:				; CODE XREF: _gost_cnt_next+61j
		mov	ecx, ebx
		mov	eax, ebx
		shr	ecx, 18h
		shl	ecx, 8
		shr	eax, 10h
		movzx	eax, al
		or	ecx, eax
		shr	ebx, 8
		shl	ecx, 8
		movzx	eax, bl
		or	ecx, eax
		movzx	eax, byte ptr [esp+1Ch+var_C]
		shl	ecx, 8
		or	ecx, eax
		add	ecx, 1010101h
		mov	eax, ecx
		mov	byte ptr [esp+1Ch+var_C], cl
		shr	eax, 8
		mov	byte ptr [esp+1Ch+var_C+1], al
		mov	eax, ecx
		shr	ecx, 18h
		shr	eax, 10h
		mov	byte ptr [esp+1Ch+var_C+3], cl
		mov	ecx, edx
		mov	byte ptr [esp+1Ch+var_C+2], al
		mov	eax, edx
		shr	ecx, 18h
		shl	ecx, 8
		shr	eax, 10h
		movzx	eax, al
		or	ecx, eax
		shr	edx, 8
		shl	ecx, 8
		movzx	eax, dl
		or	ecx, eax
		movzx	eax, byte ptr [esp+1Ch+var_8]
		shl	ecx, 8
		or	ecx, eax
		mov	eax, ecx
		add	ecx, 1010104h
		pop	ebx
		cmp	eax, ecx
		jbe	short loc_DB3
		inc	ecx

loc_DB3:				; CODE XREF: _gost_cnt_next+ECj
		mov	eax, ecx
		mov	byte ptr [esp+18h+var_8], cl
		shr	eax, 8
		mov	byte ptr [esp+18h+var_8+1], al
		mov	eax, ecx
		shr	eax, 10h
		mov	byte ptr [esp+18h+var_8+2], al
		mov	eax, [esp+18h+var_C]
		shr	ecx, 18h
		mov	[edi], eax
		mov	byte ptr [esp+18h+var_8+3], cl
		mov	eax, [esp+18h+var_8]
		mov	[edi+4], eax
		lea	eax, [esp+18h+var_C]
		push	ebp
		push	eax
		lea	eax, [esi+0Ch]
		push	eax
		call	_gostcrypt
		mov	eax, [esi+4]
		add	esp, 0Ch
		mov	ecx, [esp+18h+var_4]
		and	eax, 3FFh
		add	eax, 8
		mov	[esi+4], eax
		pop	edi
		pop	esi
		pop	ebp
		xor	ecx, esp
		call	@__security_check_cookie@4 ; __security_check_cookie(x)
		add	esp, 0Ch
		retn
_gost_cnt_next	endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0E10h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_gost_crypt_mesh proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch

		push	esi
		mov	esi, [esp+4+arg_0]
		cmp	dword ptr [esi+8], 0
		jz	short loc_E34
		cmp	dword ptr [esi+4], 400h
		jnz	short loc_E34
		push	[esp+4+arg_4]
		lea	eax, [esi+0Ch]
		push	eax
		call	_cryptopro_key_meshing
		add	esp, 8

loc_E34:				; CODE XREF: _gost_crypt_mesh+9j
					; _gost_crypt_mesh+12j
		push	[esp+4+arg_8]
		lea	eax, [esi+0Ch]
		push	[esp+8+arg_4]
		push	eax
		call	_gostcrypt
		mov	eax, [esi+4]
		add	esp, 0Ch
		and	eax, 3FFh
		add	eax, 8
		mov	[esi+4], eax
		pop	esi
		retn
_gost_crypt_mesh endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0E58h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_mac_block_mesh	proc near

var_C		= byte ptr -0Ch
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, 0Ch
		call	__chkstk
		mov	eax, dword ptr ds:___security_cookie
		xor	eax, esp
		mov	[esp+0Ch+var_4], eax
		push	esi
		mov	esi, [esp+10h+arg_0]
		push	edi
		mov	edi, [esp+14h+arg_4]
		cmp	dword ptr [esi+1034h], 0
		jz	short loc_E9A
		cmp	dword ptr [esi+1030h], 400h
		jnz	short loc_E9A
		lea	eax, [esp+14h+var_C]
		push	eax
		push	esi
		call	_cryptopro_key_meshing
		add	esp, 8

loc_E9A:				; CODE XREF: _mac_block_mesh+26j
					; _mac_block_mesh+32j
		push	edi
		lea	eax, [esi+1020h]
		push	eax
		push	esi
		call	_mac_block
		mov	eax, [esi+1030h]
		add	esp, 0Ch
		mov	ecx, [esp+14h+var_4]
		and	eax, 3FFh
		add	eax, 8
		mov	[esi+1030h], eax
		pop	edi
		pop	esi
		xor	ecx, esp
		call	@__security_check_cookie@4 ; __security_check_cookie(x)
		add	esp, 0Ch
		retn
_mac_block_mesh	endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure data
; Segment permissions: Read
_rdata		segment	dword public 'DATA' use32
		assume cs:_rdata
		;org 0ED0h
; COMDAT (pick any)
		public ??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@
; `string'
??_C@_0BO@PLCMDLO@?4?2engines?2ccgost?2gost_crypt?4c?$AA@ db '.\engines\ccgost\gost_crypt.c',0
					; DATA XREF: _gost89_set_asn1_parameters+2Co
					; _gost89_set_asn1_parameters+8Co ...
_rdata		ends

; ===========================================================================

; Segment type:	Externs
; UNDEF
		extrn _GostR3411_94_CryptoProParamSet:near ; DATA XREF:	.data:off_84o
		extrn _Gost28147_TestParamSet:near ; DATA XREF:	.data:000000C0o
		extrn _Gost28147_CryptoProParamSetA:near ; DATA	XREF: .data:00000090o
					; _gost_cipher_init_cpa+7o ...
		extrn _Gost28147_CryptoProParamSetB:near ; DATA	XREF: .data:0000009Co
		extrn _Gost28147_CryptoProParamSetC:near ; DATA	XREF: .data:000000A8o
		extrn _Gost28147_CryptoProParamSetD:near ; DATA	XREF: .data:000000B4o
		extrn _gostcrypt:near	; CODE XREF: _gost_cipher_do_cfb+B3p
					; _gost_cipher_do_cfb+1A0p ...
		extrn _gost_key:near	; CODE XREF: _gost_cipher_init_cpa+33p
					; _gost_imit_ctrl+3Cp ...
		extrn _gost_init:near	; CODE XREF: _gost_cipher_init_cpa+13p
					; _gost_imit_init_cpa+35p ...
		extrn _gost_destroy:near ; CODE	XREF: _gost_cipher_cleanup+Cp
		extrn _mac_block:near	; CODE XREF: _gost_imit_update+C0p
					; _gost_imit_update+11Cp ...
		extrn _get_mac:near	; CODE XREF: _gost_imit_final+10Ap
		extrn _cryptopro_key_meshing:near ; CODE XREF: _gost_cipher_do_cfb+9Bp
					; _gost_cipher_do_cfb+184p ...
		extrn _RAND_bytes:near	; CODE XREF: _gost_cipher_ctl+4Dp
		extrn _ERR_GOST_error:near ; CODE XREF:	_gost89_set_asn1_parameters+35p
					; _gost89_set_asn1_parameters+112p ...
		extrn _CRYPTO_malloc:near ; CODE XREF: _gost89_set_asn1_parameters+92p
		extrn _CRYPTO_free:near	; CODE XREF: _gost89_set_asn1_parameters+E0p
					; _gost89_set_asn1_parameters+FFp
		extrn _ASN1_TYPE_get:near ; CODE XREF: _gost89_get_asn1_parameters+Fp
		extrn _ASN1_TYPE_set:near ; CODE XREF: _gost89_set_asn1_parameters+ECp
		extrn _ASN1_OBJECT_free:near ; CODE XREF: _gost89_set_asn1_parameters+6Ep
		extrn _ASN1_OCTET_STRING_new:near
					; CODE XREF: _gost89_set_asn1_parameters+C5p
		extrn _ASN1_OCTET_STRING_set:near
					; CODE XREF: _gost89_set_asn1_parameters+4Fp
					; _gost89_set_asn1_parameters+D3p
		extrn _OBJ_nid2obj:near	; CODE XREF: _gost89_set_asn1_parameters+75p
					; _gost_cipher_init_param+18p ...
		extrn _OBJ_obj2nid:near	; CODE XREF: _gost89_get_asn1_parameters+73p
					; _get_encryption_params+5Bp
		extrn _OBJ_txt2nid:near	; CODE XREF: _get_encryption_params+2Dp
		extrn _EVP_CIPHER_CTX_iv_length:near ; CODE XREF: _gost_cipher_init_cpa+44p
					; _gost_cipher_init_cpa+58p ...
		extrn _get_gost_engine_param:near ; CODE XREF: _get_encryption_params+9p
		extrn _GOST_CIPHER_PARAMS_new:near
					; CODE XREF: _gost89_set_asn1_parameters+1Cp
		extrn _GOST_CIPHER_PARAMS_free:near
					; CODE XREF: _gost89_set_asn1_parameters+5Cp
					; _gost89_set_asn1_parameters+A5p ...
		extrn _d2i_GOST_CIPHER_PARAMS:near
					; CODE XREF: _gost89_get_asn1_parameters+37p
		extrn _i2d_GOST_CIPHER_PARAMS:near
					; CODE XREF: _gost89_set_asn1_parameters+80p
					; _gost89_set_asn1_parameters+B7p
; __fastcall __security_check_cookie(x)
		extrn @__security_check_cookie@4:near ;	CODE XREF: _gost_imit_update+51p
					; _gost_imit_update+173p ...
		extrn __chkstk:near	; CODE XREF: _gost89_set_asn1_parameters+5p
					; _gost_imit_update+5p	...
; void *__cdecl	memcpy(void *Dst, const	void *Src, size_t Size)
		extrn _memcpy:near	; CODE XREF: _gost_cipher_init_cpa+4Fp
					; _gost_cipher_init_cpa+66p ...
; void *__cdecl	memset(void *Dst, int Val, size_t Size)
		extrn _memset:near	; CODE XREF: _gost_imit_cleanup+Ep
		extrn ___security_cookie:near ;	DATA XREF: _gost_imit_update+Ar
					; _gost_imit_final+Ar ...


		end
