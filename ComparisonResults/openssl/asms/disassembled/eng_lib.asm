;
; +-------------------------------------------------------------------------+
; |   This file	has been generated by The Interactive Disassembler (IDA)    |
; |	      Copyright	(c) 2015 Hex-Rays, <support@hex-rays.com>	    |
; |			 License info: 48-3677-7074-51			    |
; |		Michalis Polychronakis,	Stony Brook University		    |
; +-------------------------------------------------------------------------+
;
; Input	MD5   :	886AA704428A1956345A0345400BB266
; Input	CRC32 :	17C374AD

; File Name   :	C:\compspace\Diff\openssl\obj\eng_lib.obj
; Format      :	COFF (X386MAGIC)
; includelib "MSVCRT"
; includelib "OLDNAMES"

		.686p
		.mmx
		.model flat

; ===========================================================================

; Segment type:	Uninitialized
; Segment permissions: Read/Write
_bss		segment	dword public 'BSS' use32
		assume cs:_bss
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing
_cleanup_stack	dd ?			; DATA XREF: _ENGINE_cleanupr
					; _ENGINE_cleanup+17w ...
_internal_static_hack dd ?		; DATA XREF: _ENGINE_get_static_stateo
_bss		ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 8
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_cleanup
_ENGINE_cleanup	proc near
		mov	eax, ds:_cleanup_stack
		test	eax, eax
		jz	short loc_29
		push	offset _engine_cleanup_cb_free
		push	eax
		call	_sk_pop_free
		add	esp, 8
		mov	ds:_cleanup_stack, 0

loc_29:					; CODE XREF: _ENGINE_cleanup+7j
		push	0
		call	_RAND_set_rand_method
		pop	ecx
		retn
_ENGINE_cleanup	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 34h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_free
_ENGINE_free	proc near

arg_0		= dword	ptr  4

		push	esi
		mov	esi, [esp+4+arg_0]
		test	esi, esi
		jnz	short loc_56
		push	70h ; 'p'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	43h ; 'C'
		push	6Ch ; 'l'
		push	26h ; '&'
		call	_ERR_put_error
		add	esp, 14h
		xor	eax, eax
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_56:					; CODE XREF: _ENGINE_free+7j
		push	74h ; 't'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	1Eh
		lea	eax, [esi+58h]
		push	0FFFFFFFFh
		push	eax
		call	_CRYPTO_add_lock
		add	esp, 14h
		test	eax, eax
		jg	short loc_A2
		push	esi
		call	_engine_pkey_meths_free
		push	esi
		call	_engine_pkey_asn1_meths_free
		mov	eax, [esi+34h]
		add	esp, 8
		test	eax, eax
		jz	short loc_8D
		push	esi
		call	eax
		add	esp, 4

loc_8D:					; CODE XREF: _ENGINE_free+51j
		lea	eax, [esi+60h]
		push	eax
		push	esi
		push	9
		call	_CRYPTO_free_ex_data
		push	esi
		call	_CRYPTO_free
		add	esp, 10h

loc_A2:					; CODE XREF: _ENGINE_free+3Bj
		mov	eax, 1
		pop	esi
		retn
_ENGINE_free	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0ACh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_cmd_defns
_ENGINE_get_cmd_defns proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+50h]
		retn
_ENGINE_get_cmd_defns endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0B4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_ctrl_function
_ENGINE_get_ctrl_function proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+40h]
		retn
_ENGINE_get_ctrl_function endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0BCh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_destroy_function
_ENGINE_get_destroy_function proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+34h]
		retn
_ENGINE_get_destroy_function endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0C4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_ex_data
_ENGINE_get_ex_data proc near

arg_0		= dword	ptr  4

		add	[esp+arg_0], 60h ; '`'
		jmp	_CRYPTO_get_ex_data
_ENGINE_get_ex_data endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0D0h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_ex_new_index
_ENGINE_get_ex_new_index proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch
arg_C		= dword	ptr  10h
arg_10		= dword	ptr  14h

		push	[esp+arg_10]
		push	[esp+4+arg_C]
		push	[esp+8+arg_8]
		push	[esp+0Ch+arg_4]
		push	[esp+10h+arg_0]
		push	9
		call	_CRYPTO_get_ex_new_index
		add	esp, 18h
		retn
_ENGINE_get_ex_new_index endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0F0h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_finish_function
_ENGINE_get_finish_function proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+3Ch]
		retn
_ENGINE_get_finish_function endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0F8h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_flags
_ENGINE_get_flags proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+54h]
		retn
_ENGINE_get_flags endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 100h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_id
_ENGINE_get_id	proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax]
		retn
_ENGINE_get_id	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 108h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_init_function
_ENGINE_get_init_function proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+38h]
		retn
_ENGINE_get_init_function endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 110h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_name
_ENGINE_get_name proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	eax, [eax+4]
		retn
_ENGINE_get_name endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 118h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_get_static_state
_ENGINE_get_static_state proc near
		mov	eax, offset _internal_static_hack
		retn
_ENGINE_get_static_state endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 120h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_new
_ENGINE_new	proc near
		push	esi
		push	45h ; 'E'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	70h ; 'p'
		call	_CRYPTO_malloc
		mov	esi, eax
		add	esp, 0Ch
		test	esi, esi
		jnz	short loc_151
		push	47h ; 'G'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	41h ; 'A'
		push	7Ah ; 'z'
		push	26h ; '&'
		call	_ERR_put_error
		add	esp, 14h
		xor	eax, eax
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_151:				; CODE XREF: _ENGINE_new+16j
		push	70h ; 'p'       ; Size
		push	0		; Val
		push	esi		; Dst
		call	_memset
		lea	eax, [esi+60h]
		mov	dword ptr [esi+58h], 1
		push	eax
		push	esi
		push	9
		call	_CRYPTO_new_ex_data
		add	esp, 18h
		mov	eax, esi
		pop	esi
		retn
_ENGINE_new	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 178h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_cmd_defns
_ENGINE_set_cmd_defns proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_0]
		mov	ecx, [esp+arg_4]
		mov	[eax+50h], ecx
		mov	eax, 1
		retn
_ENGINE_set_cmd_defns endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 18Ch
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_ctrl_function
_ENGINE_set_ctrl_function proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_0]
		mov	ecx, [esp+arg_4]
		mov	[eax+40h], ecx
		mov	eax, 1
		retn
_ENGINE_set_ctrl_function endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 1A0h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_destroy_function
_ENGINE_set_destroy_function proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_0]
		mov	ecx, [esp+arg_4]
		mov	[eax+34h], ecx
		mov	eax, 1
		retn
_ENGINE_set_destroy_function endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 1B4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_ex_data
_ENGINE_set_ex_data proc near

arg_0		= dword	ptr  4

		add	[esp+arg_0], 60h ; '`'
		jmp	_CRYPTO_set_ex_data
_ENGINE_set_ex_data endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 1C0h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_finish_function
_ENGINE_set_finish_function proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_0]
		mov	ecx, [esp+arg_4]
		mov	[eax+3Ch], ecx
		mov	eax, 1
		retn
_ENGINE_set_finish_function endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 1D4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_flags
_ENGINE_set_flags proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_0]
		mov	ecx, [esp+arg_4]
		mov	[eax+54h], ecx
		mov	eax, 1
		retn
_ENGINE_set_flags endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 1E8h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_id
_ENGINE_set_id	proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	ecx, [esp+arg_4]
		test	ecx, ecx
		jnz	short loc_20E
		push	0F4h ; 'Ù'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	43h ; 'C'
		push	81h ; 'Å'
		push	26h ; '&'
		call	_ERR_put_error
		add	esp, 14h
		xor	eax, eax
		retn
; ---------------------------------------------------------------------------

loc_20E:				; CODE XREF: _ENGINE_set_id+6j
		mov	eax, [esp+arg_0]
		mov	[eax], ecx
		mov	eax, 1
		retn
_ENGINE_set_id	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 21Ch
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_init_function
_ENGINE_set_init_function proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, [esp+arg_0]
		mov	ecx, [esp+arg_4]
		mov	[eax+38h], ecx
		mov	eax, 1
		retn
_ENGINE_set_init_function endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 230h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _ENGINE_set_name
_ENGINE_set_name proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	ecx, [esp+arg_4]
		test	ecx, ecx
		jnz	short loc_256
		push	0FEh ; '˛'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	43h ; 'C'
		push	82h ; 'Ç'
		push	26h ; '&'
		call	_ERR_put_error
		add	esp, 14h
		xor	eax, eax
		retn
; ---------------------------------------------------------------------------

loc_256:				; CODE XREF: _ENGINE_set_name+6j
		mov	eax, [esp+arg_0]
		mov	[eax+4], ecx
		mov	eax, 1
		retn
_ENGINE_set_name endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 264h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _engine_cleanup_add_first
_engine_cleanup_add_first proc near

arg_0		= dword	ptr  4

		cmp	ds:_cleanup_stack, 0
		jnz	short loc_282
		call	_sk_new_null
		xor	ecx, ecx
		mov	ds:_cleanup_stack, eax
		test	eax, eax
		setnz	cl
		test	ecx, ecx
		jz	short locret_2B1

loc_282:				; CODE XREF: _engine_cleanup_add_first+7j
		push	0A8h ; '®'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	4
		call	_CRYPTO_malloc
		add	esp, 0Ch
		test	eax, eax
		jz	short locret_2B1
		mov	ecx, [esp+arg_0]
		push	0
		push	eax
		push	ds:_cleanup_stack
		mov	[eax], ecx
		call	_sk_insert
		add	esp, 0Ch

locret_2B1:				; CODE XREF: _engine_cleanup_add_first+1Cj
					; _engine_cleanup_add_first+34j
		retn
_engine_cleanup_add_first endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 2B4h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _engine_cleanup_add_last
_engine_cleanup_add_last proc near

arg_0		= dword	ptr  4

		cmp	ds:_cleanup_stack, 0
		jnz	short loc_2D2
		call	_sk_new_null
		xor	ecx, ecx
		mov	ds:_cleanup_stack, eax
		test	eax, eax
		setnz	cl
		test	ecx, ecx
		jz	short locret_2FF

loc_2D2:				; CODE XREF: _engine_cleanup_add_last+7j
		push	0A8h ; '®'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	4
		call	_CRYPTO_malloc
		add	esp, 0Ch
		test	eax, eax
		jz	short locret_2FF
		mov	ecx, [esp+arg_0]
		push	eax
		push	ds:_cleanup_stack
		mov	[eax], ecx
		call	_sk_push
		add	esp, 8

locret_2FF:				; CODE XREF: _engine_cleanup_add_last+1Cj
					; _engine_cleanup_add_last+34j
		retn
_engine_cleanup_add_last endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 300h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_engine_cleanup_cb_free	proc near	; DATA XREF: _ENGINE_cleanup+9o

arg_0		= dword	ptr  4

		push	esi
		mov	esi, [esp+4+arg_0]
		mov	eax, [esi]
		call	eax
		push	esi
		call	_CRYPTO_free
		add	esp, 4
		pop	esi
		retn
_engine_cleanup_cb_free	endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 314h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _engine_free_util
_engine_free_util proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		push	esi
		mov	esi, [esp+4+arg_0]
		test	esi, esi
		jnz	short loc_336
		push	70h ; 'p'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	43h ; 'C'
		push	6Ch ; 'l'
		push	26h ; '&'
		call	_ERR_put_error
		add	esp, 14h
		xor	eax, eax
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_336:				; CODE XREF: _engine_free_util+7j
		cmp	[esp+4+arg_4], 0
		jz	short loc_356
		push	74h ; 't'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	1Eh
		lea	eax, [esi+58h]
		push	0FFFFFFFFh
		push	eax
		call	_CRYPTO_add_lock
		add	esp, 14h
		jmp	short loc_35C
; ---------------------------------------------------------------------------

loc_356:				; CODE XREF: _engine_free_util+27j
		dec	dword ptr [esi+58h]
		mov	eax, [esi+58h]

loc_35C:				; CODE XREF: _engine_free_util+40j
		test	eax, eax
		jg	short loc_391
		push	esi
		call	_engine_pkey_meths_free
		push	esi
		call	_engine_pkey_asn1_meths_free
		mov	eax, [esi+34h]
		add	esp, 8
		test	eax, eax
		jz	short loc_37C
		push	esi
		call	eax
		add	esp, 4

loc_37C:				; CODE XREF: _engine_free_util+60j
		lea	eax, [esi+60h]
		push	eax
		push	esi
		push	9
		call	_CRYPTO_free_ex_data
		push	esi
		call	_CRYPTO_free
		add	esp, 10h

loc_391:				; CODE XREF: _engine_free_util+4Aj
		mov	eax, 1
		pop	esi
		retn
_engine_free_util endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 398h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _engine_set_all_null
_engine_set_all_null proc near

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	dword ptr [eax], 0
		mov	dword ptr [eax+4], 0
		mov	dword ptr [eax+8], 0
		mov	dword ptr [eax+0Ch], 0
		mov	dword ptr [eax+10h], 0
		mov	dword ptr [eax+1Ch], 0
		mov	dword ptr [eax+20h], 0
		mov	dword ptr [eax+24h], 0
		mov	dword ptr [eax+28h], 0
		mov	dword ptr [eax+34h], 0
		mov	dword ptr [eax+38h], 0
		mov	dword ptr [eax+3Ch], 0
		mov	dword ptr [eax+40h], 0
		mov	dword ptr [eax+44h], 0
		mov	dword ptr [eax+48h], 0
		mov	dword ptr [eax+50h], 0
		mov	dword ptr [eax+54h], 0
		retn
_engine_set_all_null endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 414h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_int_cleanup_check proc	near

arg_0		= dword	ptr  4

		cmp	ds:_cleanup_stack, 0
		jz	short loc_423
		mov	eax, 1
		retn
; ---------------------------------------------------------------------------

loc_423:				; CODE XREF: _int_cleanup_check+7j
		cmp	[esp+arg_0], 0
		jnz	short loc_42D
		xor	eax, eax
		retn
; ---------------------------------------------------------------------------

loc_42D:				; CODE XREF: _int_cleanup_check+14j
		call	_sk_new_null
		xor	ecx, ecx
		mov	ds:_cleanup_stack, eax
		test	eax, eax
		setnz	cl
		mov	eax, ecx
		retn
_int_cleanup_check endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 444h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_int_cleanup_item proc near

arg_0		= dword	ptr  4

		push	0A8h ; '®'
		push	offset ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ ;	".\\crypto\\engine\\eng_lib.c"
		push	4
		call	_CRYPTO_malloc
		mov	ecx, eax
		add	esp, 0Ch
		test	ecx, ecx
		jnz	short loc_45F
		retn
; ---------------------------------------------------------------------------

loc_45F:				; CODE XREF: _int_cleanup_item+18j
		mov	eax, [esp+arg_0]
		mov	[ecx], eax
		mov	eax, ecx
		retn
_int_cleanup_item endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure data
; Segment permissions: Read
_rdata		segment	dword public 'DATA' use32
		assume cs:_rdata
		;org 468h
; COMDAT (pick any)
		public ??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@
; `string'
??_C@_0BK@FPJBMICP@?4?2crypto?2engine?2eng_lib?4c?$AA@ db '.\crypto\engine\eng_lib.c',0
					; DATA XREF: _ENGINE_free+Bo
					; _ENGINE_free+24o ...
_rdata		ends

; ===========================================================================

; Segment type:	Externs
; UNDEF
		extrn _sk_new_null:near	; CODE XREF: _engine_cleanup_add_first+9p
					; _engine_cleanup_add_last+9p ...
		extrn _sk_pop_free:near	; CODE XREF: _ENGINE_cleanup+Fp
		extrn _sk_insert:near	; CODE XREF: _engine_cleanup_add_first+45p
		extrn _sk_push:near	; CODE XREF: _engine_cleanup_add_last+43p
		extrn _CRYPTO_get_ex_new_index:near
					; CODE XREF: _ENGINE_get_ex_new_index+16p
		extrn _CRYPTO_new_ex_data:near ; CODE XREF: _ENGINE_new+49p
		extrn _CRYPTO_free_ex_data:near	; CODE XREF: _ENGINE_free+60p
					; _engine_free_util+6Fp
		extrn _CRYPTO_set_ex_data:near ; CODE XREF: _ENGINE_set_ex_data+5j
		extrn _CRYPTO_get_ex_data:near ; CODE XREF: _ENGINE_get_ex_data+5j
		extrn _CRYPTO_add_lock:near ; CODE XREF: _ENGINE_free+31p
					; _engine_free_util+38p
		extrn _CRYPTO_malloc:near ; CODE XREF: _ENGINE_new+Ap
					; _engine_cleanup_add_first+2Ap ...
		extrn _CRYPTO_free:near	; CODE XREF: _ENGINE_free+66p
					; _engine_cleanup_cb_free+Ap ...
		extrn _ERR_put_error:near ; CODE XREF: _ENGINE_free+16p
					; _ENGINE_new+25p ...
		extrn _RAND_set_rand_method:near ; CODE	XREF: _ENGINE_cleanup+23p
		extrn _engine_pkey_meths_free:near ; CODE XREF:	_ENGINE_free+3Ep
					; _engine_free_util+4Dp
		extrn _engine_pkey_asn1_meths_free:near	; CODE XREF: _ENGINE_free+44p
					; _engine_free_util+53p
; void *__cdecl	memset(void *Dst, int Val, size_t Size)
		extrn _memset:near	; CODE XREF: _ENGINE_new+36p


		end
