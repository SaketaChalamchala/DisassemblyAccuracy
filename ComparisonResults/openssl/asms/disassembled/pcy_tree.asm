;
; +-------------------------------------------------------------------------+
; |   This file	has been generated by The Interactive Disassembler (IDA)    |
; |	      Copyright	(c) 2015 Hex-Rays, <support@hex-rays.com>	    |
; |			 License info: 48-3677-7074-51			    |
; |		Michalis Polychronakis,	Stony Brook University		    |
; +-------------------------------------------------------------------------+
;
; Input	MD5   :	01DBD9EF2841B7A24CD66C4B76C7F215
; Input	CRC32 :	9A64A10D

; File Name   :	C:\compspace\Diff\openssl\obj\pcy_tree.obj
; Format      :	COFF (X386MAGIC)
; includelib "MSVCRT"
; includelib "OLDNAMES"

		.686p
		.mmx
		.model flat

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _X509_policy_check
_X509_policy_check proc	near

var_8		= dword	ptr -8
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch
arg_C		= dword	ptr  10h
arg_10		= dword	ptr  14h

		mov	eax, 8
		call	__chkstk
		mov	eax, [esp+8+arg_0]
		push	ebx
		push	esi
		push	edi
		push	[esp+14h+arg_10]
		mov	edi, [esp+18h+arg_4]
		push	[esp+18h+arg_8]
		mov	dword ptr [eax], 0
		lea	eax, [esp+1Ch+var_8]
		push	eax
		mov	[esp+20h+var_8], 0
		mov	[esp+20h+var_4], 0
		mov	dword ptr [edi], 0
		call	_tree_init
		inc	eax
		add	esp, 0Ch
		cmp	eax, 7		; switch 8 cases
		ja	short $LN10	; jumptable 0000004C default case
		jmp	ds:$LN25[eax*4]	; switch jump
; ---------------------------------------------------------------------------

$LN4:					; CODE XREF: _X509_policy_check+4Cj
					; _X509_policy_check+11Cj ...
		pop	edi		; jumptable 0000004C case 3
		pop	esi
		mov	eax, 1
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

$LN5:					; CODE XREF: _X509_policy_check+4Cj
					; DATA XREF: .text$mn:$LN25o
		pop	edi		; jumptable 0000004C case 0
		pop	esi
		or	eax, 0FFFFFFFFh
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

$LN7:					; CODE XREF: _X509_policy_check+4Cj
					; DATA XREF: .text$mn:$LN25o
		mov	dword ptr [edi], 1 ; jumptable 0000004C	case 7
		mov	eax, 0FFFFFFFEh
		pop	edi
		pop	esi
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

$LN8:					; CODE XREF: _X509_policy_check+4Cj
					; DATA XREF: .text$mn:$LN25o
		mov	dword ptr [edi], 1 ; jumptable 0000004C	case 6

$LN10:					; CODE XREF: _X509_policy_check+4Aj
					; _X509_policy_check+4Cj
					; DATA XREF: ...
		mov	esi, [esp+14h+var_8] ; jumptable 0000004C default case
		test	esi, esi
		jz	$error$26

loc_8D:					; CODE XREF: _X509_policy_check+C9j
		push	esi
		call	_tree_evaluate
		add	esp, 4
		test	eax, eax
		jle	$error$26
		cmp	eax, 2
		jnz	short loc_D5
		push	esi
		call	_X509_policy_tree_free
		add	esp, 4
		mov	eax, 1
		cmp	dword ptr [edi], 0
		mov	ecx, 0FFFFFFFEh
		cmovnz	eax, ecx
		pop	edi
		pop	esi
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

$LN9:					; CODE XREF: _X509_policy_check+4Cj
					; DATA XREF: .text$mn:$LN25o
		mov	esi, [esp+14h+var_8] ; jumptable 0000004C case 2
		test	esi, esi
		jnz	short loc_8D
		pop	edi
		lea	eax, [esi+1]
		pop	esi
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

loc_D5:					; CODE XREF: _X509_policy_check+A1j
		lea	eax, [esp+14h+var_4]
		push	eax
		push	esi
		call	_tree_calculate_authority_set
		mov	ebx, eax
		add	esp, 8
		test	ebx, ebx
		jz	short $error$26
		push	[esp+14h+var_4]
		push	[esp+18h+arg_C]
		push	esi
		call	_tree_calculate_user_set
		add	esp, 0Ch
		test	eax, eax
		jz	short $error$26
		cmp	ebx, 2
		jnz	short loc_10F
		push	[esp+14h+var_4]
		call	_sk_free
		add	esp, 4

loc_10F:				; CODE XREF: _X509_policy_check+101j
		test	esi, esi
		jz	short loc_119
		mov	eax, [esp+14h+arg_0]
		mov	[eax], esi

loc_119:				; CODE XREF: _X509_policy_check+111j
		cmp	dword ptr [edi], 0
		jz	$LN4		; jumptable 0000004C case 3
		push	esi
		call	_X509_policy_tree_get0_user_policies
		push	eax
		call	_sk_num
		add	esp, 8
		test	eax, eax
		jg	$LN4		; jumptable 0000004C case 3
		pop	edi
		pop	esi
		mov	eax, 0FFFFFFFEh
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

$error$26:				; CODE XREF: _X509_policy_check+87j
					; _X509_policy_check+98j ...
		push	esi
		call	_X509_policy_tree_free
		add	esp, 4

$LN6:					; CODE XREF: _X509_policy_check+4Cj
					; DATA XREF: .text$mn:$LN25o
		pop	edi		; jumptable 0000004C case 1
		pop	esi
		xor	eax, eax
		pop	ebx
		add	esp, 8
		retn
_X509_policy_check endp

; ---------------------------------------------------------------------------
		align 4
$LN25		dd offset $LN5		; DATA XREF: _X509_policy_check+4Cr
		dd offset $LN6		; jump table for switch	statement
		dd offset $LN9
		dd offset $LN4
		dd offset $LN10
		dd offset $LN10
		dd offset $LN8
		dd offset $LN7
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 178h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public _X509_policy_tree_free
_X509_policy_tree_free proc near	; CODE XREF: _X509_policy_check+A4p
					; _X509_policy_check+146p ...

arg_0		= dword	ptr  4

		push	edi
		mov	edi, [esp+4+arg_0]
		test	edi, edi
		jz	loc_20C
		push	ebx
		push	esi
		push	dword ptr [edi+0Ch]
		call	_sk_free
		push	offset _exnode_free
		push	dword ptr [edi+10h]
		call	_sk_pop_free
		mov	esi, [edi]
		xor	ebx, ebx
		add	esp, 0Ch
		cmp	[edi+4], ebx
		jle	short loc_1E5

loc_1A8:				; CODE XREF: _X509_policy_tree_free+6Bj
		mov	eax, [esi]
		test	eax, eax
		jz	short loc_1B7
		push	eax
		call	_X509_free
		add	esp, 4

loc_1B7:				; CODE XREF: _X509_policy_tree_free+34j
		mov	eax, [esi+4]
		test	eax, eax
		jz	short loc_1CC
		push	offset _policy_node_free
		push	eax
		call	_sk_pop_free
		add	esp, 8

loc_1CC:				; CODE XREF: _X509_policy_tree_free+44j
		mov	eax, [esi+8]
		test	eax, eax
		jz	short loc_1DC
		push	eax
		call	_policy_node_free
		add	esp, 4

loc_1DC:				; CODE XREF: _X509_policy_tree_free+59j
		inc	ebx
		add	esi, 10h
		cmp	ebx, [edi+4]
		jl	short loc_1A8

loc_1E5:				; CODE XREF: _X509_policy_tree_free+2Ej
		mov	eax, [edi+8]
		pop	esi
		pop	ebx
		test	eax, eax
		jz	short loc_1FC
		push	offset _policy_data_free
		push	eax
		call	_sk_pop_free
		add	esp, 8

loc_1FC:				; CODE XREF: _X509_policy_tree_free+74j
		push	dword ptr [edi]
		call	_CRYPTO_free
		push	edi
		call	_CRYPTO_free
		add	esp, 8

loc_20C:				; CODE XREF: _X509_policy_tree_free+7j
		pop	edi
		retn
_X509_policy_tree_free endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 210h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_exnode_free	proc near		; DATA XREF: _X509_policy_tree_free+17o

arg_0		= dword	ptr  4

		mov	eax, [esp+arg_0]
		mov	ecx, [eax]
		test	ecx, ecx
		jz	short locret_228
		test	byte ptr [ecx],	8
		jz	short locret_228
		mov	[esp+arg_0], eax
		jmp	_CRYPTO_free
; ---------------------------------------------------------------------------

locret_228:				; CODE XREF: _exnode_free+8j
					; _exnode_free+Dj
		retn
_exnode_free	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 22Ch
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_add_auth_node proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		push	esi
		mov	esi, [esp+4+arg_0]
		mov	eax, [esi]
		test	eax, eax
		jnz	short loc_244
		call	_policy_node_cmp_new
		mov	[esi], eax
		test	eax, eax
		jnz	short loc_25D
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_244:				; CODE XREF: _tree_add_auth_node+9j
		push	[esp+4+arg_4]
		push	eax
		call	_sk_find
		add	esp, 8
		cmp	eax, 0FFFFFFFFh
		jz	short loc_25D
		mov	eax, 1
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_25D:				; CODE XREF: _tree_add_auth_node+14j
					; _tree_add_auth_node+28j
		push	[esp+4+arg_4]
		push	dword ptr [esi]
		call	_sk_push
		add	esp, 8
		neg	eax
		sbb	eax, eax
		neg	eax
		pop	esi
		retn
_tree_add_auth_node endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 274h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_add_unmatched proc near		; CODE XREF: _tree_link_unmatched+68p

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch
arg_C		= dword	ptr  10h
arg_10		= dword	ptr  14h

		mov	ecx, [esp+arg_8]
		push	esi
		push	edi
		mov	edi, [esp+8+arg_C]
		test	ecx, ecx
		jnz	short loc_287
		mov	eax, [edi]
		mov	ecx, [eax+4]

loc_287:				; CODE XREF: _tree_add_unmatched+Cj
		mov	eax, [edi]
		mov	eax, [eax]
		and	eax, 10h
		push	eax
		push	ecx
		push	0
		call	_policy_data_new
		mov	esi, eax
		add	esp, 0Ch
		test	esi, esi
		jz	short loc_2CE
		mov	eax, [esp+8+arg_4]
		push	[esp+8+arg_10]
		push	edi
		mov	eax, [eax]
		push	esi
		push	[esp+14h+arg_0]
		mov	eax, [eax+8]
		or	dword ptr [esi], 4
		mov	[esi+8], eax
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jnz	short loc_2D3
		push	esi
		call	_policy_data_free
		add	esp, 4

loc_2CE:				; CODE XREF: _tree_add_unmatched+2Aj
		pop	edi
		xor	eax, eax
		pop	esi
		retn
; ---------------------------------------------------------------------------

loc_2D3:				; CODE XREF: _tree_add_unmatched+4Fj
		pop	edi
		mov	eax, 1
		pop	esi
		retn
_tree_add_unmatched endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 2DCh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_calculate_authority_set proc near	; CODE XREF: _X509_policy_check+DBp

var_C		= dword	ptr -0Ch
var_8		= dword	ptr -8
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, 0Ch
		call	__chkstk
		push	ebx
		push	esi
		push	edi
		mov	edi, [esp+18h+arg_0]
		mov	ecx, [edi+4]
		mov	eax, [edi]
		add	ecx, ecx
		mov	esi, [eax+ecx*8-8]
		test	esi, esi
		jz	short loc_344
		mov	eax, [edi+0Ch]
		lea	ebx, [edi+0Ch]
		mov	[esp+18h+var_8], ebx
		test	eax, eax
		jnz	short loc_317
		call	_policy_node_cmp_new
		mov	[ebx], eax
		test	eax, eax
		jz	short loc_335
		jmp	short loc_326
; ---------------------------------------------------------------------------

loc_317:				; CODE XREF: _tree_calculate_authority_set+2Cj
		push	esi
		push	eax
		call	_sk_find
		add	esp, 8
		cmp	eax, 0FFFFFFFFh
		jnz	short loc_33E

loc_326:				; CODE XREF: _tree_calculate_authority_set+39j
		push	esi
		push	dword ptr [ebx]
		call	_sk_push
		add	esp, 8
		test	eax, eax
		jnz	short loc_33E

loc_335:				; CODE XREF: _tree_calculate_authority_set+37j
		pop	edi
		pop	esi
		xor	eax, eax
		pop	ebx
		add	esp, 0Ch
		retn
; ---------------------------------------------------------------------------

loc_33E:				; CODE XREF: _tree_calculate_authority_set+48j
					; _tree_calculate_authority_set+57j
		mov	ebx, [esp+18h+arg_4]
		jmp	short loc_34D
; ---------------------------------------------------------------------------

loc_344:				; CODE XREF: _tree_calculate_authority_set+1Ej
		lea	eax, [edi+0Ch]
		mov	[esp+18h+var_8], eax
		mov	ebx, eax

loc_34D:				; CODE XREF: _tree_calculate_authority_set+66j
		cmp	dword ptr [edi+4], 1
		push	ebp
		mov	ebp, [edi]
		mov	[esp+1Ch+var_C], 1
		jle	loc_405
		add	ebp, 4
		nop	dword ptr [eax+00000000h]

loc_36C:				; CODE XREF: _tree_calculate_authority_set+123j
		mov	eax, [ebp+4]
		mov	[esp+1Ch+var_4], eax
		test	eax, eax
		jz	loc_405
		push	dword ptr [ebp+10h]
		add	ebp, 10h
		xor	esi, esi
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	short loc_3F3

loc_38F:				; CODE XREF: _tree_calculate_authority_set+111j
		push	esi
		push	dword ptr [ebp+0]
		call	_sk_value
		mov	edi, eax
		add	esp, 8
		mov	eax, [esp+1Ch+var_4]
		cmp	[edi+4], eax
		jnz	short loc_3DF
		mov	ecx, [ebx]
		test	ecx, ecx
		jnz	short loc_3C1
		call	_policy_node_cmp_new
		mov	[ebx], eax
		test	eax, eax
		jnz	short loc_3D0

loc_3B7:				; CODE XREF: _tree_calculate_authority_set+101j
		pop	ebp
		pop	edi
		pop	esi
		xor	eax, eax
		pop	ebx
		add	esp, 0Ch
		retn
; ---------------------------------------------------------------------------

loc_3C1:				; CODE XREF: _tree_calculate_authority_set+CEj
		push	edi
		push	ecx
		call	_sk_find
		add	esp, 8
		cmp	eax, 0FFFFFFFFh
		jnz	short loc_3DF

loc_3D0:				; CODE XREF: _tree_calculate_authority_set+D9j
		push	edi
		push	dword ptr [ebx]
		call	_sk_push
		add	esp, 8
		test	eax, eax
		jz	short loc_3B7

loc_3DF:				; CODE XREF: _tree_calculate_authority_set+C8j
					; _tree_calculate_authority_set+F2j
		push	dword ptr [ebp+0]
		inc	esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	short loc_38F
		mov	edi, [esp+1Ch+arg_0]

loc_3F3:				; CODE XREF: _tree_calculate_authority_set+B1j
		mov	ecx, [esp+1Ch+var_C]
		inc	ecx
		mov	[esp+1Ch+var_C], ecx
		cmp	ecx, [edi+4]
		jl	loc_36C

loc_405:				; CODE XREF: _tree_calculate_authority_set+80j
					; _tree_calculate_authority_set+99j
		mov	ecx, [esp+1Ch+arg_4]
		cmp	ebx, ecx
		jnz	short loc_41A
		pop	ebp
		pop	edi
		pop	esi
		mov	eax, 2
		pop	ebx
		add	esp, 0Ch
		retn
; ---------------------------------------------------------------------------

loc_41A:				; CODE XREF: _tree_calculate_authority_set+12Fj
		mov	eax, [esp+1Ch+var_8]
		pop	ebp
		pop	edi
		pop	esi
		mov	eax, [eax]
		mov	[ecx], eax
		mov	eax, 1
		pop	ebx
		add	esp, 0Ch
		retn
_tree_calculate_authority_set endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 430h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_calculate_user_set proc near	; CODE XREF: _X509_policy_check+F2p

var_8		= dword	ptr -8
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch

		mov	eax, 8
		call	__chkstk
		push	edi
		mov	edi, [esp+0Ch+arg_4]
		push	edi
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jg	short loc_456
		mov	eax, 1
		pop	edi
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

loc_456:				; CODE XREF: _tree_calculate_user_set+1Aj
		push	ebx
		mov	ebx, [esp+10h+arg_0]
		push	esi
		push	edi
		xor	esi, esi
		mov	ecx, [ebx+4]
		mov	eax, [ebx]
		add	ecx, ecx
		mov	eax, [eax+ecx*8-8]
		mov	[esp+18h+var_8], eax
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	short loc_4A9
		nop	word ptr [eax+eax+00h]

loc_480:				; CODE XREF: _tree_calculate_user_set+77j
		push	esi
		push	edi
		call	_sk_value
		push	eax
		call	_OBJ_obj2nid
		add	esp, 0Ch
		cmp	eax, 2EAh
		jz	loc_562
		push	edi
		inc	esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	short loc_480

loc_4A9:				; CODE XREF: _tree_calculate_user_set+48j
		push	ebp
		push	edi
		xor	esi, esi
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	loc_555
		nop	dword ptr [eax]

loc_4C0:				; CODE XREF: _tree_calculate_user_set+11Fj
		push	esi
		push	edi
		call	_sk_value
		push	eax
		push	[esp+24h+arg_8]
		mov	[esp+28h+var_4], eax
		call	_tree_find_sk
		mov	ebp, eax
		add	esp, 10h
		test	ebp, ebp
		jnz	short loc_521
		mov	ebp, [esp+18h+var_8]
		test	ebp, ebp
		jz	short loc_543
		mov	eax, [ebp+0]
		mov	eax, [eax]
		and	eax, 10h
		push	eax
		push	[esp+1Ch+var_4]
		push	0
		call	_policy_data_new
		add	esp, 0Ch
		test	eax, eax
		jz	short loc_572
		mov	ecx, [ebp+0]
		push	ebx
		mov	ecx, [ecx+8]
		mov	[eax+8], ecx
		mov	dword ptr [eax], 0Ch
		push	dword ptr [ebp+4]
		push	eax
		push	0
		call	_level_add_node
		add	esp, 10h
		mov	ebp, eax

loc_521:				; CODE XREF: _tree_calculate_user_set+ACj
		cmp	dword ptr [ebx+10h], 0
		jnz	short loc_533
		call	_sk_new_null
		mov	[ebx+10h], eax
		test	eax, eax
		jz	short loc_555

loc_533:				; CODE XREF: _tree_calculate_user_set+F5j
		push	ebp
		push	dword ptr [ebx+10h]
		call	_sk_push
		add	esp, 8
		test	eax, eax
		jz	short loc_572

loc_543:				; CODE XREF: _tree_calculate_user_set+B4j
		push	edi
		inc	esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	loc_4C0

loc_555:				; CODE XREF: _tree_calculate_user_set+87j
					; _tree_calculate_user_set+101j
		pop	ebp
		pop	esi
		pop	ebx
		mov	eax, 1
		pop	edi
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

loc_562:				; CODE XREF: _tree_calculate_user_set+65j
		or	dword ptr [ebx+14h], 2
		mov	eax, 1
		pop	esi
		pop	ebx
		pop	edi
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

loc_572:				; CODE XREF: _tree_calculate_user_set+CFj
					; _tree_calculate_user_set+111j
		pop	ebp
		pop	esi
		pop	ebx
		xor	eax, eax
		pop	edi
		add	esp, 8
		retn
_tree_calculate_user_set endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 57Ch
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_evaluate	proc near		; CODE XREF: _X509_policy_check+8Ep

arg_0		= dword	ptr  4

		push	ebx
		push	ebp
		push	esi
		push	edi
		mov	edi, [esp+10h+arg_0]
		mov	ebx, 1
		mov	esi, [edi]
		add	esi, 10h
		cmp	[edi+4], ebx
		jle	short loc_5DA

loc_593:				; CODE XREF: _tree_evaluate+5Cj
		push	dword ptr [esi]
		call	_policy_cache_set
		mov	ebp, eax
		push	ebp
		push	esi
		call	_tree_link_nodes
		add	esp, 0Ch
		test	eax, eax
		jz	short loc_5E4
		test	dword ptr [esi+0Ch], 200h
		jnz	short loc_5C2
		push	edi
		push	ebp
		push	esi
		call	_tree_link_any
		add	esp, 0Ch
		test	eax, eax
		jz	short loc_5E4

loc_5C2:				; CODE XREF: _tree_evaluate+35j
		push	esi
		push	edi
		call	_tree_prune
		add	esp, 8
		cmp	eax, 1
		jnz	short loc_5DF
		inc	ebx
		add	esi, 10h
		cmp	ebx, [edi+4]
		jl	short loc_593

loc_5DA:				; CODE XREF: _tree_evaluate+15j
		mov	eax, 1

loc_5DF:				; CODE XREF: _tree_evaluate+53j
		pop	edi
		pop	esi
		pop	ebp
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_5E4:				; CODE XREF: _tree_evaluate+2Cj
					; _tree_evaluate+44j
		pop	edi
		pop	esi
		pop	ebp
		xor	eax, eax
		pop	ebx
		retn
_tree_evaluate	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 5ECh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_init	proc near		; CODE XREF: _X509_policy_check+3Ep

var_14		= dword	ptr -14h
var_10		= dword	ptr -10h
var_C		= dword	ptr -0Ch
var_8		= dword	ptr -8
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch

		mov	eax, 14h
		call	__chkstk
		mov	eax, [esp+14h+arg_0]
		push	ebx
		push	ebp
		push	esi
		push	edi
		push	[esp+24h+arg_4]
		mov	esi, 1
		mov	dword ptr [eax], 0
		call	_sk_num
		mov	ecx, [esp+28h+arg_8]
		add	esp, 4
		mov	edi, eax
		mov	[esp+24h+var_C], edi
		test	ecx, 100h
		jz	short loc_62B
		xor	ebp, ebp
		jmp	short loc_62E
; ---------------------------------------------------------------------------

loc_62B:				; CODE XREF: _tree_init+39j
		lea	ebp, [edi+1]

loc_62E:				; CODE XREF: _tree_init+3Dj
		mov	[esp+24h+var_14], ebp
		test	ecx, 200h
		jz	short loc_63E
		xor	eax, eax
		jmp	short loc_641
; ---------------------------------------------------------------------------

loc_63E:				; CODE XREF: _tree_init+4Cj
		lea	eax, [edi+1]

loc_641:				; CODE XREF: _tree_init+50j
		mov	[esp+24h+var_8], eax
		test	ecx, 400h
		jz	short loc_651
		xor	ebx, ebx
		jmp	short loc_654
; ---------------------------------------------------------------------------

loc_651:				; CODE XREF: _tree_init+5Fj
		lea	ebx, [edi+1]

loc_654:				; CODE XREF: _tree_init+63j
		cmp	edi, 1
		jnz	short loc_663

loc_659:				; CODE XREF: _tree_init+10Cj
					; _tree_init+114j
		pop	edi
		mov	eax, esi
		pop	esi
		pop	ebp
		pop	ebx
		add	esp, 14h
		retn
; ---------------------------------------------------------------------------

loc_663:				; CODE XREF: _tree_init+6Bj
		lea	ecx, [edi-2]
		mov	eax, ecx
		mov	[esp+24h+arg_8], ecx
		mov	[esp+24h+var_10], eax
		test	eax, eax
		js	loc_715
		nop	dword ptr [eax+00h]

loc_67C:				; CODE XREF: _tree_init+102j
		push	eax
		push	[esp+28h+arg_4]
		call	_sk_value
		push	0FFFFFFFFh
		mov	edi, eax
		push	0FFFFFFFFh
		push	edi
		call	_X509_check_purpose
		push	edi
		call	_policy_cache_set
		mov	ecx, eax
		add	esp, 18h
		test	ecx, ecx
		jz	loc_8BF
		mov	eax, [edi+28h]
		test	eax, 800h
		jz	short loc_6B4
		or	esi, 0FFFFFFFFh
		jmp	short loc_6C5
; ---------------------------------------------------------------------------

loc_6B4:				; CODE XREF: _tree_init+C1j
		cmp	esi, 1
		jnz	short loc_6C5
		cmp	dword ptr [ecx+4], 0
		mov	edx, 2
		cmovz	esi, edx

loc_6C5:				; CODE XREF: _tree_init+C6j
					; _tree_init+CBj
		test	ebp, ebp
		jle	short loc_6E3
		test	al, 20h
		jnz	short loc_6D2
		dec	ebp
		mov	[esp+24h+var_14], ebp

loc_6D2:				; CODE XREF: _tree_init+DFj
		mov	eax, [ecx+0Ch]
		cmp	eax, 0FFFFFFFFh
		jz	short loc_6E3
		cmp	eax, ebp
		cmovl	ebp, eax
		mov	[esp+24h+var_14], ebp

loc_6E3:				; CODE XREF: _tree_init+DBj
					; _tree_init+ECj
		mov	eax, [esp+24h+var_10]
		sub	eax, 1
		mov	[esp+24h+var_10], eax
		jns	short loc_67C
		cmp	esi, 1
		jz	short loc_711
		cmp	esi, 2
		jnz	loc_659
		test	ebp, ebp
		jnz	loc_659
		pop	edi
		lea	eax, [esi+4]
		pop	esi
		pop	ebp
		pop	ebx
		add	esp, 14h
		retn
; ---------------------------------------------------------------------------

loc_711:				; CODE XREF: _tree_init+107j
		mov	edi, [esp+24h+var_C]

loc_715:				; CODE XREF: _tree_init+86j
		push	0DFh ; 'ß'
		push	offset ??_C@_0BL@HFHMLGNE@?4?2crypto?2x509v3?2pcy_tree?4c?$AA@ ; ".\\crypto\\x509v3\\pcy_tree.c"
		push	18h
		call	_CRYPTO_malloc
		mov	esi, eax
		add	esp, 0Ch
		mov	[esp+24h+var_4], esi
		test	esi, esi
		jz	loc_8BF
		push	0E5h ; 'å'
		shl	edi, 4
		push	offset ??_C@_0BL@HFHMLGNE@?4?2crypto?2x509v3?2pcy_tree?4c?$AA@ ; ".\\crypto\\x509v3\\pcy_tree.c"
		push	edi
		mov	dword ptr [esi+14h], 0
		call	_CRYPTO_malloc
		add	esp, 0Ch
		mov	[esi], eax
		mov	dword ptr [esi+4], 0
		mov	dword ptr [esi+8], 0
		mov	dword ptr [esi+0Ch], 0
		mov	dword ptr [esi+10h], 0
		test	eax, eax
		jnz	short loc_789
		push	esi
		call	_CRYPTO_free
		add	esp, 4
		xor	eax, eax
		pop	edi
		pop	esi
		pop	ebp
		pop	ebx
		add	esp, 14h
		retn
; ---------------------------------------------------------------------------

loc_789:				; CODE XREF: _tree_init+188j
		push	edi		; Size
		push	0		; Val
		push	eax		; Dst
		call	_memset
		mov	eax, [esp+30h+var_C]
		add	esp, 0Ch
		mov	edi, [esi]
		mov	[esi+4], eax
		push	0
		push	2EAh
		call	_OBJ_nid2obj
		add	esp, 4
		push	eax
		push	0
		call	_policy_data_new
		add	esp, 0Ch
		test	eax, eax
		jz	$bad_tree$57
		push	esi
		push	0
		push	eax
		push	edi
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	$bad_tree$57
		mov	eax, [esp+24h+arg_8]
		test	eax, eax
		js	loc_89A
		mov	ebp, [esp+24h+var_8]
		lea	esi, [edi+0Ch]
		nop	dword ptr [eax+00h]

loc_7EC:				; CODE XREF: _tree_init+2A0j
		push	eax
		push	[esp+28h+arg_4]
		lea	esi, [esi+10h]
		call	_sk_value
		mov	edi, eax
		push	edi
		call	_policy_cache_set
		push	101h
		push	offset ??_C@_0BL@HFHMLGNE@?4?2crypto?2x509v3?2pcy_tree?4c?$AA@ ; ".\\crypto\\x509v3\\pcy_tree.c"
		push	3
		lea	ecx, [edi+10h]
		mov	[esp+3Ch+var_10], eax
		push	1
		push	ecx
		call	_CRYPTO_add_lock
		mov	eax, [esp+44h+var_10]
		add	esp, 20h
		mov	[esi-0Ch], edi
		cmp	dword ptr [eax], 0
		jnz	short loc_831
		or	dword ptr [esi], 200h

loc_831:				; CODE XREF: _tree_init+23Dj
		test	ebp, ebp
		jnz	short loc_84B
		test	byte ptr [edi+28h], 20h
		jz	short loc_843
		mov	ecx, [esp+24h+arg_8]
		test	ecx, ecx
		jnz	short loc_862

loc_843:				; CODE XREF: _tree_init+24Dj
		or	dword ptr [esi], 200h
		jmp	short loc_862
; ---------------------------------------------------------------------------

loc_84B:				; CODE XREF: _tree_init+247j
		test	byte ptr [edi+28h], 20h
		jnz	short loc_852
		dec	ebp

loc_852:				; CODE XREF: _tree_init+263j
		mov	eax, [eax+8]
		test	eax, eax
		js	short loc_85E
		cmp	eax, ebp
		cmovl	ebp, eax

loc_85E:				; CODE XREF: _tree_init+26Bj
		mov	eax, [esp+24h+var_10]

loc_862:				; CODE XREF: _tree_init+255j
					; _tree_init+25Dj
		test	ebx, ebx
		jnz	short loc_86E
		or	dword ptr [esi], 400h
		jmp	short loc_881
; ---------------------------------------------------------------------------

loc_86E:				; CODE XREF: _tree_init+278j
		test	byte ptr [edi+28h], 20h
		jnz	short loc_875
		dec	ebx

loc_875:				; CODE XREF: _tree_init+286j
		mov	eax, [eax+10h]
		test	eax, eax
		js	short loc_881
		cmp	eax, ebx
		cmovl	ebx, eax

loc_881:				; CODE XREF: _tree_init+280j
					; _tree_init+28Ej
		mov	eax, [esp+24h+arg_8]
		sub	eax, 1
		mov	[esp+24h+arg_8], eax
		jns	loc_7EC
		mov	ebp, [esp+24h+var_14]
		mov	esi, [esp+24h+var_4]

loc_89A:				; CODE XREF: _tree_init+1EFj
		mov	eax, [esp+24h+arg_0]
		pop	edi
		mov	[eax], esi
		xor	eax, eax
		test	ebp, ebp
		pop	esi
		setz	al
		pop	ebp
		pop	ebx
		lea	eax, ds:1[eax*4]
		add	esp, 14h
		retn
; ---------------------------------------------------------------------------

$bad_tree$57:				; CODE XREF: _tree_init+1CEj
					; _tree_init+1E3j
		push	esi
		call	_X509_policy_tree_free
		add	esp, 4

loc_8BF:				; CODE XREF: _tree_init+B3j
					; _tree_init+145j
		pop	edi
		pop	esi
		pop	ebp
		xor	eax, eax
		pop	ebx
		add	esp, 14h
		retn
_tree_init	endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 8CCh
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_link_any	proc near		; CODE XREF: _tree_evaluate+3Ap

var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch

		mov	eax, 4
		call	__chkstk
		push	ebx
		push	ebp
		mov	ebp, [esp+0Ch+arg_0]
		push	esi
		push	edi
		xor	esi, esi
		push	dword ptr [ebp-0Ch]
		mov	[esp+18h+arg_0], esi
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	loc_A26
		nop	dword ptr [eax+eax+00h]

loc_8FC:				; CODE XREF: _tree_link_any+154j
		push	esi
		push	dword ptr [ebp-0Ch]
		call	_sk_value
		add	esp, 8
		mov	esi, eax
		test	dword ptr [ebp-4], 400h
		jnz	loc_9C6
		mov	edi, [esi]
		test	byte ptr [edi],	1
		jz	loc_9C6
		mov	edi, [edi+0Ch]
		push	edi
		mov	[esp+18h+var_4], edi
		call	_sk_num
		add	esp, 4
		cmp	[esi+8], eax
		jz	loc_A0A
		push	edi
		xor	ebx, ebx
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	loc_A0A

loc_94E:				; CODE XREF: _tree_link_any+F6j
		push	ebx
		push	edi
		call	_sk_value
		mov	edi, eax
		push	edi
		push	esi
		push	ebp
		call	_level_find_node
		add	esp, 14h
		test	eax, eax
		jnz	short loc_9B2
		test	edi, edi
		jnz	short loc_96F
		mov	eax, [esi]
		mov	edi, [eax+4]

loc_96F:				; CODE XREF: _tree_link_any+9Cj
		mov	eax, [esi]
		mov	eax, [eax]
		and	eax, 10h
		push	eax
		push	edi
		push	0
		call	_policy_data_new
		mov	edi, eax
		add	esp, 0Ch
		test	edi, edi
		jz	loc_A57
		mov	eax, [esp+14h+arg_4]
		push	[esp+14h+arg_8]
		push	esi
		mov	ecx, [eax]
		push	edi
		push	ebp
		mov	ecx, [ecx+8]
		or	dword ptr [edi], 4
		mov	[edi+8], ecx
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	loc_A4E

loc_9B2:				; CODE XREF: _tree_link_any+98j
		mov	edi, [esp+14h+var_4]
		inc	ebx
		push	edi
		call	_sk_num
		add	esp, 4
		cmp	ebx, eax
		jl	short loc_94E
		jmp	short loc_A0A
; ---------------------------------------------------------------------------

loc_9C6:				; CODE XREF: _tree_link_any+45j
					; _tree_link_any+50j
		cmp	dword ptr [esi+8], 0
		jnz	short loc_A0A
		mov	eax, [esi]
		mov	ecx, [eax+4]
		mov	eax, [eax]
		and	eax, 10h
		push	eax
		push	ecx
		push	0
		call	_policy_data_new
		mov	edi, eax
		add	esp, 0Ch
		test	edi, edi
		jz	short loc_A57
		mov	eax, [esp+14h+arg_4]
		push	[esp+14h+arg_8]
		push	esi
		mov	ecx, [eax]
		push	edi
		push	ebp
		mov	ecx, [ecx+8]
		or	dword ptr [edi], 4
		mov	[edi+8], ecx
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	short loc_A4E

loc_A0A:				; CODE XREF: _tree_link_any+69j
					; _tree_link_any+7Cj ...
		mov	esi, [esp+14h+arg_0]
		push	dword ptr [ebp-0Ch]
		inc	esi
		mov	[esp+18h+arg_0], esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	loc_8FC

loc_A26:				; CODE XREF: _tree_link_any+25j
		mov	eax, [ebp-8]
		test	eax, eax
		jz	short loc_A43
		push	0
		push	eax
		mov	eax, [esp+1Ch+arg_4]
		push	dword ptr [eax]
		push	ebp
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	short loc_A57

loc_A43:				; CODE XREF: _tree_link_any+15Fj
		pop	edi
		pop	esi
		pop	ebp
		mov	eax, 1
		pop	ebx
		pop	ecx
		retn
; ---------------------------------------------------------------------------

loc_A4E:				; CODE XREF: _tree_link_any+E0j
					; _tree_link_any+13Cj
		push	edi
		call	_policy_data_free
		add	esp, 4

loc_A57:				; CODE XREF: _tree_link_any+BAj
					; _tree_link_any+11Aj ...
		pop	edi
		pop	esi
		pop	ebp
		xor	eax, eax
		pop	ebx
		pop	ecx
		retn
_tree_link_any	endp

; ---------------------------------------------------------------------------
		align 10h
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0A60h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_link_matching_nodes proc near

var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, 4
		call	__chkstk
		push	ebx
		mov	ebx, [esp+8+arg_0]
		push	ebp
		push	esi
		push	edi
		push	dword ptr [ebx-0Ch]
		lea	edi, [ebx-10h]
		mov	[esp+18h+var_4], 0
		xor	esi, esi
		call	_sk_num
		mov	ebp, [esp+18h+arg_4]
		add	esp, 4
		test	eax, eax
		jle	short loc_AE9

loc_A92:				; CODE XREF: _tree_link_matching_nodes+7Fj
		push	esi
		push	dword ptr [edi+4]
		call	_sk_value
		push	dword ptr [ebp+4]
		mov	ebx, eax
		push	ebx
		push	edi
		call	_policy_node_match
		add	esp, 14h
		test	eax, eax
		jz	short loc_ACD
		push	0
		push	ebx
		push	ebp
		push	[esp+20h+arg_0]
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	short loc_B0C
		mov	ebx, 1
		mov	[esp+14h+var_4], ebx
		jmp	short loc_AD1
; ---------------------------------------------------------------------------

loc_ACD:				; CODE XREF: _tree_link_matching_nodes+4Cj
		mov	ebx, [esp+14h+var_4]

loc_AD1:				; CODE XREF: _tree_link_matching_nodes+6Bj
		push	dword ptr [edi+4]
		inc	esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	short loc_A92
		test	ebx, ebx
		jnz	short loc_B01
		mov	ebx, [esp+14h+arg_0]

loc_AE9:				; CODE XREF: _tree_link_matching_nodes+30j
		mov	eax, [edi+8]
		test	eax, eax
		jz	short loc_B01
		push	0
		push	eax
		push	ebp
		push	ebx
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	short loc_B0C

loc_B01:				; CODE XREF: _tree_link_matching_nodes+83j
					; _tree_link_matching_nodes+8Ej
		pop	edi
		pop	esi
		pop	ebp
		mov	eax, 1
		pop	ebx
		pop	ecx
		retn
; ---------------------------------------------------------------------------

loc_B0C:				; CODE XREF: _tree_link_matching_nodes+60j
					; _tree_link_matching_nodes+9Fj
		pop	edi
		pop	esi
		pop	ebp
		xor	eax, eax
		pop	ebx
		pop	ecx
		retn
_tree_link_matching_nodes endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0B14h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_link_nodes proc near		; CODE XREF: _tree_evaluate+22p

var_8		= dword	ptr -8
var_4		= dword	ptr -4
arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		mov	eax, 8
		call	__chkstk
		push	ebx
		push	ebp
		push	esi
		mov	esi, [esp+14h+arg_4]
		xor	ebp, ebp
		push	edi
		mov	[esp+18h+var_4], ebp
		push	dword ptr [esi+4]
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	loc_C08
		mov	ebx, [esp+18h+arg_0]
		lea	edi, [ebx-10h]

loc_B46:				; CODE XREF: _tree_link_nodes+E5j
		push	ebp
		push	dword ptr [esi+4]
		call	_sk_value
		push	dword ptr [edi+4]
		mov	ebp, eax
		mov	[esp+24h+var_8], 0
		xor	esi, esi
		call	_sk_num
		add	esp, 0Ch
		test	eax, eax
		jle	short loc_BC1

loc_B6A:				; CODE XREF: _tree_link_nodes+A3j
		push	esi
		push	dword ptr [edi+4]
		call	_sk_value
		push	dword ptr [ebp+4]
		mov	ebx, eax
		push	ebx
		push	edi
		call	_policy_node_match
		add	esp, 14h
		test	eax, eax
		jz	short loc_BA5
		push	0
		push	ebx
		push	ebp
		push	[esp+24h+arg_0]
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	short loc_BFE
		mov	ebx, 1
		mov	[esp+18h+var_8], ebx
		jmp	short loc_BA9
; ---------------------------------------------------------------------------

loc_BA5:				; CODE XREF: _tree_link_nodes+70j
		mov	ebx, [esp+18h+var_8]

loc_BA9:				; CODE XREF: _tree_link_nodes+8Fj
		push	dword ptr [edi+4]
		inc	esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	short loc_B6A
		test	ebx, ebx
		jnz	short loc_BD9
		mov	ebx, [esp+18h+arg_0]

loc_BC1:				; CODE XREF: _tree_link_nodes+54j
		mov	eax, [edi+8]
		test	eax, eax
		jz	short loc_BD9
		push	0
		push	eax
		push	ebp
		push	ebx
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jz	short loc_BFE

loc_BD9:				; CODE XREF: _tree_link_nodes+A7j
					; _tree_link_nodes+B2j
		mov	esi, [esp+18h+arg_4]
		mov	ebp, [esp+18h+var_4]
		inc	ebp
		mov	[esp+18h+var_4], ebp
		push	dword ptr [esi+4]
		call	_sk_num
		add	esp, 4
		cmp	ebp, eax
		jge	short loc_C08
		mov	ebx, [esp+18h+arg_0]
		jmp	loc_B46
; ---------------------------------------------------------------------------

loc_BFE:				; CODE XREF: _tree_link_nodes+84j
					; _tree_link_nodes+C3j
		pop	edi
		pop	esi
		pop	ebp
		xor	eax, eax
		pop	ebx
		add	esp, 8
		retn
; ---------------------------------------------------------------------------

loc_C08:				; CODE XREF: _tree_link_nodes+25j
					; _tree_link_nodes+DFj
		pop	edi
		pop	esi
		pop	ebp
		mov	eax, 1
		pop	ebx
		add	esp, 8
		retn
_tree_link_nodes endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0C18h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_link_unmatched proc near

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8
arg_8		= dword	ptr  0Ch
arg_C		= dword	ptr  10h

		push	ebx
		push	ebp
		mov	ebp, [esp+8+arg_0]
		push	esi
		push	edi
		mov	edi, [esp+10h+arg_8]
		test	dword ptr [ebp-4], 400h
		jnz	short loc_CA4
		mov	ebx, [edi]
		test	byte ptr [ebx],	1
		jz	short loc_CA4
		mov	ebx, [ebx+0Ch]
		push	ebx
		call	_sk_num
		add	esp, 4
		cmp	[edi+8], eax
		jz	short loc_CAA
		push	ebx
		xor	esi, esi
		call	_sk_num
		add	esp, 4
		test	eax, eax
		jle	short loc_CAA
		nop	dword ptr [eax+00h]

loc_C58:				; CODE XREF: _tree_link_unmatched+80j
		push	esi
		push	ebx
		call	_sk_value
		push	eax
		push	edi
		push	ebp
		mov	[esp+24h+arg_0], eax
		call	_level_find_node
		add	esp, 14h
		test	eax, eax
		jnz	short loc_C8C
		push	[esp+10h+arg_C]
		push	edi
		push	[esp+18h+arg_0]
		push	[esp+1Ch+arg_4]
		push	ebp
		call	_tree_add_unmatched
		add	esp, 14h
		test	eax, eax
		jz	short loc_CFB

loc_C8C:				; CODE XREF: _tree_link_unmatched+58j
		push	ebx
		inc	esi
		call	_sk_num
		add	esp, 4
		cmp	esi, eax
		jl	short loc_C58
		pop	edi
		pop	esi
		pop	ebp
		mov	eax, 1
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_CA4:				; CODE XREF: _tree_link_unmatched+13j
					; _tree_link_unmatched+1Aj
		cmp	dword ptr [edi+8], 0
		jz	short loc_CB4

loc_CAA:				; CODE XREF: _tree_link_unmatched+2Bj
					; _tree_link_unmatched+3Aj ...
		pop	edi
		pop	esi
		pop	ebp
		mov	eax, 1
		pop	ebx
		retn
; ---------------------------------------------------------------------------

loc_CB4:				; CODE XREF: _tree_link_unmatched+90j
		mov	eax, [edi]
		mov	ecx, [eax+4]
		mov	eax, [eax]
		and	eax, 10h
		push	eax
		push	ecx
		push	0
		call	_policy_data_new
		mov	esi, eax
		add	esp, 0Ch
		test	esi, esi
		jz	short loc_CFB
		mov	ecx, [esp+10h+arg_4]
		push	[esp+10h+arg_C]
		push	edi
		mov	ecx, [ecx]
		push	esi
		push	ebp
		mov	ecx, [ecx+8]
		or	dword ptr [esi], 4
		mov	[esi+8], ecx
		call	_level_add_node
		add	esp, 10h
		test	eax, eax
		jnz	short loc_CAA
		push	esi
		call	_policy_data_free
		add	esp, 4

loc_CFB:				; CODE XREF: _tree_link_unmatched+72j
					; _tree_link_unmatched+B6j
		pop	edi
		pop	esi
		pop	ebp
		xor	eax, eax
		pop	ebx
		retn
_tree_link_unmatched endp

; ---------------------------------------------------------------------------
		align 4
_text$mn	ends

; ===========================================================================

; Segment type:	Pure code
; Segment permissions: Read/Execute
_text$mn	segment	para public 'CODE' use32
		assume cs:_text$mn
		;org 0D04h
; COMDAT (pick no duplicate)
		assume es:nothing, ss:nothing, ds:_rdata, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


_tree_prune	proc near		; CODE XREF: _tree_evaluate+48p

arg_0		= dword	ptr  4
arg_4		= dword	ptr  8

		push	ebx
		mov	ebx, [esp+4+arg_4]
		push	ebp
		push	esi
		push	edi
		test	dword ptr [ebx+0Ch], 400h
		mov	edi, [ebx+4]
		jz	short loc_D54
		push	edi
		call	_sk_num
		mov	esi, eax
		add	esp, 4
		sub	esi, 1
		js	short loc_D54

loc_D28:				; CODE XREF: _tree_prune+4Ej
		push	esi
		push	edi
		call	_sk_value
		add	esp, 8
		mov	ecx, [eax]
		test	byte ptr [ecx],	3
		jz	short loc_D4F
		mov	ecx, [eax+4]
		push	eax
		dec	dword ptr [ecx+8]
		call	_CRYPTO_free
		push	esi
		push	edi
		call	_sk_delete
		add	esp, 0Ch

loc_D4F:				; CODE XREF: _tree_prune+33j
		sub	esi, 1
		jns	short loc_D28

loc_D54:				; CODE XREF: _tree_prune+12j
					; _tree_prune+22j
		mov	ebp, [esp+10h+arg_0]

loc_D58:				; CODE XREF: _tree_prune+C7j
		mov	edi, [ebx-0Ch]
		sub	ebx, 10h
		push	edi
		call	_sk_num
		mov	esi, eax
		add	esp, 4
		sub	esi, 1
		js	short loc_D9F
		nop	word ptr [eax+eax+00h]

loc_D74:				; CODE XREF: _tree_prune+99j
		push	esi
		push	edi
		call	_sk_value
		add	esp, 8
		cmp	dword ptr [eax+8], 0
		jnz	short loc_D9A
		mov	ecx, [eax+4]
		push	eax
		dec	dword ptr [ecx+8]
		call	_CRYPTO_free
		push	esi
		push	edi
		call	_sk_delete
		add	esp, 0Ch

loc_D9A:				; CODE XREF: _tree_prune+7Ej
		sub	esi, 1
		jns	short loc_D74

loc_D9F:				; CODE XREF: _tree_prune+68j
		mov	eax, [ebx+8]
		test	eax, eax
		jz	short loc_DC8
		cmp	dword ptr [eax+8], 0
		jnz	short loc_DC8
		mov	eax, [eax+4]
		test	eax, eax
		jz	short loc_DB6
		dec	dword ptr [eax+8]

loc_DB6:				; CODE XREF: _tree_prune+ADj
		push	dword ptr [ebx+8]
		call	_CRYPTO_free
		add	esp, 4
		mov	dword ptr [ebx+8], 0

loc_DC8:				; CODE XREF: _tree_prune+A0j
					; _tree_prune+A6j
		cmp	ebx, [ebp+0]
		jnz	short loc_D58
		mov	eax, [ebx+8]
		pop	edi
		neg	eax
		pop	esi
		sbb	eax, eax
		pop	ebp
		add	eax, 2
		pop	ebx
		retn
_tree_prune	endp

_text$mn	ends

; ===========================================================================

; Segment type:	Pure data
; Segment permissions: Read
_rdata		segment	dword public 'DATA' use32
		assume cs:_rdata
		;org 0DDCh
; COMDAT (pick any)
		public ??_C@_0BL@HFHMLGNE@?4?2crypto?2x509v3?2pcy_tree?4c?$AA@
; `string'
??_C@_0BL@HFHMLGNE@?4?2crypto?2x509v3?2pcy_tree?4c?$AA@	db '.\crypto\x509v3\pcy_tree.c',0
					; DATA XREF: _tree_init+12Eo
					; _tree_init+153o ...
_rdata		ends

; ===========================================================================

; Segment type:	Externs
; UNDEF
		extrn _sk_num:near	; CODE XREF: _X509_policy_check+129p
					; _tree_calculate_authority_set+A7p ...
		extrn _sk_value:near	; CODE XREF: _tree_calculate_authority_set+B7p
					; _tree_calculate_user_set+52p	...
		extrn _sk_new_null:near	; CODE XREF: _tree_calculate_user_set+F7p
		extrn _sk_free:near	; CODE XREF: _X509_policy_check+107p
					; _X509_policy_tree_free+12p
		extrn _sk_pop_free:near	; CODE XREF: _X509_policy_tree_free+1Fp
					; _X509_policy_tree_free+4Cp ...
		extrn _sk_delete:near	; CODE XREF: _tree_prune+43p
					; _tree_prune+8Ep
		extrn _sk_find:near	; CODE XREF: _tree_add_auth_node+1Dp
					; _tree_calculate_authority_set+3Dp ...
		extrn _sk_push:near	; CODE XREF: _tree_add_auth_node+37p
					; _tree_calculate_authority_set+4Dp ...
		extrn _CRYPTO_add_lock:near ; CODE XREF: _tree_init+22Bp
		extrn _CRYPTO_malloc:near ; CODE XREF: _tree_init+135p
					; _tree_init+160p
		extrn _CRYPTO_free:near	; CODE XREF: _X509_policy_tree_free+86p
					; _X509_policy_tree_free+8Cp ...
		extrn _OBJ_nid2obj:near	; CODE XREF: _tree_init+1B9p
		extrn _OBJ_obj2nid:near	; CODE XREF: _tree_calculate_user_set+58p
		extrn _X509_policy_tree_get0_user_policies:near
					; CODE XREF: _X509_policy_check+123p
		extrn _X509_free:near	; CODE XREF: _X509_policy_tree_free+37p
		extrn _X509_check_purpose:near ; CODE XREF: _tree_init+A1p
		extrn _policy_data_new:near ; CODE XREF: _tree_add_unmatched+1Ep
					; _tree_calculate_user_set+C5p	...
		extrn _policy_data_free:near ; CODE XREF: _tree_add_unmatched+52p
					; _tree_link_any+183p ...
		extrn _policy_node_cmp_new:near	; CODE XREF: _tree_add_auth_node+Bp
					; _tree_calculate_authority_set+2Ep ...
		extrn _level_find_node:near ; CODE XREF: _tree_link_any+8Ep
					; _tree_link_unmatched+4Ep
		extrn _tree_find_sk:near ; CODE	XREF: _tree_calculate_user_set+A0p
		extrn _level_add_node:near ; CODE XREF:	_tree_add_unmatched+45p
					; _tree_calculate_user_set+E7p	...
		extrn _policy_node_free:near ; CODE XREF: _X509_policy_tree_free+5Cp
					; DATA XREF: _X509_policy_tree_free+46o
		extrn _policy_node_match:near ;	CODE XREF: _tree_link_matching_nodes+42p
					; _tree_link_nodes+66p
		extrn _policy_cache_set:near ; CODE XREF: _tree_evaluate+19p
					; _tree_init+A7p ...
		extrn __chkstk:near	; CODE XREF: _X509_policy_check+5p
					; _tree_calculate_authority_set+5p ...
; void *__cdecl	memset(void *Dst, int Val, size_t Size)
		extrn _memset:near	; CODE XREF: _tree_init+1A1p


		end
