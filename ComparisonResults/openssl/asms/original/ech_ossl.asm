; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.23918.0 

	TITLE	C:\workpace\openssl\openssl-1.0.2h\crypto\ecdh\ech_ossl.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	??_C@_0BE@LILBBPKE@OpenSSL?5ECDH?5method?$AA@	; `string'
;	COMDAT ??_C@_0BE@LILBBPKE@OpenSSL?5ECDH?5method?$AA@
CONST	SEGMENT
??_C@_0BE@LILBBPKE@OpenSSL?5ECDH?5method?$AA@ DB 'OpenSSL ECDH method', 00H ; `string'
CONST	ENDS
_DATA	SEGMENT
_openssl_ecdh_meth DD FLAT:??_C@_0BE@LILBBPKE@OpenSSL?5ECDH?5method?$AA@
	DD	FLAT:_ecdh_compute_key
	DD	00H
	DD	00H
_DATA	ENDS
PUBLIC	_ECDH_OpenSSL
PUBLIC	??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@ ; `string'
EXTRN	_CRYPTO_malloc:PROC
EXTRN	_CRYPTO_free:PROC
EXTRN	_ERR_put_error:PROC
EXTRN	_BN_CTX_new:PROC
EXTRN	_BN_CTX_free:PROC
EXTRN	_BN_CTX_start:PROC
EXTRN	_BN_CTX_get:PROC
EXTRN	_BN_CTX_end:PROC
EXTRN	_BN_num_bits:PROC
EXTRN	_BN_bn2bin:PROC
EXTRN	_BN_mul:PROC
EXTRN	_EC_GROUP_method_of:PROC
EXTRN	_EC_METHOD_get_field_type:PROC
EXTRN	_EC_GROUP_get_cofactor:PROC
EXTRN	_EC_GROUP_get_degree:PROC
EXTRN	_EC_POINT_new:PROC
EXTRN	_EC_POINT_free:PROC
EXTRN	_EC_POINT_get_affine_coordinates_GFp:PROC
EXTRN	_EC_POINT_get_affine_coordinates_GF2m:PROC
EXTRN	_EC_POINT_mul:PROC
EXTRN	_EC_KEY_get_flags:PROC
EXTRN	_EC_KEY_get0_group:PROC
EXTRN	_EC_KEY_get0_private_key:PROC
EXTRN	__chkstk:PROC
EXTRN	_memcpy:PROC
EXTRN	_memset:PROC
;	COMDAT ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
CONST	SEGMENT
??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@ DB '.\crypto\ecdh\e'
	DB	'ch_ossl.c', 00H				; `string'
CONST	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _ecdh_compute_key
_TEXT	SEGMENT
_group$1$ = -20						; size = 4
_buflen$1$ = -16					; size = 4
_priv_key$1$ = -16					; size = 4
_tmp$1$ = -12						; size = 4
_len$1$ = -8						; size = 4
_y$1$ = -8						; size = 4
_x$1$ = -4						; size = 4
_out$ = 8						; size = 4
_outlen$ = 12						; size = 4
_pub_key$ = 16						; size = 4
_ecdh$ = 20						; size = 4
_KDF$ = 24						; size = 4
_ecdh_compute_key PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\ecdh\ech_ossl.c
; Line 112
	mov	eax, 20					; 00000014H
	call	__chkstk
	push	ebx
	push	ebp
; Line 118
	or	ebp, -1
; Line 120
	xor	ebx, ebx
; Line 122
	cmp	DWORD PTR _outlen$[esp+24], 2147483647	; 7fffffffH
	jbe	SHORT $LN2@ecdh_compu
; Line 123
	push	123					; 0000007bH
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	65					; 00000041H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
; Line 125
	or	eax, ebp
	pop	ebp
	pop	ebx
; Line 218
	add	esp, 20					; 00000014H
	ret	0
$LN2@ecdh_compu:
	push	edi
; Line 128
	call	_BN_CTX_new
	mov	edi, eax
	test	edi, edi
	je	$LN24@ecdh_compu
; Line 130
	push	esi
	push	edi
	call	_BN_CTX_start
; Line 131
	push	edi
	call	_BN_CTX_get
	mov	esi, eax
; Line 132
	push	edi
	mov	DWORD PTR _x$1$[esp+48], esi
	call	_BN_CTX_get
; Line 134
	push	DWORD PTR _ecdh$[esp+44]
	mov	DWORD PTR _y$1$[esp+52], eax
	call	_EC_KEY_get0_private_key
	add	esp, 16					; 00000010H
	mov	DWORD PTR _priv_key$1$[esp+36], eax
; Line 135
	test	eax, eax
	jne	SHORT $LN4@ecdh_compu
; Line 136
	push	136					; 00000088H
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	100					; 00000064H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
; Line 137
	jmp	$LN21@ecdh_compu
$LN4@ecdh_compu:
; Line 140
	push	DWORD PTR _ecdh$[esp+32]
	call	_EC_KEY_get0_group
; Line 142
	push	DWORD PTR _ecdh$[esp+36]
	mov	DWORD PTR _group$1$[esp+44], eax
	call	_EC_KEY_get_flags
	add	esp, 8
	test	eax, 4096				; 00001000H
	je	SHORT $LN5@ecdh_compu
; Line 143
	push	edi
	push	esi
	push	DWORD PTR _group$1$[esp+44]
	call	_EC_GROUP_get_cofactor
	add	esp, 12					; 0000000cH
	test	eax, eax
	je	SHORT $LN7@ecdh_compu
	push	edi
	push	DWORD PTR _priv_key$1$[esp+40]
	push	esi
	push	esi
	call	_BN_mul
	add	esp, 16					; 00000010H
	test	eax, eax
	je	SHORT $LN7@ecdh_compu
; Line 148
	mov	DWORD PTR _priv_key$1$[esp+36], esi
$LN5@ecdh_compu:
; Line 151
	push	DWORD PTR _group$1$[esp+36]
	call	_EC_POINT_new
	add	esp, 4
	mov	DWORD PTR _tmp$1$[esp+36], eax
	test	eax, eax
	jne	SHORT $LN8@ecdh_compu
; Line 152
	push	152					; 00000098H
; Line 153
	jmp	SHORT $LN28@ecdh_compu
$LN7@ecdh_compu:
; Line 145
	push	145					; 00000091H
$LN28@ecdh_compu:
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	65					; 00000041H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
; Line 146
	jmp	$LN21@ecdh_compu
$LN8@ecdh_compu:
; Line 156
	push	edi
	push	DWORD PTR _priv_key$1$[esp+40]
	push	DWORD PTR _pub_key$[esp+40]
	push	0
	push	eax
	push	DWORD PTR _group$1$[esp+56]
	call	_EC_POINT_mul
	add	esp, 24					; 00000018H
	test	eax, eax
	jne	SHORT $LN9@ecdh_compu
; Line 157
	push	157					; 0000009dH
$LN26@ecdh_compu:
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	101					; 00000065H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
; Line 158
	jmp	$err$30
$LN9@ecdh_compu:
; Line 161
	push	DWORD PTR _group$1$[esp+36]
	call	_EC_GROUP_method_of
	push	eax
	call	_EC_METHOD_get_field_type
	add	esp, 8
; Line 163
	push	edi
	push	DWORD PTR _y$1$[esp+40]
	push	esi
	push	DWORD PTR _tmp$1$[esp+48]
	push	DWORD PTR _group$1$[esp+52]
	cmp	eax, 406				; 00000196H
	jne	SHORT $LN10@ecdh_compu
	call	_EC_POINT_get_affine_coordinates_GFp
	add	esp, 20					; 00000014H
	test	eax, eax
	jne	SHORT $LN13@ecdh_compu
; Line 164
	push	164					; 000000a4H
; Line 165
	jmp	SHORT $LN26@ecdh_compu
$LN10@ecdh_compu:
; Line 170
	call	_EC_POINT_get_affine_coordinates_GF2m
	add	esp, 20					; 00000014H
	test	eax, eax
	jne	SHORT $LN13@ecdh_compu
; Line 171
	push	171					; 000000abH
; Line 172
	jmp	SHORT $LN26@ecdh_compu
$LN13@ecdh_compu:
; Line 177
	push	DWORD PTR _group$1$[esp+36]
	call	_EC_GROUP_get_degree
	add	eax, 7
	cdq
	and	edx, 7
	add	eax, edx
	sar	eax, 3
; Line 178
	push	esi
	mov	DWORD PTR _buflen$1$[esp+44], eax
	call	_BN_num_bits
; Line 179
	mov	esi, DWORD PTR _buflen$1$[esp+44]
	add	eax, 7
	cdq
	add	esp, 8
	and	edx, 7
	add	eax, edx
	sar	eax, 3
	mov	DWORD PTR _len$1$[esp+36], eax
	cmp	eax, esi
	jbe	SHORT $LN14@ecdh_compu
; Line 180
	push	180					; 000000b4H
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	68					; 00000044H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
	jmp	$err$30
$LN14@ecdh_compu:
; Line 183
	push	183					; 000000b7H
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	esi
	call	_CRYPTO_malloc
	mov	ebx, eax
	add	esp, 12					; 0000000cH
	test	ebx, ebx
	jne	SHORT $LN15@ecdh_compu
; Line 184
	push	184					; 000000b8H
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	65					; 00000041H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
	jmp	$err$30
$LN15@ecdh_compu:
; Line 188
	sub	esi, DWORD PTR _len$1$[esp+36]
	push	esi
	push	0
	push	ebx
	call	_memset
; Line 189
	lea	eax, DWORD PTR [esi+ebx]
	push	eax
	push	DWORD PTR _x$1$[esp+52]
	call	_BN_bn2bin
	add	esp, 20					; 00000014H
	cmp	DWORD PTR _len$1$[esp+36], eax
	je	SHORT $LN16@ecdh_compu
; Line 190
	push	190					; 000000beH
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	3
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
	jmp	SHORT $err$30
$LN16@ecdh_compu:
; Line 194
	mov	ecx, DWORD PTR _KDF$[esp+32]
	test	ecx, ecx
	je	SHORT $LN17@ecdh_compu
; Line 195
	lea	eax, DWORD PTR _outlen$[esp+32]
	push	eax
	push	DWORD PTR _out$[esp+36]
	mov	eax, DWORD PTR _buflen$1$[esp+44]
	push	eax
	push	ebx
	call	ecx
	add	esp, 16					; 00000010H
	test	eax, eax
	jne	SHORT $LN19@ecdh_compu
; Line 196
	push	196					; 000000c4H
	push	OFFSET ??_C@_0BJ@GOHIGCLE@?4?2crypto?2ecdh?2ech_ossl?4c?$AA@
	push	102					; 00000066H
	push	100					; 00000064H
	push	43					; 0000002bH
	call	_ERR_put_error
	add	esp, 20					; 00000014H
	jmp	SHORT $err$30
$LN19@ecdh_compu:
; Line 199
	mov	ebp, DWORD PTR _outlen$[esp+32]
; Line 200
	jmp	SHORT $err$30
$LN17@ecdh_compu:
; Line 202
	mov	ebp, DWORD PTR _outlen$[esp+32]
	cmp	ebp, DWORD PTR _buflen$1$[esp+36]
	cmova	ebp, DWORD PTR _buflen$1$[esp+36]
; Line 204
	push	ebp
	push	ebx
	push	DWORD PTR _out$[esp+40]
	mov	DWORD PTR _outlen$[esp+44], ebp
	call	_memcpy
	add	esp, 12					; 0000000cH
$err$30:
; Line 210
	push	DWORD PTR _tmp$1$[esp+36]
	call	_EC_POINT_free
	add	esp, 4
$LN21@ecdh_compu:
; Line 212
	push	edi
	call	_BN_CTX_end
; Line 214
	push	edi
	call	_BN_CTX_free
	add	esp, 8
	pop	esi
; Line 215
	test	ebx, ebx
	je	SHORT $LN24@ecdh_compu
; Line 216
	push	ebx
	call	_CRYPTO_free
	add	esp, 4
$LN24@ecdh_compu:
; Line 217
	pop	edi
	mov	eax, ebp
	pop	ebp
	pop	ebx
; Line 218
	add	esp, 20					; 00000014H
	ret	0
_ecdh_compute_key ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _ECDH_OpenSSL
_TEXT	SEGMENT
_ECDH_OpenSSL PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\ecdh\ech_ossl.c
; Line 99
	mov	eax, OFFSET _openssl_ecdh_meth
; Line 100
	ret	0
_ECDH_OpenSSL ENDP
_TEXT	ENDS
END
