; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.23918.0 

	TITLE	C:\workpace\openssl\openssl-1.0.2h\engines\ccgost\gost2001_keyx.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	_pkey_GOST01cp_encrypt
PUBLIC	_pkey_GOST01cp_decrypt
PUBLIC	_pkey_gost2001_derive
PUBLIC	??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@ ; `string'
PUBLIC	??_C@_0CN@KJOEMIAB@gkt?9?$DOkey_agreement_info?9?$DOeph_iv?9@ ; `string'
PUBLIC	??_C@_0CL@DIIAHIAG@gkt?9?$DOkey_info?9?$DOencrypted_key?9?$DOle@ ; `string'
PUBLIC	??_C@_0CB@DOELIANA@gkt?9?$DOkey_info?9?$DOimit?9?$DOlength?5?$DN?$DN?54@ ; `string'
EXTRN	_OpenSSLDie:PROC
EXTRN	_BN_CTX_new:PROC
EXTRN	_BN_CTX_free:PROC
EXTRN	_BN_CTX_start:PROC
EXTRN	_BN_CTX_get:PROC
EXTRN	_BN_CTX_end:PROC
EXTRN	_BN_mod_mul:PROC
EXTRN	_BN_free:PROC
EXTRN	_ASN1_OBJECT_free:PROC
EXTRN	_ASN1_OCTET_STRING_set:PROC
EXTRN	_OBJ_nid2obj:PROC
EXTRN	_EVP_PKEY_base_id:PROC
EXTRN	_EVP_PKEY_assign:PROC
EXTRN	_EVP_PKEY_get0:PROC
EXTRN	_EVP_PKEY_new:PROC
EXTRN	_EVP_PKEY_free:PROC
EXTRN	_EVP_PKEY_copy_parameters:PROC
EXTRN	_EVP_PKEY_CTX_ctrl:PROC
EXTRN	_EVP_PKEY_CTX_get_data:PROC
EXTRN	_EVP_PKEY_CTX_get0_pkey:PROC
EXTRN	_EVP_PKEY_CTX_get0_peerkey:PROC
EXTRN	_EVP_PKEY_derive_set_peer:PROC
EXTRN	_RAND_bytes:PROC
EXTRN	_gost_init:PROC
EXTRN	_init_gost_hash_ctx:PROC
EXTRN	_done_gost_hash_ctx:PROC
EXTRN	_start_hash:PROC
EXTRN	_hash_block:PROC
EXTRN	_finish_hash:PROC
EXTRN	_ERR_GOST_error:PROC
EXTRN	_keyWrapCryptoPro:PROC
EXTRN	_keyUnwrapCryptoPro:PROC
EXTRN	_EC_GROUP_get_order:PROC
EXTRN	_EC_POINT_new:PROC
EXTRN	_EC_POINT_free:PROC
EXTRN	_EC_POINT_get_affine_coordinates_GFp:PROC
EXTRN	_EC_POINT_mul:PROC
EXTRN	_EC_KEY_new:PROC
EXTRN	_EC_KEY_get0_group:PROC
EXTRN	_EC_KEY_get0_private_key:PROC
EXTRN	_EC_KEY_get0_public_key:PROC
EXTRN	_X509_PUBKEY_set:PROC
EXTRN	_X509_PUBKEY_get:PROC
EXTRN	_get_gost_engine_param:PROC
EXTRN	_GOST_KEY_TRANSPORT_new:PROC
EXTRN	_GOST_KEY_TRANSPORT_free:PROC
EXTRN	_d2i_GOST_KEY_TRANSPORT:PROC
EXTRN	_i2d_GOST_KEY_TRANSPORT:PROC
EXTRN	_get_encryption_params:PROC
EXTRN	_gost2001_keygen:PROC
EXTRN	_store_bignum:PROC
EXTRN	_getbnfrombuf:PROC
EXTRN	_gost_get0_priv_key:PROC
EXTRN	@__security_check_cookie@4:PROC
EXTRN	__chkstk:PROC
EXTRN	_GostR3411_94_CryptoProParamSet:BYTE
EXTRN	_gost_cipher_list:BYTE
EXTRN	___security_cookie:DWORD
;	COMDAT ??_C@_0CB@DOELIANA@gkt?9?$DOkey_info?9?$DOimit?9?$DOlength?5?$DN?$DN?54@
CONST	SEGMENT
??_C@_0CB@DOELIANA@gkt?9?$DOkey_info?9?$DOimit?9?$DOlength?5?$DN?$DN?54@ DB 'g'
	DB	'kt->key_info->imit->length == 4', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CL@DIIAHIAG@gkt?9?$DOkey_info?9?$DOencrypted_key?9?$DOle@
CONST	SEGMENT
??_C@_0CL@DIIAHIAG@gkt?9?$DOkey_info?9?$DOencrypted_key?9?$DOle@ DB 'gkt-'
	DB	'>key_info->encrypted_key->length == 32', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@KJOEMIAB@gkt?9?$DOkey_agreement_info?9?$DOeph_iv?9@
CONST	SEGMENT
??_C@_0CN@KJOEMIAB@gkt?9?$DOkey_agreement_info?9?$DOeph_iv?9@ DB 'gkt->ke'
	DB	'y_agreement_info->eph_iv->length == 8', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
CONST	SEGMENT
??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@ DB '.\engines\c'
	DB	'cgost\gost2001_keyx.c', 00H			; `string'
CONST	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _VKO_compute_key
_TEXT	SEGMENT
_ctx$1$ = -280						; size = 4
_pnt$1$ = -276						; size = 4
_priv_key$GSCopy$1$ = -272				; size = 4
_UKM$1$ = -268						; size = 4
_key$1$ = -264						; size = 4
_pub_key$GSCopy$1$ = -260				; size = 4
_shared_key$GSCopy$1$ = -256				; size = 4
_hash_ctx$ = -252					; size = 112
_ukm_be$ = -140						; size = 8
_databuf$ = -132					; size = 64
_hashbuf$ = -68						; size = 64
__$ArrayPad$ = -4					; size = 4
_shared_key$ = 8					; size = 4
_shared_key_size$ = 12					; size = 4
_pub_key$ = 16						; size = 4
_priv_key$ = 20						; size = 4
_ukm$ = 24						; size = 4
_VKO_compute_key PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\engines\ccgost\gost2001_keyx.c
; Line 25
	mov	eax, 280				; 00000118H
	call	__chkstk
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, esp
	mov	DWORD PTR __$ArrayPad$[esp+280], eax
	mov	eax, DWORD PTR _shared_key$[esp+276]
	push	ebx
	mov	ebx, DWORD PTR _priv_key$[esp+280]
	push	ebp
	push	esi
	push	edi
	mov	DWORD PTR _shared_key$GSCopy$1$[esp+296], eax
	mov	eax, DWORD PTR _pub_key$[esp+292]
; Line 28
	push	ebx
	mov	DWORD PTR _pub_key$GSCopy$1$[esp+300], eax
	mov	DWORD PTR _priv_key$GSCopy$1$[esp+300], ebx
	call	_EC_KEY_get0_private_key
; Line 29
	push	ebx
	mov	DWORD PTR _key$1$[esp+304], eax
	call	_EC_KEY_get0_group
	push	eax
	call	_EC_POINT_new
	mov	DWORD PTR _pnt$1$[esp+308], eax
; Line 32
	call	_BN_CTX_new
; Line 35
	mov	edx, DWORD PTR _ukm$[esp+304]
	mov	ebx, eax
; Line 37
	push	ebx
	mov	DWORD PTR _ctx$1$[esp+312], ebx
	movzx	ecx, BYTE PTR [edx]
	movzx	eax, BYTE PTR [edx+4]
	mov	BYTE PTR _ukm_be$[esp+319], cl
	movzx	ecx, BYTE PTR [edx+1]
	mov	BYTE PTR _ukm_be$[esp+315], al
	movzx	eax, BYTE PTR [edx+5]
	mov	BYTE PTR _ukm_be$[esp+318], cl
	movzx	ecx, BYTE PTR [edx+2]
	mov	BYTE PTR _ukm_be$[esp+314], al
	movzx	eax, BYTE PTR [edx+6]
	mov	BYTE PTR _ukm_be$[esp+317], cl
	movzx	ecx, BYTE PTR [edx+3]
	mov	BYTE PTR _ukm_be$[esp+313], al
	movzx	eax, BYTE PTR [edx+7]
	mov	BYTE PTR _ukm_be$[esp+316], cl
	mov	BYTE PTR _ukm_be$[esp+312], al
	call	_BN_CTX_start
; Line 38
	lea	eax, DWORD PTR _ukm_be$[esp+312]
	push	8
	push	eax
	call	_getbnfrombuf
; Line 39
	push	ebx
	mov	DWORD PTR _UKM$1$[esp+324], eax
	call	_BN_CTX_get
; Line 40
	push	ebx
	mov	edi, eax
	call	_BN_CTX_get
; Line 41
	push	ebx
	mov	esi, eax
	call	_BN_CTX_get
; Line 42
	push	ebx
	mov	ebp, eax
	call	_BN_CTX_get
	add	esp, 40					; 00000028H
	mov	ebx, eax
; Line 43
	push	DWORD PTR _ctx$1$[esp+296]
	push	esi
	push	DWORD PTR _priv_key$GSCopy$1$[esp+304]
	call	_EC_KEY_get0_group
	add	esp, 4
	push	eax
	call	_EC_GROUP_get_order
; Line 44
	push	DWORD PTR _ctx$1$[esp+308]
	push	esi
	push	DWORD PTR _UKM$1$[esp+316]
	push	DWORD PTR _key$1$[esp+320]
	push	edi
	call	_BN_mod_mul
; Line 45
	mov	esi, DWORD PTR _priv_key$GSCopy$1$[esp+328]
	add	esp, 32					; 00000020H
	push	DWORD PTR _ctx$1$[esp+296]
	push	edi
	push	DWORD PTR _pub_key$GSCopy$1$[esp+304]
	push	0
	push	DWORD PTR _pnt$1$[esp+312]
	push	esi
	call	_EC_KEY_get0_group
	add	esp, 4
	push	eax
	call	_EC_POINT_mul
; Line 46
	mov	edi, DWORD PTR _ctx$1$[esp+320]
	add	esp, 24					; 00000018H
	push	edi
	push	ebx
	push	ebp
	push	DWORD PTR _pnt$1$[esp+308]
	push	esi
	call	_EC_KEY_get0_group
	add	esp, 4
	push	eax
	call	_EC_POINT_get_affine_coordinates_GFp
; Line 51
	push	32					; 00000020H
	lea	eax, DWORD PTR _databuf$[esp+320]
	push	eax
	push	ebx
	call	_store_bignum
; Line 52
	push	32					; 00000020H
	lea	eax, DWORD PTR _databuf$[esp+364]
	push	eax
	push	ebp
	call	_store_bignum
	add	esp, 44					; 0000002cH
	lea	edx, DWORD PTR _hashbuf$[esp+359]
; Line 54
	xor	eax, eax
$LL7@VKO_comput:
; Line 55
	mov	cl, BYTE PTR _databuf$[esp+eax+296]
	lea	edx, DWORD PTR [edx-1]
	inc	eax
	mov	BYTE PTR [edx+1], cl
	cmp	eax, 64					; 00000040H
	jl	SHORT $LL7@VKO_comput
; Line 57
	lea	eax, DWORD PTR _hash_ctx$[esp+296]
	push	OFFSET _GostR3411_94_CryptoProParamSet
	push	eax
	call	_init_gost_hash_ctx
; Line 58
	lea	eax, DWORD PTR _hash_ctx$[esp+304]
	push	eax
	call	_start_hash
; Line 59
	push	64					; 00000040H
	lea	eax, DWORD PTR _hashbuf$[esp+312]
	push	eax
	lea	eax, DWORD PTR _hash_ctx$[esp+316]
	push	eax
	call	_hash_block
; Line 60
	push	DWORD PTR _shared_key$GSCopy$1$[esp+320]
	lea	eax, DWORD PTR _hash_ctx$[esp+324]
	push	eax
	call	_finish_hash
; Line 61
	lea	eax, DWORD PTR _hash_ctx$[esp+328]
	push	eax
	call	_done_gost_hash_ctx
; Line 62
	push	DWORD PTR _UKM$1$[esp+332]
	call	_BN_free
; Line 63
	push	edi
	call	_BN_CTX_end
; Line 64
	push	edi
	call	_BN_CTX_free
; Line 65
	push	DWORD PTR _pnt$1$[esp+344]
	call	_EC_POINT_free
; Line 67
	mov	ecx, DWORD PTR __$ArrayPad$[esp+348]
	add	esp, 52					; 00000034H
	mov	eax, 32					; 00000020H
	pop	edi
	pop	esi
	pop	ebp
	pop	ebx
	xor	ecx, esp
	call	@__security_check_cookie@4
	add	esp, 280				; 00000118H
	ret	0
_VKO_compute_key ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _pkey_gost2001_derive
_TEXT	SEGMENT
_ctx$ = 8						; size = 4
_key$ = 12						; size = 4
_keylen$ = 16						; size = 4
_pkey_gost2001_derive PROC				; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\engines\ccgost\gost2001_keyx.c
; Line 75
	push	ebx
	push	esi
; Line 80
	mov	esi, DWORD PTR _ctx$[esp+4]
	push	edi
	push	esi
	call	_EVP_PKEY_CTX_get0_pkey
; Line 81
	push	esi
	mov	edi, eax
	call	_EVP_PKEY_CTX_get0_peerkey
; Line 82
	push	esi
	mov	ebx, eax
	call	_EVP_PKEY_CTX_get_data
	add	esp, 12					; 0000000cH
; Line 84
	mov	ecx, DWORD PTR [eax+8]
	test	ecx, ecx
	jne	SHORT $LN2@pkey_gost2
; Line 85
	push	85					; 00000055H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	128					; 00000080H
	push	121					; 00000079H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 86
	xor	eax, eax
	pop	edi
	pop	esi
	pop	ebx
; Line 99
	ret	0
$LN2@pkey_gost2:
; Line 89
	mov	esi, DWORD PTR _key$[esp+8]
	test	esi, esi
	jne	SHORT $LN3@pkey_gost2
; Line 90
	mov	eax, DWORD PTR _keylen$[esp+8]
	pop	edi
	mov	DWORD PTR [eax], 32			; 00000020H
; Line 91
	lea	eax, DWORD PTR [esi+32]
	pop	esi
	pop	ebx
; Line 99
	ret	0
$LN3@pkey_gost2:
; Line 94
	push	ecx
	push	edi
	call	_EVP_PKEY_get0
	add	esp, 4
	push	eax
	push	ebx
	call	_EVP_PKEY_get0
	push	eax
	call	_EC_KEY_get0_public_key
	add	esp, 8
	push	eax
	push	32					; 00000020H
	push	esi
	call	_VKO_compute_key
	mov	ecx, DWORD PTR _keylen$[esp+28]
	add	esp, 20					; 00000014H
	pop	edi
	pop	esi
	mov	DWORD PTR [ecx], eax
; Line 98
	mov	eax, 1
	pop	ebx
; Line 99
	ret	0
_pkey_gost2001_derive ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _pkey_GOST01cp_decrypt
_TEXT	SEGMENT
_key$GSCopy$1$ = -4220					; size = 4
_p$ = -4216						; size = 4
_priv$1$ = -4212					; size = 4
_ctx$ = -4208						; size = 4128
_wrappedKey$ = -80					; size = 44
_sharedKey$ = -36					; size = 32
__$ArrayPad$ = -4					; size = 4
_pctx$ = 8						; size = 4
_key$ = 12						; size = 4
_key_len$ = 16						; size = 4
_in$ = 20						; size = 4
_in_len$ = 24						; size = 4
_pkey_GOST01cp_decrypt PROC				; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\engines\ccgost\gost2001_keyx.c
; Line 220
	mov	eax, 4220				; 0000107cH
	call	__chkstk
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, esp
	mov	DWORD PTR __$ArrayPad$[esp+4220], eax
	mov	eax, DWORD PTR _key$[esp+4216]
	push	ebx
	mov	ebx, DWORD PTR _in_len$[esp+4220]
	push	ebp
	push	esi
	mov	esi, DWORD PTR _key_len$[esp+4228]
	push	edi
	mov	edi, DWORD PTR _pctx$[esp+4232]
	mov	DWORD PTR _key$GSCopy$1$[esp+4236], eax
	mov	eax, DWORD PTR _in$[esp+4232]
; Line 222
	push	edi
	mov	DWORD PTR _p$[esp+4240], eax
	call	_EVP_PKEY_CTX_get0_pkey
; Line 224
	xor	ebp, ebp
	mov	DWORD PTR _priv$1$[esp+4240], eax
	add	esp, 4
; Line 231
	cmp	DWORD PTR _key$GSCopy$1$[esp+4236], ebp
	jne	SHORT $LN2@pkey_GOST0
; Line 232
	mov	DWORD PTR [esi], 32			; 00000020H
; Line 233
	lea	eax, DWORD PTR [ebp+1]
	jmp	$LN1@pkey_GOST0
$LN2@pkey_GOST0:
; Line 235
	push	ebx
	lea	eax, DWORD PTR _p$[esp+4240]
	push	eax
	push	0
	call	_d2i_GOST_KEY_TRANSPORT
	mov	esi, eax
	add	esp, 12					; 0000000cH
; Line 236
	test	esi, esi
	jne	SHORT $LN3@pkey_GOST0
; Line 237
	push	238					; 000000eeH
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	104					; 00000068H
	push	118					; 00000076H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 239
	or	eax, -1
	jmp	$LN1@pkey_GOST0
$LN3@pkey_GOST0:
; Line 243
	mov	eax, DWORD PTR [esi+4]
	push	DWORD PTR [eax+4]
	call	_X509_PUBKEY_get
	mov	ebx, eax
	add	esp, 4
; Line 244
	test	ebx, ebx
	je	SHORT $LN4@pkey_GOST0
; Line 245
	push	ebx
	push	edi
	call	_EVP_PKEY_derive_set_peer
	add	esp, 8
	test	eax, eax
	jg	SHORT $LN7@pkey_GOST0
; Line 246
	push	247					; 000000f7H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	131					; 00000083H
	push	118					; 00000076H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 248
	jmp	$err$21
$LN4@pkey_GOST0:
; Line 253
	push	0
	push	3
	push	2
	push	-1
	push	-1
	push	edi
	call	_EVP_PKEY_CTX_ctrl
	add	esp, 24					; 00000018H
	test	eax, eax
	jg	SHORT $LN7@pkey_GOST0
; Line 254
	push	254					; 000000feH
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	132					; 00000084H
	push	118					; 00000076H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 255
	jmp	$LN11@pkey_GOST0
$LN7@pkey_GOST0:
; Line 258
	push	edi
	call	_EVP_PKEY_CTX_get0_peerkey
	mov	edi, eax
	add	esp, 4
; Line 259
	test	edi, edi
	jne	SHORT $LN8@pkey_GOST0
; Line 260
	push	260					; 00000104H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	120					; 00000078H
	push	118					; 00000076H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 261
	jmp	$err$21
$LN8@pkey_GOST0:
; Line 264
	mov	eax, DWORD PTR [esi+4]
	push	DWORD PTR [eax]
	call	_get_encryption_params
	add	esp, 4
; Line 265
	test	eax, eax
	je	$err$21
; Line 269
	push	DWORD PTR [eax+4]
	lea	eax, DWORD PTR _ctx$[esp+4240]
	push	eax
	call	_gost_init
; Line 270
	mov	eax, DWORD PTR [esi+4]
	add	esp, 8
	mov	eax, DWORD PTR [eax+8]
	cmp	DWORD PTR [eax], 8
	je	SHORT $LN15@pkey_GOST0
	push	OFFSET ??_C@_0CN@KJOEMIAB@gkt?9?$DOkey_agreement_info?9?$DOeph_iv?9@
	push	270					; 0000010eH
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	call	_OpenSSLDie
	add	esp, 12					; 0000000cH
$LN15@pkey_GOST0:
; Line 271
	mov	eax, DWORD PTR [esi+4]
	mov	eax, DWORD PTR [eax+8]
	mov	ecx, DWORD PTR [eax+8]
	mov	eax, DWORD PTR [ecx]
	mov	DWORD PTR _wrappedKey$[esp+4236], eax
	mov	eax, DWORD PTR [ecx+4]
	mov	DWORD PTR _wrappedKey$[esp+4240], eax
; Line 272
	mov	eax, DWORD PTR [esi]
	mov	eax, DWORD PTR [eax]
	cmp	DWORD PTR [eax], 32			; 00000020H
	je	SHORT $LN17@pkey_GOST0
	push	OFFSET ??_C@_0CL@DIIAHIAG@gkt?9?$DOkey_info?9?$DOencrypted_key?9?$DOle@
	push	272					; 00000110H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	call	_OpenSSLDie
	add	esp, 12					; 0000000cH
$LN17@pkey_GOST0:
; Line 273
	mov	eax, DWORD PTR [esi]
	mov	eax, DWORD PTR [eax]
	mov	eax, DWORD PTR [eax+8]
	movups	xmm0, XMMWORD PTR [eax]
	movups	XMMWORD PTR _wrappedKey$[esp+4244], xmm0
	movups	xmm0, XMMWORD PTR [eax+16]
	movups	XMMWORD PTR _wrappedKey$[esp+4260], xmm0
; Line 274
	mov	eax, DWORD PTR [esi]
	mov	eax, DWORD PTR [eax+4]
	cmp	DWORD PTR [eax], 4
	je	SHORT $LN19@pkey_GOST0
	push	OFFSET ??_C@_0CB@DOELIANA@gkt?9?$DOkey_info?9?$DOimit?9?$DOlength?5?$DN?$DN?54@
	push	274					; 00000112H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	call	_OpenSSLDie
	add	esp, 12					; 0000000cH
$LN19@pkey_GOST0:
; Line 275
	mov	eax, DWORD PTR [esi]
	mov	eax, DWORD PTR [eax+4]
	mov	eax, DWORD PTR [eax+8]
	mov	eax, DWORD PTR [eax]
	mov	DWORD PTR _wrappedKey$[esp+4276], eax
; Line 276
	lea	eax, DWORD PTR _wrappedKey$[esp+4236]
	push	eax
	push	DWORD PTR _priv$1$[esp+4240]
	call	_EVP_PKEY_get0
	add	esp, 4
	push	eax
	push	edi
	call	_EVP_PKEY_get0
	push	eax
	call	_EC_KEY_get0_public_key
	add	esp, 8
	push	eax
	lea	eax, DWORD PTR _sharedKey$[esp+4248]
	push	32					; 00000020H
	push	eax
	call	_VKO_compute_key
; Line 279
	push	DWORD PTR _key$GSCopy$1$[esp+4256]
	lea	eax, DWORD PTR _wrappedKey$[esp+4260]
	push	eax
	lea	eax, DWORD PTR _sharedKey$[esp+4264]
	push	eax
	lea	eax, DWORD PTR _ctx$[esp+4268]
	push	eax
	call	_keyUnwrapCryptoPro
	add	esp, 36					; 00000024H
	test	eax, eax
	jne	SHORT $LN10@pkey_GOST0
; Line 280
	push	281					; 00000119H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	102					; 00000066H
	push	118					; 00000076H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 282
	jmp	SHORT $err$21
$LN10@pkey_GOST0:
; Line 285
	mov	ebp, 1
$err$21:
; Line 287
	test	ebx, ebx
	je	SHORT $LN11@pkey_GOST0
; Line 288
	push	ebx
	call	_EVP_PKEY_free
	add	esp, 4
$LN11@pkey_GOST0:
; Line 290
	push	esi
	call	_GOST_KEY_TRANSPORT_free
	add	esp, 4
; Line 291
	mov	eax, ebp
$LN1@pkey_GOST0:
; Line 292
	mov	ecx, DWORD PTR __$ArrayPad$[esp+4236]
	pop	edi
	pop	esi
	pop	ebp
	pop	ebx
	xor	ecx, esp
	call	@__security_check_cookie@4
	add	esp, 4220				; 0000107cH
	ret	0
_pkey_GOST01cp_decrypt ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _pkey_GOST01cp_encrypt
_TEXT	SEGMENT
_out$GSCopy$ = -4236					; size = 4
_param$1$ = -4232					; size = 4
_key$GSCopy$1$ = -4228					; size = 4
_pctx$GSCopy$1$ = -4224					; size = 4
_out_len$GSCopy$1$ = -4220				; size = 4
_cctx$ = -4216						; size = 4128
_ukm$ = -88						; size = 8
_crypted_key$ = -80					; size = 44
_shared_key$ = -36					; size = 32
__$ArrayPad$ = -4					; size = 4
_pctx$ = 8						; size = 4
_out$ = 12						; size = 4
_out_len$ = 16						; size = 4
_key$ = 20						; size = 4
_key_len$ = 24						; size = 4
_pkey_GOST01cp_encrypt PROC				; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\engines\ccgost\gost2001_keyx.c
; Line 118
	mov	eax, 4236				; 0000108cH
	call	__chkstk
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, esp
	mov	DWORD PTR __$ArrayPad$[esp+4236], eax
	mov	eax, DWORD PTR _out$[esp+4232]
	push	ebx
	push	ebp
	push	esi
	mov	DWORD PTR _out$GSCopy$[esp+4248], eax
; Line 119
	xor	ebx, ebx
	mov	eax, DWORD PTR _out_len$[esp+4244]
	push	edi
	mov	edi, DWORD PTR _pctx$[esp+4248]
	mov	DWORD PTR _out_len$GSCopy$1$[esp+4252], eax
	mov	eax, DWORD PTR _key$[esp+4248]
; Line 120
	push	edi
	mov	DWORD PTR _pctx$GSCopy$1$[esp+4256], edi
	mov	DWORD PTR _key$GSCopy$1$[esp+4256], eax
	call	_EVP_PKEY_CTX_get0_pkey
; Line 121
	push	edi
	mov	ebp, eax
	call	_EVP_PKEY_CTX_get_data
; Line 122
	push	ebx
	mov	esi, eax
	call	_get_encryption_params
; Line 127
	push	edi
	mov	DWORD PTR _param$1$[esp+4268], eax
	call	_EVP_PKEY_CTX_get0_peerkey
; Line 128
	mov	ecx, DWORD PTR [esi+8]
	add	esp, 16					; 00000010H
	mov	edi, eax
	test	ecx, ecx
	je	SHORT $LN2@pkey_GOST0
; Line 129
	mov	eax, DWORD PTR [ecx]
	mov	DWORD PTR _ukm$[esp+4252], eax
	mov	eax, DWORD PTR [ecx+4]
	mov	DWORD PTR _ukm$[esp+4256], eax
$LN27@pkey_GOST0:
; Line 139
	test	edi, edi
	je	SHORT $LN6@pkey_GOST0
; Line 141
	push	edi
	xor	esi, esi
	call	_gost_get0_priv_key
	add	esp, 4
	test	eax, eax
	jne	$LN10@pkey_GOST0
; Line 142
	push	143					; 0000008fH
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	121					; 00000079H
	push	119					; 00000077H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 144
	jmp	$LN23@pkey_GOST0
$LN2@pkey_GOST0:
; Line 130
	cmp	DWORD PTR _out$GSCopy$[esp+4252], ebx
	je	SHORT $LN27@pkey_GOST0
; Line 132
	lea	eax, DWORD PTR _ukm$[esp+4252]
	push	8
	push	eax
	call	_RAND_bytes
	add	esp, 8
	test	eax, eax
	jg	SHORT $LN27@pkey_GOST0
; Line 133
	push	134					; 00000086H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	124					; 0000007cH
	push	119					; 00000077H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 135
	xor	eax, eax
	jmp	$LN1@pkey_GOST0
$LN6@pkey_GOST0:
; Line 147
	mov	esi, 1
; Line 148
	cmp	DWORD PTR _out$GSCopy$[esp+4252], ebx
	je	SHORT $LN10@pkey_GOST0
; Line 149
	call	_EVP_PKEY_new
	mov	edi, eax
; Line 150
	call	_EC_KEY_new
	push	eax
	push	ebp
	call	_EVP_PKEY_base_id
	add	esp, 4
	push	eax
	push	edi
	call	_EVP_PKEY_assign
; Line 151
	push	ebp
	push	edi
	call	_EVP_PKEY_copy_parameters
; Line 152
	push	edi
	call	_EVP_PKEY_get0
	push	eax
	call	_gost2001_keygen
	add	esp, 28					; 0000001cH
	test	eax, eax
	je	$LN26@pkey_GOST0
$LN10@pkey_GOST0:
; Line 158
	push	0
	call	_get_gost_engine_param
	add	esp, 4
	test	eax, eax
	jne	SHORT $LN28@pkey_GOST0
	mov	ecx, DWORD PTR _param$1$[esp+4252]
	mov	ebx, OFFSET _gost_cipher_list+12
	cmp	ecx, OFFSET _gost_cipher_list
	cmovne	ebx, ecx
	mov	DWORD PTR _param$1$[esp+4252], ebx
	jmp	SHORT $LN11@pkey_GOST0
$LN28@pkey_GOST0:
	mov	ebx, DWORD PTR _param$1$[esp+4252]
$LN11@pkey_GOST0:
; Line 161
	cmp	DWORD PTR _out$GSCopy$[esp+4252], 0
	je	SHORT $LN12@pkey_GOST0
; Line 162
	lea	eax, DWORD PTR _ukm$[esp+4252]
	push	eax
	push	edi
	call	_EVP_PKEY_get0
	add	esp, 4
	push	eax
	push	ebp
	call	_EVP_PKEY_get0
	push	eax
	call	_EC_KEY_get0_public_key
	add	esp, 8
	push	eax
	lea	eax, DWORD PTR _shared_key$[esp+4264]
	push	32					; 00000020H
	push	eax
	call	_VKO_compute_key
; Line 165
	push	DWORD PTR [ebx+4]
	lea	eax, DWORD PTR _cctx$[esp+4276]
	push	eax
	call	_gost_init
; Line 166
	lea	eax, DWORD PTR _crypted_key$[esp+4280]
	push	eax
	push	DWORD PTR _key$GSCopy$1$[esp+4284]
	lea	eax, DWORD PTR _ukm$[esp+4288]
	push	eax
	lea	eax, DWORD PTR _shared_key$[esp+4292]
	push	eax
	lea	eax, DWORD PTR _cctx$[esp+4296]
	push	eax
	call	_keyWrapCryptoPro
	add	esp, 48					; 00000030H
$LN12@pkey_GOST0:
; Line 168
	call	_GOST_KEY_TRANSPORT_new
	mov	ebx, eax
; Line 169
	test	ebx, ebx
	je	$err$30
; Line 172
	mov	ecx, DWORD PTR [ebx+4]
	lea	eax, DWORD PTR _ukm$[esp+4252]
	push	8
	push	eax
	push	DWORD PTR [ecx+8]
	call	_ASN1_OCTET_STRING_set
	add	esp, 12					; 0000000cH
	test	eax, eax
	je	SHORT $err$30
; Line 175
	push	4
	lea	eax, DWORD PTR _crypted_key$[esp+4296]
	push	eax
	mov	eax, DWORD PTR [ebx]
	push	DWORD PTR [eax+4]
	call	_ASN1_OCTET_STRING_set
	add	esp, 12					; 0000000cH
	test	eax, eax
	je	SHORT $err$30
; Line 178
	push	32					; 00000020H
	lea	eax, DWORD PTR _crypted_key$[esp+4264]
	push	eax
	mov	eax, DWORD PTR [ebx]
	push	DWORD PTR [eax]
	call	_ASN1_OCTET_STRING_set
	add	esp, 12					; 0000000cH
	test	eax, eax
	je	SHORT $err$30
; Line 182
	test	esi, esi
	je	SHORT $LN18@pkey_GOST0
; Line 183
	cmp	DWORD PTR _out$GSCopy$[esp+4252], 0
	mov	eax, DWORD PTR [ebx+4]
	cmovne	ebp, edi
	add	eax, 4
	push	ebp
	push	eax
	call	_X509_PUBKEY_set
	add	esp, 8
	test	eax, eax
	jne	SHORT $LN18@pkey_GOST0
; Line 185
	push	186					; 000000baH
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	101					; 00000065H
	push	119					; 00000077H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
$err$30:
; Line 207
	test	esi, esi
	je	SHORT $LN23@pkey_GOST0
$LN26@pkey_GOST0:
	test	edi, edi
	je	SHORT $LN23@pkey_GOST0
; Line 208
	push	edi
	call	_EVP_PKEY_free
	add	esp, 4
$LN23@pkey_GOST0:
; Line 209
	push	ebx
	call	_GOST_KEY_TRANSPORT_free
	add	esp, 4
; Line 210
	or	eax, -1
$LN1@pkey_GOST0:
; Line 211
	mov	ecx, DWORD PTR __$ArrayPad$[esp+4252]
	pop	edi
	pop	esi
	pop	ebp
	pop	ebx
	xor	ecx, esp
	call	@__security_check_cookie@4
	add	esp, 4236				; 0000108cH
	ret	0
$LN18@pkey_GOST0:
; Line 190
	mov	eax, DWORD PTR [ebx+4]
	push	DWORD PTR [eax]
	call	_ASN1_OBJECT_free
; Line 191
	mov	ecx, DWORD PTR _param$1$[esp+4256]
	push	DWORD PTR [ecx]
	call	_OBJ_nid2obj
	mov	ecx, DWORD PTR [ebx+4]
	add	esp, 8
	mov	DWORD PTR [ecx], eax
; Line 192
	test	esi, esi
	je	SHORT $LN25@pkey_GOST0
	test	edi, edi
	je	SHORT $LN21@pkey_GOST0
; Line 193
	push	edi
	call	_EVP_PKEY_free
	add	esp, 4
$LN21@pkey_GOST0:
; Line 202
	xor	ecx, ecx
	lea	eax, DWORD PTR _out$GSCopy$[esp+4252]
	cmp	DWORD PTR _out$GSCopy$[esp+4252], ecx
	cmove	eax, ecx
	push	eax
	push	ebx
	call	_i2d_GOST_KEY_TRANSPORT
	mov	ecx, DWORD PTR _out_len$GSCopy$1$[esp+4260]
	test	eax, eax
	mov	ebp, 0
; Line 204
	push	ebx
	mov	DWORD PTR [ecx], eax
	mov	ecx, 1
	cmovne	ebp, ecx
	call	_GOST_KEY_TRANSPORT_free
	add	esp, 12					; 0000000cH
; Line 205
	mov	eax, ebp
	jmp	SHORT $LN1@pkey_GOST0
$LN25@pkey_GOST0:
; Line 197
	push	0
	push	3
	push	2
	push	-1
	push	-1
	push	DWORD PTR _pctx$GSCopy$1$[esp+4272]
	call	_EVP_PKEY_CTX_ctrl
	add	esp, 24					; 00000018H
	test	eax, eax
	jg	SHORT $LN21@pkey_GOST0
; Line 198
	push	198					; 000000c6H
	push	OFFSET ??_C@_0CB@IOFLBHNF@?4?2engines?2ccgost?2gost2001_keyx?4c@
	push	132					; 00000084H
	push	119					; 00000077H
	call	_ERR_GOST_error
	add	esp, 16					; 00000010H
; Line 207
	jmp	$LN23@pkey_GOST0
_pkey_GOST01cp_encrypt ENDP
_TEXT	ENDS
END
