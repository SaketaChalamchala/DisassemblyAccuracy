; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.23918.0 

	TITLE	C:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	??_C@_06MJFBMHIP@rdrand?$AA@			; `string'
PUBLIC	??_C@_0BE@MLJBKLKM@Intel?5RDRAND?5engine?$AA@	; `string'
;	COMDAT ??_C@_0BE@MLJBKLKM@Intel?5RDRAND?5engine?$AA@
CONST	SEGMENT
??_C@_0BE@MLJBKLKM@Intel?5RDRAND?5engine?$AA@ DB 'Intel RDRAND engine', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_06MJFBMHIP@rdrand?$AA@
CONST	SEGMENT
??_C@_06MJFBMHIP@rdrand?$AA@ DB 'rdrand', 00H		; `string'
CONST	ENDS
_DATA	SEGMENT
_rdrand_meth DD	00H
	DD	FLAT:_get_random_bytes
	DD	00H
	DD	00H
	DD	FLAT:_get_random_bytes
	DD	FLAT:_random_status
_engine_e_rdrand_id DD FLAT:??_C@_06MJFBMHIP@rdrand?$AA@
_engine_e_rdrand_name DD FLAT:??_C@_0BE@MLJBKLKM@Intel?5RDRAND?5engine?$AA@
_DATA	ENDS
PUBLIC	_ENGINE_load_rdrand
EXTRN	_ERR_clear_error:PROC
EXTRN	_ENGINE_add:PROC
EXTRN	_ENGINE_new:PROC
EXTRN	_ENGINE_free:PROC
EXTRN	_ENGINE_set_id:PROC
EXTRN	_ENGINE_set_name:PROC
EXTRN	_ENGINE_set_RAND:PROC
EXTRN	_ENGINE_set_init_function:PROC
EXTRN	_ENGINE_set_flags:PROC
EXTRN	_OPENSSL_ia32_rdrand:PROC
EXTRN	_memcpy:PROC
EXTRN	_OPENSSL_ia32cap_P:BYTE
; Function compile flags: /Ogtpy
;	COMDAT _ENGINE_rdrand
_TEXT	SEGMENT
_ENGINE_rdrand PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
; Line 121
	push	esi
; Line 122
	call	_ENGINE_new
	mov	esi, eax
; Line 123
	test	esi, esi
	je	SHORT $LN5@ENGINE_rdr
; Line 125
	push	esi
	call	_bind_helper
	add	esp, 4
	test	eax, eax
	jne	SHORT $LN3@ENGINE_rdr
; Line 126
	push	esi
	call	_ENGINE_free
	add	esp, 4
$LN5@ENGINE_rdr:
; Line 127
	xor	eax, eax
	pop	esi
; Line 130
	ret	0
$LN3@ENGINE_rdr:
; Line 129
	mov	eax, esi
	pop	esi
; Line 130
	ret	0
_ENGINE_rdrand ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _bind_helper
_TEXT	SEGMENT
_e$ = 8							; size = 4
_bind_helper PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
; Line 109
	push	esi
; Line 113
	push	DWORD PTR _engine_e_rdrand_id
	mov	esi, DWORD PTR _e$[esp+4]
	push	esi
	call	_ENGINE_set_id
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	DWORD PTR _engine_e_rdrand_name
	push	esi
	call	_ENGINE_set_name
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	8
	push	esi
	call	_ENGINE_set_flags
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	OFFSET _rdrand_init
	push	esi
	call	_ENGINE_set_init_function
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	OFFSET _rdrand_meth
	push	esi
	call	_ENGINE_set_RAND
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
; Line 117
	mov	eax, 1
	pop	esi
; Line 118
	ret	0
$LN3@bind_helpe:
; Line 115
	xor	eax, eax
	pop	esi
; Line 118
	ret	0
_bind_helper ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _rdrand_init
_TEXT	SEGMENT
_e$ = 8							; size = 4
_rdrand_init PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
; Line 102
	mov	eax, 1
; Line 103
	ret	0
_rdrand_init ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _random_status
_TEXT	SEGMENT
_random_status PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
; Line 88
	mov	eax, 1
; Line 89
	ret	0
_random_status ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _get_random_bytes
_TEXT	SEGMENT
_buf$ = 8						; size = 4
_rnd$ = 12						; size = 4
_num$ = 12						; size = 4
_get_random_bytes PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
; Line 65
	push	esi
; Line 68
	mov	esi, DWORD PTR _num$[esp]
	push	edi
	mov	edi, DWORD PTR _buf$[esp+4]
	cmp	esi, 4
	jl	SHORT $LN3@get_random
	npad	1
$LL2@get_random:
; Line 69
	call	_OPENSSL_ia32_rdrand
	test	eax, eax
	je	SHORT $LN9@get_random
; Line 72
	mov	DWORD PTR [edi], eax
; Line 74
	sub	esi, 4
	add	edi, 4
	cmp	esi, 4
	jge	SHORT $LL2@get_random
$LN3@get_random:
; Line 76
	test	esi, esi
	je	SHORT $LN5@get_random
; Line 77
	call	_OPENSSL_ia32_rdrand
	mov	DWORD PTR _rnd$[esp+4], eax
	test	eax, eax
	je	SHORT $LN9@get_random
; Line 80
	push	esi
	lea	eax, DWORD PTR _rnd$[esp+8]
	push	eax
	push	edi
	call	_memcpy
	add	esp, 12					; 0000000cH
$LN5@get_random:
; Line 83
	pop	edi
	mov	eax, 1
	pop	esi
; Line 84
	ret	0
$LN9@get_random:
	pop	edi
; Line 70
	xor	eax, eax
	pop	esi
; Line 84
	ret	0
_get_random_bytes ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _ENGINE_load_rdrand
_TEXT	SEGMENT
_ENGINE_load_rdrand PROC				; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_rdrand.c
; Line 136
	test	DWORD PTR _OPENSSL_ia32cap_P+4, 1073741824 ; 40000000H
	je	SHORT $LN2@ENGINE_loa
	push	esi
; Line 122
	call	_ENGINE_new
	mov	esi, eax
; Line 123
	test	esi, esi
	je	SHORT $LN9@ENGINE_loa
; Line 125
	push	esi
	call	_bind_helper
	add	esp, 4
; Line 126
	push	esi
	test	eax, eax
	jne	SHORT $LN7@ENGINE_loa
	call	_ENGINE_free
	add	esp, 4
$LN9@ENGINE_loa:
	pop	esi
$LN2@ENGINE_loa:
; Line 144
	ret	0
$LN7@ENGINE_loa:
; Line 140
	call	_ENGINE_add
; Line 141
	push	esi
	call	_ENGINE_free
	add	esp, 8
	pop	esi
; Line 142
	jmp	_ERR_clear_error
_ENGINE_load_rdrand ENDP
_TEXT	ENDS
END
