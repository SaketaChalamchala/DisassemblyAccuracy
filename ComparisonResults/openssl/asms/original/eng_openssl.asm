; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.23918.0 

	TITLE	C:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	??_C@_07OHDAOILP@openssl?$AA@			; `string'
PUBLIC	??_C@_0BI@LOIJKCMB@Software?5engine?5support?$AA@ ; `string'
EXTRN	_RSA_sign:PROC
EXTRN	_RSA_verify:PROC
CONST	SEGMENT
_test_r4_cipher DD 05H
	DD	01H
	DD	010H
	DD	00H
	DD	08H
	DD	FLAT:_test_rc4_init_key
	DD	FLAT:_test_rc4_cipher
	DD	00H
	DD	0418H
	DD	00H
	DD	00H
	DD	00H
	DD	00H
_test_r4_40_cipher DD 061H
	DD	01H
	DD	05H
	DD	00H
	DD	08H
	DD	FLAT:_test_rc4_init_key
	DD	FLAT:_test_rc4_cipher
	DD	00H
	DD	0418H
	DD	00H
	DD	00H
	DD	00H
	DD	00H
_test_sha_md DD	040H
	DD	041H
	DD	014H
	DD	00H
	DD	FLAT:_test_sha1_init
	DD	FLAT:_test_sha1_update
	DD	FLAT:_test_sha1_final
	DD	00H
	DD	00H
	DD	FLAT:_RSA_sign
	DD	FLAT:_RSA_verify
	DD	06H
	DD	013H
	DD	00H
	DD	00H
	ORG $+4
	DD	040H
	DD	064H
	ORG $+4
CONST	ENDS
;	COMDAT ??_C@_0BI@LOIJKCMB@Software?5engine?5support?$AA@
CONST	SEGMENT
??_C@_0BI@LOIJKCMB@Software?5engine?5support?$AA@ DB 'Software engine sup'
	DB	'port', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_07OHDAOILP@openssl?$AA@
CONST	SEGMENT
??_C@_07OHDAOILP@openssl?$AA@ DB 'openssl', 00H		; `string'
CONST	ENDS
_DATA	SEGMENT
_engine_openssl_id DD FLAT:??_C@_07OHDAOILP@openssl?$AA@
_engine_openssl_name DD FLAT:??_C@_0BI@LOIJKCMB@Software?5engine?5support?$AA@
_test_cipher_nids DD 05H
	DD	061H
_test_cipher_nids_number DD 02H
_test_digest_nids DD 040H
_test_digest_nids_number DD 01H
_DATA	ENDS
PUBLIC	___local_stdio_printf_options
PUBLIC	__vfprintf_l
PUBLIC	_fprintf
PUBLIC	_ENGINE_load_openssl
PUBLIC	??_C@_0CP@LBNBGIPD@?$CITEST_ENG_OPENSSL_RC4?$CJ?5test_init@ ; `string'
PUBLIC	??_C@_0CP@HGIJOKNE@?$CITEST_ENG_OPENSSL_PKEY?$CJLoading?5P@ ; `string'
PUBLIC	??_C@_01KDCPPGHE@r?$AA@				; `string'
EXTRN	__imp____acrt_iob_func:PROC
EXTRN	__imp____stdio_common_vfprintf:PROC
EXTRN	_BIO_new_file:PROC
EXTRN	_BIO_free:PROC
EXTRN	_ERR_clear_error:PROC
EXTRN	_RSA_get_default_method:PROC
EXTRN	_DH_get_default_method:PROC
EXTRN	_DSA_get_default_method:PROC
EXTRN	_ECDH_OpenSSL:PROC
EXTRN	_ECDSA_OpenSSL:PROC
EXTRN	_RAND_SSLeay:PROC
EXTRN	_EVP_CIPHER_CTX_key_length:PROC
EXTRN	_SHA1_Init:PROC
EXTRN	_SHA1_Update:PROC
EXTRN	_SHA1_Final:PROC
EXTRN	_ENGINE_add:PROC
EXTRN	_ENGINE_new:PROC
EXTRN	_ENGINE_free:PROC
EXTRN	_ENGINE_set_id:PROC
EXTRN	_ENGINE_set_name:PROC
EXTRN	_ENGINE_set_RSA:PROC
EXTRN	_ENGINE_set_DSA:PROC
EXTRN	_ENGINE_set_ECDH:PROC
EXTRN	_ENGINE_set_ECDSA:PROC
EXTRN	_ENGINE_set_DH:PROC
EXTRN	_ENGINE_set_RAND:PROC
EXTRN	_ENGINE_set_load_privkey_function:PROC
EXTRN	_ENGINE_set_ciphers:PROC
EXTRN	_ENGINE_set_digests:PROC
EXTRN	_PEM_read_bio_PrivateKey:PROC
EXTRN	_RC4_set_key:PROC
EXTRN	_RC4:PROC
EXTRN	_memcpy:PROC
_DATA	SEGMENT
COMM	?_OptionsStorage@?1??__local_stdio_printf_options@@9@9:QWORD							; `__local_stdio_printf_options'::`2'::_OptionsStorage
_DATA	ENDS
;	COMDAT ??_C@_01KDCPPGHE@r?$AA@
CONST	SEGMENT
??_C@_01KDCPPGHE@r?$AA@ DB 'r', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0CP@HGIJOKNE@?$CITEST_ENG_OPENSSL_PKEY?$CJLoading?5P@
CONST	SEGMENT
??_C@_0CP@HGIJOKNE@?$CITEST_ENG_OPENSSL_PKEY?$CJLoading?5P@ DB '(TEST_ENG'
	DB	'_OPENSSL_PKEY)Loading Private key %s', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CP@LBNBGIPD@?$CITEST_ENG_OPENSSL_RC4?$CJ?5test_init@
CONST	SEGMENT
??_C@_0CP@LBNBGIPD@?$CITEST_ENG_OPENSSL_RC4?$CJ?5test_init@ DB '(TEST_ENG'
	DB	'_OPENSSL_RC4) test_init_key() called', 0aH, 00H ; `string'
CONST	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _test_sha1_final
_TEXT	SEGMENT
_ctx$ = 8						; size = 4
_md$ = 12						; size = 4
_test_sha1_final PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 345
	mov	eax, DWORD PTR _ctx$[esp-4]
	push	DWORD PTR [eax+12]
	push	DWORD PTR _md$[esp]
	call	_SHA1_Final
	add	esp, 8
; Line 346
	ret	0
_test_sha1_final ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _test_sha1_update
_TEXT	SEGMENT
_ctx$ = 8						; size = 4
_data$ = 12						; size = 4
_count$ = 16						; size = 4
_test_sha1_update PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 337
	push	DWORD PTR _count$[esp-4]
	mov	eax, DWORD PTR _ctx$[esp]
	push	DWORD PTR _data$[esp]
	push	DWORD PTR [eax+12]
	call	_SHA1_Update
	add	esp, 12					; 0000000cH
; Line 338
	ret	0
_test_sha1_update ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _test_sha1_init
_TEXT	SEGMENT
_ctx$ = 8						; size = 4
_test_sha1_init PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 329
	mov	eax, DWORD PTR _ctx$[esp-4]
	push	DWORD PTR [eax+12]
	call	_SHA1_Init
	add	esp, 4
; Line 330
	ret	0
_test_sha1_init ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _test_rc4_cipher
_TEXT	SEGMENT
_ctx$ = 8						; size = 4
_out$ = 12						; size = 4
_in$ = 16						; size = 4
_inl$ = 20						; size = 4
_test_rc4_cipher PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 261
	push	DWORD PTR _out$[esp-4]
	mov	eax, DWORD PTR _ctx$[esp]
	push	DWORD PTR _in$[esp]
	push	DWORD PTR _inl$[esp+4]
	mov	eax, DWORD PTR [eax+96]
	add	eax, 16					; 00000010H
	push	eax
	call	_RC4
	add	esp, 16					; 00000010H
; Line 262
	mov	eax, 1
; Line 263
	ret	0
_test_rc4_cipher ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _test_rc4_init_key
_TEXT	SEGMENT
_ctx$ = 8						; size = 4
_key$ = 12						; size = 4
_iv$ = 16						; size = 4
_enc$ = 20						; size = 4
_test_rc4_init_key PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 245
	push	esi
; Line 247
	push	OFFSET ??_C@_0CP@LBNBGIPD@?$CITEST_ENG_OPENSSL_RC4?$CJ?5test_init@
	push	2
	call	DWORD PTR __imp____acrt_iob_func
	add	esp, 4
	push	eax
	call	_fprintf
; Line 249
	mov	esi, DWORD PTR _ctx$[esp+8]
	push	esi
	call	_EVP_CIPHER_CTX_key_length
	push	eax
	push	DWORD PTR _key$[esp+16]
	push	DWORD PTR [esi+96]
	call	_memcpy
	add	esp, 24					; 00000018H
; Line 250
	push	DWORD PTR [esi+96]
	push	esi
	call	_EVP_CIPHER_CTX_key_length
	add	esp, 4
	push	eax
	mov	eax, DWORD PTR [esi+96]
	add	eax, 16					; 00000010H
	push	eax
	call	_RC4_set_key
	add	esp, 12					; 0000000cH
; Line 252
	mov	eax, 1
	pop	esi
; Line 253
	ret	0
_test_rc4_init_key ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _engine_openssl
_TEXT	SEGMENT
_engine_openssl PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 179
	push	esi
; Line 180
	call	_ENGINE_new
	mov	esi, eax
; Line 181
	test	esi, esi
	je	SHORT $LN5@engine_ope
; Line 183
	push	esi
	call	_bind_helper
	add	esp, 4
	test	eax, eax
	jne	SHORT $LN3@engine_ope
; Line 184
	push	esi
	call	_ENGINE_free
	add	esp, 4
$LN5@engine_ope:
; Line 185
	xor	eax, eax
	pop	esi
; Line 188
	ret	0
$LN3@engine_ope:
; Line 187
	mov	eax, esi
	pop	esi
; Line 188
	ret	0
_engine_openssl ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _bind_helper
_TEXT	SEGMENT
_e$ = 8							; size = 4
_bind_helper PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 138
	push	esi
; Line 166
	push	DWORD PTR _engine_openssl_id
	mov	esi, DWORD PTR _e$[esp+4]
	push	esi
	call	_ENGINE_set_id
	add	esp, 8
	test	eax, eax
	je	$LN3@bind_helpe
	push	DWORD PTR _engine_openssl_name
	push	esi
	call	_ENGINE_set_name
	add	esp, 8
	test	eax, eax
	je	$LN3@bind_helpe
	call	_RSA_get_default_method
	push	eax
	push	esi
	call	_ENGINE_set_RSA
	add	esp, 8
	test	eax, eax
	je	$LN3@bind_helpe
	call	_DSA_get_default_method
	push	eax
	push	esi
	call	_ENGINE_set_DSA
	add	esp, 8
	test	eax, eax
	je	$LN3@bind_helpe
	call	_ECDH_OpenSSL
	push	eax
	push	esi
	call	_ENGINE_set_ECDH
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	call	_ECDSA_OpenSSL
	push	eax
	push	esi
	call	_ENGINE_set_ECDSA
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	call	_DH_get_default_method
	push	eax
	push	esi
	call	_ENGINE_set_DH
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	call	_RAND_SSLeay
	push	eax
	push	esi
	call	_ENGINE_set_RAND
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	OFFSET _openssl_ciphers
	push	esi
	call	_ENGINE_set_ciphers
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	OFFSET _openssl_digests
	push	esi
	call	_ENGINE_set_digests
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
	push	OFFSET _openssl_load_privkey
	push	esi
	call	_ENGINE_set_load_privkey_function
	add	esp, 8
	test	eax, eax
	je	SHORT $LN3@bind_helpe
; Line 175
	mov	eax, 1
	pop	esi
; Line 176
	ret	0
$LN3@bind_helpe:
; Line 169
	xor	eax, eax
	pop	esi
; Line 176
	ret	0
_bind_helper ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _openssl_load_privkey
_TEXT	SEGMENT
_eng$ = 8						; size = 4
_key_id$ = 12						; size = 4
_ui_method$ = 16					; size = 4
_callback_data$ = 20					; size = 4
_openssl_load_privkey PROC				; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 390
	push	esi
; Line 393
	mov	esi, DWORD PTR _key_id$[esp]
	push	edi
	push	esi
	push	OFFSET ??_C@_0CP@HGIJOKNE@?$CITEST_ENG_OPENSSL_PKEY?$CJLoading?5P@
	push	2
	call	DWORD PTR __imp____acrt_iob_func
	add	esp, 4
	push	eax
	call	_fprintf
; Line 395
	push	OFFSET ??_C@_01KDCPPGHE@r?$AA@
	push	esi
	call	_BIO_new_file
	mov	edi, eax
	add	esp, 20					; 00000014H
; Line 396
	test	edi, edi
	jne	SHORT $LN2@openssl_lo
	pop	edi
	pop	esi
; Line 401
	ret	0
$LN2@openssl_lo:
; Line 398
	push	0
	push	0
	push	0
	push	edi
	call	_PEM_read_bio_PrivateKey
; Line 399
	push	edi
	mov	esi, eax
	call	_BIO_free
	add	esp, 20					; 00000014H
; Line 400
	mov	eax, esi
	pop	edi
	pop	esi
; Line 401
	ret	0
_openssl_load_privkey ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _openssl_digests
_TEXT	SEGMENT
_e$ = 8							; size = 4
_digest$ = 12						; size = 4
_nids$ = 16						; size = 4
_nid$ = 20						; size = 4
_openssl_digests PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 366
	mov	eax, DWORD PTR _digest$[esp-4]
	test	eax, eax
	jne	SHORT $LN2@openssl_di
; Line 368
	mov	eax, DWORD PTR _nids$[esp-4]
	mov	DWORD PTR [eax], OFFSET _test_digest_nids
; Line 369
	mov	eax, DWORD PTR _test_digest_nids_number
; Line 383
	ret	0
$LN2@openssl_di:
; Line 372
	cmp	DWORD PTR _nid$[esp-4], 64		; 00000040H
	jne	SHORT $LN3@openssl_di
; Line 373
	mov	DWORD PTR [eax], OFFSET _test_sha_md
; Line 382
	mov	eax, 1
; Line 383
	ret	0
$LN3@openssl_di:
; Line 379
	mov	DWORD PTR [eax], 0
; Line 380
	xor	eax, eax
; Line 383
	ret	0
_openssl_digests ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _openssl_ciphers
_TEXT	SEGMENT
_e$ = 8							; size = 4
_cipher$ = 12						; size = 4
_nids$ = 16						; size = 4
_nid$ = 20						; size = 4
_openssl_ciphers PROC					; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 296
	mov	eax, DWORD PTR _cipher$[esp-4]
	test	eax, eax
	jne	SHORT $LN2@openssl_ci
; Line 298
	mov	eax, DWORD PTR _nids$[esp-4]
	mov	DWORD PTR [eax], OFFSET _test_cipher_nids
; Line 299
	mov	eax, DWORD PTR _test_cipher_nids_number
; Line 315
	ret	0
$LN2@openssl_ci:
; Line 302
	mov	ecx, DWORD PTR _nid$[esp-4]
	cmp	ecx, 5
	jne	SHORT $LN3@openssl_ci
; Line 303
	mov	DWORD PTR [eax], OFFSET _test_r4_cipher
; Line 314
	lea	eax, DWORD PTR [ecx-4]
; Line 315
	ret	0
$LN3@openssl_ci:
; Line 304
	cmp	ecx, 97					; 00000061H
	jne	SHORT $LN5@openssl_ci
; Line 305
	mov	DWORD PTR [eax], OFFSET _test_r4_40_cipher
; Line 314
	mov	eax, 1
; Line 315
	ret	0
$LN5@openssl_ci:
; Line 311
	mov	DWORD PTR [eax], 0
; Line 312
	xor	eax, eax
; Line 315
	ret	0
_openssl_ciphers ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _ENGINE_load_openssl
_TEXT	SEGMENT
_ENGINE_load_openssl PROC				; COMDAT
; File c:\workpace\openssl\openssl-1.0.2h\crypto\engine\eng_openssl.c
; Line 191
	push	esi
; Line 180
	call	_ENGINE_new
	mov	esi, eax
; Line 181
	test	esi, esi
	je	SHORT $LN1@ENGINE_loa
; Line 183
	push	esi
	call	_bind_helper
	add	esp, 4
; Line 184
	push	esi
	test	eax, eax
	jne	SHORT $LN6@ENGINE_loa
	call	_ENGINE_free
	add	esp, 4
$LN1@ENGINE_loa:
	pop	esi
; Line 202
	ret	0
$LN6@ENGINE_loa:
; Line 195
	call	_ENGINE_add
; Line 200
	push	esi
	call	_ENGINE_free
	add	esp, 8
	pop	esi
; Line 201
	jmp	_ERR_clear_error
_ENGINE_load_openssl ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT _fprintf
_TEXT	SEGMENT
__Stream$ = 8						; size = 4
__Format$ = 12						; size = 4
_fprintf PROC						; COMDAT
; File c:\program files\windows kits\10\include\10.0.10586.0\ucrt\stdio.h
; Line 639
	lea	eax, DWORD PTR __Format$[esp]
	push	eax
	push	0
	push	DWORD PTR __Format$[esp+4]
	push	DWORD PTR __Stream$[esp+8]
	call	___local_stdio_printf_options
	push	DWORD PTR [eax+4]
	push	DWORD PTR [eax]
	call	DWORD PTR __imp____stdio_common_vfprintf
	add	esp, 24					; 00000018H
; Line 838
	ret	0
_fprintf ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT __vfprintf_l
_TEXT	SEGMENT
__Stream$ = 8						; size = 4
__Format$ = 12						; size = 4
__Locale$ = 16						; size = 4
__ArgList$ = 20						; size = 4
__vfprintf_l PROC					; COMDAT
; File c:\program files\windows kits\10\include\10.0.10586.0\ucrt\stdio.h
; Line 639
	push	DWORD PTR __ArgList$[esp-4]
	push	DWORD PTR __Locale$[esp]
	push	DWORD PTR __Format$[esp+4]
	push	DWORD PTR __Stream$[esp+8]
	call	___local_stdio_printf_options
	push	DWORD PTR [eax+4]
	push	DWORD PTR [eax]
	call	DWORD PTR __imp____stdio_common_vfprintf
	add	esp, 24					; 00000018H
; Line 640
	ret	0
__vfprintf_l ENDP
_TEXT	ENDS
; Function compile flags: /Ogtpy
;	COMDAT ___local_stdio_printf_options
_TEXT	SEGMENT
___local_stdio_printf_options PROC			; COMDAT
; File c:\program files\windows kits\10\include\10.0.10586.0\ucrt\corecrt_stdio_config.h
; Line 82
	mov	eax, OFFSET ?_OptionsStorage@?1??__local_stdio_printf_options@@9@9 ; `__local_stdio_printf_options'::`2'::_OptionsStorage
; Line 83
	ret	0
___local_stdio_printf_options ENDP
_TEXT	ENDS
END
