; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.40219.01 

	TITLE	C:\workspace\Putty\windows\winproxy.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMTD
INCLUDELIB OLDNAMES

_DATA	SEGMENT
$SG85653 DB	'Starting local proxy command: %s', 00H
	ORG $+3
$SG85658 DB	'Unable to create pipes for proxy command', 00H
	ORG $+3
$SG85661 DB	'Unable to create pipes for proxy command', 00H
_DATA	ENDS
PUBLIC	_platform_new_connection
EXTRN	_make_handle_socket:PROC
EXTRN	__imp__CreateProcessA@40:PROC
EXTRN	__imp__SetHandleInformation@12:PROC
EXTRN	__imp__CloseHandle@4:PROC
EXTRN	_new_error_socket:PROC
EXTRN	__imp__CreatePipe@16:PROC
EXTRN	_safefree:PROC
EXTRN	_logevent:PROC
EXTRN	_dupprintf:PROC
EXTRN	_sk_addr_free:PROC
EXTRN	_format_telnet_command:PROC
EXTRN	_conf_get_int:PROC
EXTRN	@_RTC_CheckStackVars@8:PROC
EXTRN	__RTC_CheckEsp:PROC
EXTRN	__RTC_Shutdown:PROC
EXTRN	__RTC_InitBase:PROC
;	COMDAT rtc$TMZ
; File c:\workspace\putty\windows\winproxy.c
rtc$TMZ	SEGMENT
__RTC_Shutdown.rtc$TMZ DD FLAT:__RTC_Shutdown
rtc$TMZ	ENDS
;	COMDAT rtc$IMZ
rtc$IMZ	SEGMENT
__RTC_InitBase.rtc$IMZ DD FLAT:__RTC_InitBase
; Function compile flags: /Odtp /RTCsu
rtc$IMZ	ENDS
_TEXT	SEGMENT
_ret$85660 = -184					; size = 4
_ret$85657 = -180					; size = 4
_msg$85652 = -176					; size = 4
_pi$ = -168						; size = 16
_si$ = -144						; size = 68
_sa$ = -68						; size = 12
_cmd_from_us$ = -48					; size = 4
_cmd_to_us$ = -36					; size = 4
_us_from_cmd$ = -24					; size = 4
_us_to_cmd$ = -12					; size = 4
_cmd$ = -4						; size = 4
_addr$ = 8						; size = 4
_hostname$ = 12						; size = 4
_port$ = 16						; size = 4
_privport$ = 20						; size = 4
_oobinline$ = 24					; size = 4
_nodelay$ = 28						; size = 4
_keepalive$ = 32					; size = 4
_plug$ = 36						; size = 4
_conf$ = 40						; size = 4
_platform_new_connection PROC
; Line 23
	push	ebp
	mov	ebp, esp
	sub	esp, 184				; 000000b8H
	push	esi
	push	edi
	lea	edi, DWORD PTR [ebp-184]
	mov	ecx, 46					; 0000002eH
	mov	eax, -858993460				; ccccccccH
	rep stosd
; Line 30
	push	13					; 0000000dH
	mov	eax, DWORD PTR _conf$[ebp]
	push	eax
	call	_conf_get_int
	add	esp, 8
	cmp	eax, 5
	je	SHORT $LN3@platform_n
; Line 31
	xor	eax, eax
	jmp	$LN4@platform_n
$LN3@platform_n:
; Line 33
	mov	ecx, DWORD PTR _conf$[ebp]
	push	ecx
	mov	edx, DWORD PTR _port$[ebp]
	push	edx
	mov	eax, DWORD PTR _addr$[ebp]
	push	eax
	call	_format_telnet_command
	add	esp, 12					; 0000000cH
	mov	DWORD PTR _cmd$[ebp], eax
; Line 36
	mov	ecx, DWORD PTR _addr$[ebp]
	push	ecx
	call	_sk_addr_free
	add	esp, 4
; Line 39
	mov	edx, DWORD PTR _cmd$[ebp]
	push	edx
	push	OFFSET $SG85653
	call	_dupprintf
	add	esp, 8
	mov	DWORD PTR _msg$85652[ebp], eax
; Line 42
	mov	eax, DWORD PTR _msg$85652[ebp]
	push	eax
	push	0
	call	_logevent
	add	esp, 8
; Line 43
	mov	ecx, DWORD PTR _msg$85652[ebp]
	push	ecx
	call	_safefree
	add	esp, 4
; Line 50
	mov	DWORD PTR _sa$[ebp], 12			; 0000000cH
; Line 51
	mov	DWORD PTR _sa$[ebp+4], 0
; Line 52
	mov	DWORD PTR _sa$[ebp+8], 1
; Line 53
	mov	esi, esp
	push	0
	lea	edx, DWORD PTR _sa$[ebp]
	push	edx
	lea	eax, DWORD PTR _cmd_to_us$[ebp]
	push	eax
	lea	ecx, DWORD PTR _us_from_cmd$[ebp]
	push	ecx
	call	DWORD PTR __imp__CreatePipe@16
	cmp	esi, esp
	call	__RTC_CheckEsp
	test	eax, eax
	jne	SHORT $LN2@platform_n
; Line 55
	mov	edx, DWORD PTR _plug$[ebp]
	push	edx
	push	OFFSET $SG85658
	call	_new_error_socket
	add	esp, 8
	mov	DWORD PTR _ret$85657[ebp], eax
; Line 56
	mov	eax, DWORD PTR _cmd$[ebp]
	push	eax
	call	_safefree
	add	esp, 4
; Line 57
	mov	eax, DWORD PTR _ret$85657[ebp]
	jmp	$LN4@platform_n
$LN2@platform_n:
; Line 60
	mov	esi, esp
	push	0
	lea	ecx, DWORD PTR _sa$[ebp]
	push	ecx
	lea	edx, DWORD PTR _us_to_cmd$[ebp]
	push	edx
	lea	eax, DWORD PTR _cmd_from_us$[ebp]
	push	eax
	call	DWORD PTR __imp__CreatePipe@16
	cmp	esi, esp
	call	__RTC_CheckEsp
	test	eax, eax
	jne	SHORT $LN1@platform_n
; Line 62
	mov	ecx, DWORD PTR _plug$[ebp]
	push	ecx
	push	OFFSET $SG85661
	call	_new_error_socket
	add	esp, 8
	mov	DWORD PTR _ret$85660[ebp], eax
; Line 63
	mov	edx, DWORD PTR _cmd$[ebp]
	push	edx
	call	_safefree
	add	esp, 4
; Line 64
	mov	esi, esp
	mov	eax, DWORD PTR _us_from_cmd$[ebp]
	push	eax
	call	DWORD PTR __imp__CloseHandle@4
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 65
	mov	esi, esp
	mov	ecx, DWORD PTR _cmd_to_us$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseHandle@4
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 66
	mov	eax, DWORD PTR _ret$85660[ebp]
	jmp	$LN4@platform_n
$LN1@platform_n:
; Line 69
	mov	esi, esp
	push	0
	push	1
	mov	edx, DWORD PTR _us_to_cmd$[ebp]
	push	edx
	call	DWORD PTR __imp__SetHandleInformation@12
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 70
	mov	esi, esp
	push	0
	push	1
	mov	eax, DWORD PTR _us_from_cmd$[ebp]
	push	eax
	call	DWORD PTR __imp__SetHandleInformation@12
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 72
	mov	DWORD PTR _si$[ebp], 68			; 00000044H
; Line 73
	mov	DWORD PTR _si$[ebp+4], 0
; Line 74
	mov	DWORD PTR _si$[ebp+8], 0
; Line 75
	mov	DWORD PTR _si$[ebp+12], 0
; Line 76
	mov	DWORD PTR _si$[ebp+44], 256		; 00000100H
; Line 77
	xor	ecx, ecx
	mov	WORD PTR _si$[ebp+50], cx
; Line 78
	mov	DWORD PTR _si$[ebp+52], 0
; Line 79
	mov	edx, DWORD PTR _cmd_from_us$[ebp]
	mov	DWORD PTR _si$[ebp+56], edx
; Line 80
	mov	eax, DWORD PTR _cmd_to_us$[ebp]
	mov	DWORD PTR _si$[ebp+60], eax
; Line 81
	mov	DWORD PTR _si$[ebp+64], 0
; Line 84
	mov	esi, esp
	lea	ecx, DWORD PTR _pi$[ebp]
	push	ecx
	lea	edx, DWORD PTR _si$[ebp]
	push	edx
	push	0
	push	0
	push	134217760				; 08000020H
	push	1
	push	0
	push	0
	mov	eax, DWORD PTR _cmd$[ebp]
	push	eax
	push	0
	call	DWORD PTR __imp__CreateProcessA@40
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 85
	mov	esi, esp
	mov	ecx, DWORD PTR _pi$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseHandle@4
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 86
	mov	esi, esp
	mov	edx, DWORD PTR _pi$[ebp+4]
	push	edx
	call	DWORD PTR __imp__CloseHandle@4
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 88
	mov	eax, DWORD PTR _cmd$[ebp]
	push	eax
	call	_safefree
	add	esp, 4
; Line 90
	mov	esi, esp
	mov	ecx, DWORD PTR _cmd_from_us$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseHandle@4
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 91
	mov	esi, esp
	mov	edx, DWORD PTR _cmd_to_us$[ebp]
	push	edx
	call	DWORD PTR __imp__CloseHandle@4
	cmp	esi, esp
	call	__RTC_CheckEsp
; Line 93
	push	0
	mov	eax, DWORD PTR _plug$[ebp]
	push	eax
	mov	ecx, DWORD PTR _us_from_cmd$[ebp]
	push	ecx
	mov	edx, DWORD PTR _us_to_cmd$[ebp]
	push	edx
	call	_make_handle_socket
	add	esp, 16					; 00000010H
$LN4@platform_n:
; Line 94
	push	edx
	mov	ecx, ebp
	push	eax
	lea	edx, DWORD PTR $LN14@platform_n
	call	@_RTC_CheckStackVars@8
	pop	eax
	pop	edx
	pop	edi
	pop	esi
	add	esp, 184				; 000000b8H
	cmp	ebp, esp
	call	__RTC_CheckEsp
	mov	esp, ebp
	pop	ebp
	ret	0
	npad	3
$LN14@platform_n:
	DD	7
	DD	$LN13@platform_n
$LN13@platform_n:
	DD	-12					; fffffff4H
	DD	4
	DD	$LN6@platform_n
	DD	-24					; ffffffe8H
	DD	4
	DD	$LN7@platform_n
	DD	-36					; ffffffdcH
	DD	4
	DD	$LN8@platform_n
	DD	-48					; ffffffd0H
	DD	4
	DD	$LN9@platform_n
	DD	-68					; ffffffbcH
	DD	12					; 0000000cH
	DD	$LN10@platform_n
	DD	-144					; ffffff70H
	DD	68					; 00000044H
	DD	$LN11@platform_n
	DD	-168					; ffffff58H
	DD	16					; 00000010H
	DD	$LN12@platform_n
$LN12@platform_n:
	DB	112					; 00000070H
	DB	105					; 00000069H
	DB	0
$LN11@platform_n:
	DB	115					; 00000073H
	DB	105					; 00000069H
	DB	0
$LN10@platform_n:
	DB	115					; 00000073H
	DB	97					; 00000061H
	DB	0
$LN9@platform_n:
	DB	99					; 00000063H
	DB	109					; 0000006dH
	DB	100					; 00000064H
	DB	95					; 0000005fH
	DB	102					; 00000066H
	DB	114					; 00000072H
	DB	111					; 0000006fH
	DB	109					; 0000006dH
	DB	95					; 0000005fH
	DB	117					; 00000075H
	DB	115					; 00000073H
	DB	0
$LN8@platform_n:
	DB	99					; 00000063H
	DB	109					; 0000006dH
	DB	100					; 00000064H
	DB	95					; 0000005fH
	DB	116					; 00000074H
	DB	111					; 0000006fH
	DB	95					; 0000005fH
	DB	117					; 00000075H
	DB	115					; 00000073H
	DB	0
$LN7@platform_n:
	DB	117					; 00000075H
	DB	115					; 00000073H
	DB	95					; 0000005fH
	DB	102					; 00000066H
	DB	114					; 00000072H
	DB	111					; 0000006fH
	DB	109					; 0000006dH
	DB	95					; 0000005fH
	DB	99					; 00000063H
	DB	109					; 0000006dH
	DB	100					; 00000064H
	DB	0
$LN6@platform_n:
	DB	117					; 00000075H
	DB	115					; 00000073H
	DB	95					; 0000005fH
	DB	116					; 00000074H
	DB	111					; 0000006fH
	DB	95					; 0000005fH
	DB	99					; 00000063H
	DB	109					; 0000006dH
	DB	100					; 00000064H
	DB	0
_platform_new_connection ENDP
_TEXT	ENDS
END
